<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>R-toolbox: All in One View</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="../assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="../assets/styles.css">
<script src="../assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="../favicons/lc/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicons/lc/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../favicons/lc/favicon-16x16.png">
<link rel="manifest" href="../favicons/lc/site.webmanifest">
<link rel="mask-icon" href="../favicons/lc/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="white">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="black">
</head>
<body>
    <header id="top" class="navbar navbar-expand-md top-nav library"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="lc-logo" alt="Library Carpentry" src="../assets/images/library-logo.svg"><span class="badge text-bg-danger">
          <abbr title="This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.">
            <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#early-development-pre-alpha-through-alpha" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="border-radius: 5px"></i>
              Pre-Alpha
            </a>
            <span class="visually-hidden">This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text">
<li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul>
</li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
<li><button class="dropdown-item" type="button" onclick="window.location.href='../aio.html';">Learner View</button></li>
        </ul>
</div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav library" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Library Carpentry" src="../assets/images/library-logo-sm.svg">
</div>
    <div class="lesson-title-md">
      R-toolbox
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item">
          <span class="lesson-title">
            R-toolbox
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/instructor-notes.html">Instructor Notes</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/images.html">Extract All Images</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
<hr>
<li><a class="dropdown-item" href="CLT-dk.html">CLT - på dansk</a></li>
<li><a class="dropdown-item" href="CLT-en.html">CLT - in english</a></li>
<li><a class="dropdown-item" href="data.html">Data sets</a></li>
<li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul>
</li>
      </ul>
</div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="../instructor/aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div>
<!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  R-toolbox
</div>

<aside class="col-md-12 lesson-progress"><div style="width: %" class="percentage">
    %
  </div>
  <div class="progress library">
    <div class="progress-bar library" role="progressbar" style="width: %" aria-valuenow="" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text">
<li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul>
</li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="../aio.html">Learner View</a>
                      </div>
                    </div>
                  </div>
<!--/div.accordion-item-->
                </div>
<!--/div.accordion-flush-->
              </div>
<!--div.sidenav-view-selector -->
            </div>
<!--/div.col -->

            <hr>
</div>
<!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Schedule</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="reproducible-analysis.html">1. Reproducible Data Analysis</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="reading-files.html">2. Reading data from file</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="descript-stat.html">3. Descriptive Statistics</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="table1.html">4. Table One</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="tidy-data.html">5. Tidy Data</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="normal-distribution.html">6. The normal distribution</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="is-it-normal.html">7. Testing for normality</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush9">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading9">
        <a href="which-distribution.html">8. How is the data distributed?</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush10">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading10">
        <a href="linear-regression.html">9. Linear regression</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush11">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading11">
        <a href="multiple-linear-regression.html">10. Multiple Linear Regression</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush12">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading12">
        <a href="logistic-regression.html">11. Logistic regression</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush13">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading13">
        <a href="clt.html">12. Central Limit Theorem</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush14">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading14">
        <a href="barcharts.html">13. Nicer barcharts</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush15">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading15">
        <a href="powerberegninger.html">14. Power Calculations</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush16">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading16">
        <a href="kmeans.html">15. k-means</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush17">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading17">
        <a href="tuning-kmeans.html">16. Tuning kmeans</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush18">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading18">
        <a href="anova.html">17. ANOVA</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush19">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading19">
        <a href="ucloud.html">18. R on Ucloud</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush20">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading20">
        <a href="pipes.html">19. A deeper dive into pipes</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush21">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading21">
        <a href="gis_setup.html">20. Setup for GIS</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush22">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading22">
        <a href="fence-test.html">21. Fences på vores undervisningssider</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush23">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading23">
        <a href="making-a-new-course.html">22. Make a new course</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush24">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading24">
        <a href="shinylive.html">23. Shiny without the server</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush25">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading25">
        <a href="choropleths.html">24. Choropleths</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush26">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading26">
        <a href="un-normal-data.html">25. What to do with data that is not normal</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush27">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading27">
        <a href="building-models.html">26. building-models</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush28">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading28">
        <a href="lasso-regularisation.html">27. lasso-regularisation</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush29">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading29">
        <a href="ridge-regularisation.html">28. ridge-regularisation</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush30">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading30">
        <a href="elastic-net-regularisation.html">29. elastic-net-regularisation</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush31">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading31">
        <a href="snow-plot.html">30. snow_plot</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width">
<div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul>
<li>
                        <a href="../instructor/key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="../instructor/instructor-notes.html">Instructor Notes</a>
                      </li>
                      <li>
                        <a href="../instructor/images.html">Extract All Images</a>
                      </li>
                      <hr>
<li><a class="dropdown-item" href="CLT-dk.html">CLT - på dansk</a></li>
<li><a class="dropdown-item" href="CLT-en.html">CLT - in english</a></li>
<li><a class="dropdown-item" href="data.html">Data sets</a></li>
<li><a class="dropdown-item" href="reference.html">Reference</a></li>
                    </ul>
</div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources">
<a href="../instructor/aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none">
<div class="d-grid gap-1">

            </div>
          </div>
<!-- /div.accordion -->
        </div>
<!-- /div.sidebar-inner -->
      </nav>
</div>
<!-- /div.sidebar -->
  </div>
<!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-extra.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <main id="main-content" class="main-content"><div class="container lesson-content">
        
        
<section id="aio-reproducible-analysis"><p>Content from <a href="reproducible-analysis.html">Reproducible Data Analysis</a></p>
<hr>
<p>Last updated on 2025-04-15 |

        <a href="https://github.com/KUBDatalab/R-toolbox/edit/main/episodes/reproducible-analysis.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 12 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do I ensure that my results can be reproduced?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Explain how to use markdown</li>
<li>Demonstrate how to include pieces of code</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<hr class="half-width">
<p>A key concept in the scientific process is reproducibility. We should
be able to run the same experiment again, and get, more or less, the
same result.</p>
<div id="accordionInstructor1" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor1" aria-expanded="false" aria-controls="collapseInstructor1">
  <h3 class="accordion-header" id="headingInstructor1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Instructor Note </h3>
</button>
<div id="collapseInstructor1" class="accordion-collapse collapse" aria-labelledby="headingInstructor1" data-bs-parent="#accordionInstructor1">
<div class="accordion-body">
<p>We will not always get the same result, applying the same functions
on the same data - some statistical techniques relies on randomness.</p>
<p>An example is k-means, that clusters data based on randomly selected
initial centroids.</p>
</div>
</div>
</div>
</div>
<p>This also applies to the analysis of data. If we have a collection of
measurements of blood pressure from patients before and after they have
taken an antihypertensive drug, we might arrive at the result that this
specific drug is not working. Doing the same analysis tomorrow, we
should reach the same result.</p>
<p>And that can be surprisingly difficult!</p>
<p>There are a lot of pitfalls, ranging from accessibility to incentive
structures in academia. But the three areas where R can help us are:</p>
<ul>
<li>Software Environment</li>
<li>Documentation and Metadata</li>
<li>Complex Workflows</li>
</ul></section><section><h2 class="section-heading" id="software-environment">Software Environment<a class="anchor" aria-label="anchor" href="#software-environment"></a>
</h2>
<hr class="half-width">
<p>Data analysis is done using specific software, libraries or packages,
in a variety of versions. And it happens in an environment on the
computer that might not be identical from day to day.</p>
<p>One example of these problems is shown every time we load tidyverse:
<img src="../fig/tidyverse_conflicts.png" alt="Tidyverse conflicts" class="figure"></p>
<p>This message informs us that there is a <code>filter()</code>
function in the <code>stats</code> packages which is part of the core
R-installation. That function is masked by the <code>filter()</code>
function from the <code>tidyverse´ package</code>dplyr`.</p>
<p>If our analysis relies on the way the <code>filter()</code> function
works in the <code>tidyverse</code>, we will get errors if
<code>tidyverse</code> is not loaded.</p>
<p>We might also have data stored in memory. Every time we close
RStudio, we are asked if we want to save the environment:</p>
<figure><img src="../fig/save_environment.png" alt="Should we save the environment? No!" class="figure mx-auto d-block"><div class="figcaption">Should we save the environment? No!</div>
</figure><p>This will save all the objects we have in our environment, in order
for RStudio to be able to load them into memory when we open RStudio
again.</p>
<p>That can be nice and useful. On the other hand we run the risk of
having the wrong version of the
<code>my_data_that_is_ready_for_analysis</code> dataframe lying around
in memory.</p>
<p>In addition we can experience performance problems. Storing a lot of
large objects before closing RStudio can take a lot of time. And loading
them into memory when opening RStudio will also take a lot of time.</p>
<p>On modern computers we normally have plenty of storage - but it is
entirely possible to fill your harddrive with R-environments to the
point where your computer crashes.</p>
</section><section><h2 class="section-heading" id="documentation-and-metadata">Documentation and Metadata<a class="anchor" aria-label="anchor" href="#documentation-and-metadata"></a>
</h2>
<hr class="half-width">
<p>What did we actually do in the analysis? Why did we do it? Why are we
reaching the conclusion we’ve arrived at?</p>
<p>Three very good questions. Having good metadata, data that describes
your data, often makes understanding your data easier. Documenting the
individual steps of your analysis, may not seem necessary right now -
you know why you are doing what you are doing. But future you - you in
three months, or some one else, might not remember or be able to guess
(correctly).</p>
</section><section><h2 class="section-heading" id="complex-workflows">Complex Workflows<a class="anchor" aria-label="anchor" href="#complex-workflows"></a>
</h2>
<hr class="half-width">
<p>Doing data analysis in eg Excel, can involve a lot of pointing and
clicking.</p>
<p>And in any piece of software, the analysis will normally always
involve more than one step. Those steps will have to be done in the
correct order. Calculating a mean of some values, depends heavily on
whether it happens before or after deleting irrelevant observations.</p>
</section><section><h2 class="section-heading" id="the-solution-to-all-of-this">The solution to all of this!<a class="anchor" aria-label="anchor" href="#the-solution-to-all-of-this"></a>
</h2>
<hr class="half-width">
<figure><img src="../fig/horstmarkdown.png" alt="The Rmarkdown family. Artwork by @allison_horst, https://twitter.com/allison_horst, CC-BY" class="figure mx-auto d-block"><div class="figcaption">The Rmarkdown family. Artwork by <span class="citation">@allison_horst</span>, <a href="https://twitter.com/allison_horst" class="external-link uri">https://twitter.com/allison_horst</a>, CC-BY</div>
</figure><p>Working in RMarkdown allows us to collect the text describing our
data, what and why we are doing what we do, the code actually doing it,
and the results of that code - all in one document.</p>
<p>Open a new file, choose RMarkdown, and give your document a name:</p>
<figure><img src="../fig/rmarkdown.png" alt="An RMarkdown document" class="figure mx-auto d-block"><div class="figcaption">An RMarkdown document</div>
</figure><p>The code chunks, marked here with a light grey background, contains
code, in this case not very advanced code. You can run the entire code
chunk by clicking the green arrow on the right. Or by placing your
cursor in the line of code you want to run, and pressing ctrl+enter (or
command+enter on a Mac).</p>
<p>Outside the code chunks we can add our reasons for actually running
<code>summary</code> on the <code>cars</code> dataframe, and describe
what it contains.</p>
<p>You will see a new button in RStudio: <img src="../fig/knitr_button.png" alt="The Knit button" class="figure"></p>
<p>Clicking this, will “knit” your document; run each chunck of code,
add the output to your document, and combine your code, the results and
all your explanatory text to one html-document.</p>
<p>If you do not want an HTMl-document, you can knit to a MicroSoft Word
document. Depending on your computer, you can knit directly to a
pdf.</p>
<p>Having the entirety of your analysis in an RMarkdown document, and
then running it, ensures that the individual steps in the analysis are
run in the correct order.</p>
<p>It does not ensure that your documentation of what you do is written
- it makes it easy to add it, but you still have to do it.</p>
<div class="section level3">
<h3 id="but-what-about-the-environment">But what about the environment?<a class="anchor" aria-label="anchor" href="#but-what-about-the-environment"></a>
</h3>
<p>So we force ourself to have the steps in our analysis in the correct
order, and we make it easy to add documentation. What about the
environment?</p>
<p>Working with RMarkdown also adresses this problem. Every time we
<code>knit</code> our document, RStudio opens a new session of R,
without libraries or objects in memory. This ensures that the analysis
is done in the exact same way each and every time.</p>
<p>This, on the other hand, requires us to add code chunks loading
libraries and data to our document.</p>
<div id="try-it-yourself" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="try-it-yourself" class="callout-inner">
<h3 class="callout-title">Try it yourself</h3>
<div class="callout-content">
<p>Make a new RMarkdown document, add <code><a href="https://tidyverse.tidyverse.org" class="external-link">library(tidyverse)</a></code> to
the first chunk, add your own text, and change the plot to plot the
<code>distance</code> variable from the <code>cars</code> data set.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>Make a new RMarkdown document - File -&gt; New File -&gt; R
Markdown.</p>
<p>Change the final code chunk to include <code>plot(cars$dist)</code>
instead of plot(pressure), and add <code><a href="https://tidyverse.tidyverse.org" class="external-link">library(tidyverse)</a></code>.</p>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Use RMarkdown to enforce reproducible analysis</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div>
</section></section><section id="aio-reading-files"><p>Content from <a href="reading-files.html">Reading data from file</a></p>
<hr>
<p>Last updated on 2025-04-15 |

        <a href="https://github.com/KUBDatalab/R-toolbox/edit/main/episodes/reading-files.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 12 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do you read in data from files?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Explain how to read in data from a selection of different data
files.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<hr class="half-width">
<p>The first step of doing dataanalysis, is normally to read in the
data.</p>
<p>Data can come from many different sources, and it is practically
impossible to cover every possible format. Here we cover some of the
more common.</p>
<div id="accordionInstructor1" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor1" aria-expanded="false" aria-controls="collapseInstructor1">
  <h3 class="accordion-header" id="headingInstructor1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Instructor Note </h3>
</button>
<div id="collapseInstructor1" class="accordion-collapse collapse" aria-labelledby="headingInstructor1" data-bs-parent="#accordionInstructor1">
<div class="accordion-body">
<p>The most important point is that there is a very high probability
that at least one package exists that is designed to read a specific
weird data format.</p>
</div>
</div>
</div>
</div>
<figure><img src="../fig/manyfiles.webp" class="figure mx-auto d-block"></figure></section><section><h2 class="section-heading" id="use-code">Use code!<a class="anchor" aria-label="anchor" href="#use-code"></a>
</h2>
<hr class="half-width">
<p>RStudio makes it simple to load most common data formats: Click on
the file in the “Files” tab in RStudio, and choose “Import Dataset”:</p>
<figure><img src="../fig/import-file.png" class="figure mx-auto d-block"></figure><p>RStudio will then provide an interface for loading the data:</p>
<figure><img src="../fig/data_import.png" class="figure mx-auto d-block"></figure><p>However in general we prefer to have a script or a document, that can
be run without us pointing and clicking. So - instead of importing the
data in this way, copy the code that RStudio uses to import the data,
and paste it into your script or document.</p>
</section><section><h2 class="section-heading" id="csv-files">CSV-files<a class="anchor" aria-label="anchor" href="#csv-files"></a>
</h2>
<hr class="half-width">
<p>The most basic file type for storing and transferring data. A
“simple” textfile, containing tabular data. One line of text for each
row of data, each cell in that row, corresponding to a column, separated
with a separator, typically a comma.</p>
<p>Many languages use commas as decimal separators. That neccesitates an
option for using something else than a comma. Typically a semicolon.</p>
<div class="section level3">
<h3 id="truly-commaseparated-files">Truly commaseparated files<a class="anchor" aria-label="anchor" href="#truly-commaseparated-files"></a>
</h3>
<p>Use <code>read.csv()</code> (from base-R) or <code>read_csv()</code>
(from <code>readr</code>, included in <code>tidyverse</code>)</p>
<p>We recommend using <code>read_csv()</code>.</p>
</div>
<div class="section level3">
<h3 id="semicolon-separated-files">Semicolon separated files<a class="anchor" aria-label="anchor" href="#semicolon-separated-files"></a>
</h3>
<p>Use <code>read.csv2()</code> (from base-R) or
<code>read_csv2()</code> (from <code>readr</code>, included in
<code>tidyverse</code>)</p>
<p>We recommend <code>read_csv2()</code></p>
</div>
<div class="section level3">
<h3 id="what-they-have-in-common">What they have in common<a class="anchor" aria-label="anchor" href="#what-they-have-in-common"></a>
</h3>
<p><code>read_csv</code> and <code>read_csv2</code> take a lot of
arguments that can control datatypes, handling of headers etc. For most
use, the default options are enough, but if you need to adjust
something, there are plenty of options for that.</p>
<div id="guess_max" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="guess_max" class="callout-inner">
<h3 class="callout-title">guess_max</h3>
<div class="callout-content">
<p><code>read_csv</code> and <code>read_csv2</code> tries to guess the
datatypes in the file, and will convert the data accordingly. That will
return a dataframe where date-time data is stored as such. The functions
by default reads the first 1000 rows, and makes a guess on the datatype
based on that.</p>
<p>That can lead to problems if the first 1000 rows of a column contain
numbers, and row 1001 contains text. In that case the entire row will be
coerced to <code>numeric</code>, and the following rows will contain
<code>NA</code> values. Adjust the argument <code>guess_max</code> to
something larger to catch this problem.</p>
<p>To include every row in the guess, add <code>guess_max = Inf</code> -
but be careful if you have a very large dataset.</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="excel-files">Excel-files<a class="anchor" aria-label="anchor" href="#excel-files"></a>
</h2>
<hr class="half-width">
<p>Use the <code>readxl</code> package. Excel comes in two variants,
<code>xls</code> and <code>xlsx</code>. <code>read_excel()</code> makes
a qualified quess of the actual type your excel-file is. Should we need
to specify, we can use <code>read_xls()</code> or
<code>read_xlsx()</code>.</p>
<p>Workbooks often contains more than one sheet. We can specify which we
want to read in:</p>
<p><code>read_excel(path = "filename", sheet = 2)</code></p>
<p>Which will read in sheet number 2 from the workbook “filename”.</p>
<p>Read the documentation for details on how to read in specific cells
or ranges.</p>
</section><section><h2 class="section-heading" id="spss">SPSS<a class="anchor" aria-label="anchor" href="#spss"></a>
</h2>
<hr class="half-width">
<p>SPSS, originally “Statistical Package for the Social Sciences”, later
renamed “Statistical Product and Service Solutions” is a proprietary
statistical software suite developed by IBM.</p>
<p>Not surprisingly it is widely used in social science.</p>
<p>The package <code>haven</code> supports reading SPSS (Stata and SAS)
files</p>
<p>Use the package to read in spss files:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">haven</span><span class="op">)</span></span>
<span><span class="fu">read_spss</span><span class="op">(</span><span class="st">"filename"</span><span class="op">)</span></span></code></pre>
</div>
<p>The function returns at tibble.</p>
<p>Note that SPSS uses a variety of different formats.
<code>read_spss()</code> will make a guess of the correct format, but if
problems arise, try using one of the other functions provided in
<code>haven</code></p>
</section><section><h2 class="section-heading" id="stata">Stata<a class="anchor" aria-label="anchor" href="#stata"></a>
</h2>
<hr class="half-width">
<p>Stata is a proprietary statistical software package, used in a
multitude of different fields, primarily biomedicine, epidemiololy,
sociology and economics.</p>
<p>As mentioned above, the <code>haven</code> package provides functions
for reading Stata files:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">haven</span><span class="op">)</span></span>
<span><span class="fu">read_stata</span><span class="op">(</span><span class="st">"filename"</span><span class="op">)</span></span></code></pre>
</div>
<p>The function returns at tibble.</p>
<p>As with SPSS Stata uses a couple of different fileformats, and
<code>read_stata</code> makes a guess as to which format is used. If
problems arise, <code>haven</code> has more specific functions for
reading specific file formats.</p>
</section><section><h2 class="section-heading" id="sas">SAS<a class="anchor" aria-label="anchor" href="#sas"></a>
</h2>
<hr class="half-width">
<p>SAS is a proprietary statistical software suite developed by SAS
Institute.</p>
<figure><img src="../fig/SasScreenshot.png" class="figure mx-auto d-block"></figure><p>The package <code>haven</code> can read SAS-files:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">haven</span><span class="op">)</span></span>
<span><span class="fu">read_sas</span><span class="op">(</span><span class="st">"filename"</span><span class="op">)</span></span></code></pre>
</div>
<p>The function returns at tibble.</p>
<p>As with SPSS and Stata, SAS uses a couple of different fileformats,
and <code>read_sas</code> tries to guess the correct format.</p>
<p>If problems arise, <code>haven</code> has more specific functions for
reading specific file formats.</p>
</section><section><h2 class="section-heading" id="json">JSON<a class="anchor" aria-label="anchor" href="#json"></a>
</h2>
<hr class="half-width">
<p>Not all data come in a nice rectangular format, note the multiple
phone numbers for the White House:</p>
<table style="width:97%;" class="table">
<colgroup>
<col width="50%">
<col width="20%">
<col width="22%">
<col width="4%">
</colgroup>
<tbody>
<tr class="odd">
<td rowspan="2">
<h1 id="country">Country</h1>
<p>USA</p>
</td>
<td rowspan="2">
<h1 id="name">Name</h1>
<p>NASA</p>
</td>
<td rowspan="2">
<h1 id="phonenumber">Phonenumber</h1>
<ol start="713" style="list-style-type: decimal">
<li>483-3111</li>
</ol>
</td>
<td></td>
</tr>
<tr class="even">
<td></td>
</tr>
<tr class="odd">
<td></td>
<td>White House</td>
<td>
<ol start="202" style="list-style-type: decimal">
<li>456-1414</li>
</ol>
<p>(202)-456-1111</p>
</td>
<td></td>
</tr>
<tr class="even">
<td>Russia</td>
<td>Kremlin</td>
<td colspan="2">0107-095-295-9051</td>
</tr>
<tr class="odd">
<td>Vatican</td>
<td>The Pope</td>
<td>011-39-6-6982</td>
<td></td>
</tr>
</tbody>
</table>
<p>There are two locations in the US, and one of them have two phone
numbers. These kinds of structures, where one row contains data with
more than one row (etc), are called nested, and are often stored or
distributed in the JSON-format.</p>
<p>JSON can be read using <code>fromJSON()</code> from the
<code>jsonlite</code> library.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">jsonlite</span><span class="op">)</span></span>
<span><span class="fu">fromJSON</span><span class="op">(</span><span class="st">"filename"</span><span class="op">)</span></span></code></pre>
</div>
<p>Note that you will end up with nested columns - containing lists -
which you probably will have to handle afterwards.</p>
</section><section><h2 class="section-heading" id="other-formats">Other formats<a class="anchor" aria-label="anchor" href="#other-formats"></a>
</h2>
<hr class="half-width">
<p>In general if a piece of software is in widespread enough use that
you encounter the weird file-format it uses, someone will have written a
package for reading it. Google is your friend here!</p>
<p>Also, if you encounter a really weird dataformat, please send us an
example so we can expand our knowledge.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>The <code>readr</code> version of <code>read_csv()</code> is
preferred</li>
<li>Remember that csv is not always actually separated with commas.</li>
<li>The <code>haven</code> package contains functions for reading common
proprietary file formats.</li>
<li>In general a package will exist for reading strange datatypes.
Google is your friend!</li>
<li>Use code to read in your data</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-descript-stat"><p>Content from <a href="descript-stat.html">Descriptive Statistics</a></p>
<hr>
<p>Last updated on 2025-04-15 |

        <a href="https://github.com/KUBDatalab/R-toolbox/edit/main/episodes/descript-stat.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 12 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can we describe a set of data?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Learn about the most common ways of describing a variable</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<hr class="half-width">
<div id="accordionInstructor1" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor1" aria-expanded="false" aria-controls="collapseInstructor1">
  <h3 class="accordion-header" id="headingInstructor1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Instructor Note </h3>
</button>
<div id="collapseInstructor1" class="accordion-collapse collapse" aria-labelledby="headingInstructor1" data-bs-parent="#accordionInstructor1">
<div class="accordion-body">
<p>Det kan være en udfordring hvis deltagene ikke ved hvad et gennemsnit
er.</p>
<p>En af de overordnede pointer vi gerne vil frem til her, er
percentilerne og det kumulative densitetsplot - der danner grundlag for
forståelsen af normalfordelingens sammenhæng med statistiske tests.</p>
</div>
</div>
</div>
</div>
<p>Descriptive statistic involves summarising or describing a set of
data. It usually presents quantitative descriptions in a short form, and
helps to simplify large datasets.</p>
<p>Most descriptive statistical parameters applies to just one variable
in our data, and includes:</p>
<table class="table">
<thead><tr class="header">
<th>Central tendency</th>
<th>Measure of variation</th>
<th>Measure of shape</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Mean</td>
<td>Range</td>
<td>Skewness</td>
</tr>
<tr class="even">
<td>Median</td>
<td>Quartiles</td>
<td>Kurtosis</td>
</tr>
<tr class="odd">
<td>Mode</td>
<td>Inter Quartile Range</td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>Variance</td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td>Standard deviation</td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>Percentiles</td>
<td></td>
</tr>
</tbody>
</table></section><section><h2 class="section-heading" id="central-tendency">Central tendency<a class="anchor" aria-label="anchor" href="#central-tendency"></a>
</h2>
<hr class="half-width">
<p>The easiest way to get summary statistics on data is to use the
<code>summarise</code> function from the <code>tidyverse</code>
package.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span></code></pre>
</div>
<p>In the following we are working with the <code>palmerpenguins</code>
dataset. Note that the actual data is called <code>penguins</code> and
is part of the package <code>palmerpenguins</code>:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">palmerpenguins</span><span class="op">)</span></span>
<span><span class="fu">head</span><span class="op">(</span><span class="va">penguins</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 6 × 8
  species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
  &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;
1 Adelie  Torgersen           39.1          18.7               181        3750
2 Adelie  Torgersen           39.5          17.4               186        3800
3 Adelie  Torgersen           40.3          18                 195        3250
4 Adelie  Torgersen           NA            NA                  NA          NA
5 Adelie  Torgersen           36.7          19.3               193        3450
6 Adelie  Torgersen           39.3          20.6               190        3650
# ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;</code></pre>
</div>
<p>344 penguins have been recorded at three different islands over three
years. Three different penguin species are in the dataset, and we have
data on their weight, sex, length of their flippers and two measurements
of their bill (beak).</p>
<p><img src="../fig/culmen_depth.png" alt="What is lenght and depth of penguin bills?" class="figure">{Copyright Allison
Horst}</p>
<p>Specifically we are going to work with the weight of the penguins,
stored in the variable <code>body_mass_g</code>:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span><span class="op">$</span><span class="va">body_mass_g</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  [1] 3750 3800 3250   NA 3450 3650 3625 4675 3475 4250 3300 3700 3200 3800 4400
 [16] 3700 3450 4500 3325 4200 3400 3600 3800 3950 3800 3800 3550 3200 3150 3950
 [31] 3250 3900 3300 3900 3325 4150 3950 3550 3300 4650 3150 3900 3100 4400 3000
 [46] 4600 3425 2975 3450 4150 3500 4300 3450 4050 2900 3700 3550 3800 2850 3750
 [61] 3150 4400 3600 4050 2850 3950 3350 4100 3050 4450 3600 3900 3550 4150 3700
 [76] 4250 3700 3900 3550 4000 3200 4700 3800 4200 3350 3550 3800 3500 3950 3600
 [91] 3550 4300 3400 4450 3300 4300 3700 4350 2900 4100 3725 4725 3075 4250 2925
[106] 3550 3750 3900 3175 4775 3825 4600 3200 4275 3900 4075 2900 3775 3350 3325
[121] 3150 3500 3450 3875 3050 4000 3275 4300 3050 4000 3325 3500 3500 4475 3425
[136] 3900 3175 3975 3400 4250 3400 3475 3050 3725 3000 3650 4250 3475 3450 3750
[151] 3700 4000 4500 5700 4450 5700 5400 4550 4800 5200 4400 5150 4650 5550 4650
[166] 5850 4200 5850 4150 6300 4800 5350 5700 5000 4400 5050 5000 5100 4100 5650
[181] 4600 5550 5250 4700 5050 6050 5150 5400 4950 5250 4350 5350 3950 5700 4300
[196] 4750 5550 4900 4200 5400 5100 5300 4850 5300 4400 5000 4900 5050 4300 5000
[211] 4450 5550 4200 5300 4400 5650 4700 5700 4650 5800 4700 5550 4750 5000 5100
[226] 5200 4700 5800 4600 6000 4750 5950 4625 5450 4725 5350 4750 5600 4600 5300
[241] 4875 5550 4950 5400 4750 5650 4850 5200 4925 4875 4625 5250 4850 5600 4975
[256] 5500 4725 5500 4700 5500 4575 5500 5000 5950 4650 5500 4375 5850 4875 6000
[271] 4925   NA 4850 5750 5200 5400 3500 3900 3650 3525 3725 3950 3250 3750 4150
[286] 3700 3800 3775 3700 4050 3575 4050 3300 3700 3450 4400 3600 3400 2900 3800
[301] 3300 4150 3400 3800 3700 4550 3200 4300 3350 4100 3600 3900 3850 4800 2700
[316] 4500 3950 3650 3550 3500 3675 4450 3400 4300 3250 3675 3325 3950 3600 4050
[331] 3350 3450 3250 4050 3800 3525 3950 3650 3650 4000 3400 3775 4100 3775</code></pre>
</div>
<p>How can we describe these values?</p>
<div class="section level3">
<h3 id="mean">Mean<a class="anchor" aria-label="anchor" href="#mean"></a>
</h3>
<p>The mean is the average of all datapoints. We add all values
(excluding the missing values encoded with <code>NA</code>), and divide
with the number of observations:</p>
<p><span class="math display">\[\overline{x} = \frac{1}{N}\sum_1^N
x_i\]</span> Where N is the number of observations, and <span class="math inline">\(x_i\)</span> is the individual observations in the
sample <span class="math inline">\(x\)</span>.</p>
<p>The easiest way of getting the mean is using the <code>mean()</code>
function:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">mean</span><span class="op">(</span><span class="va">penguins</span><span class="op">$</span><span class="va">body_mass_g</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 4201.754</code></pre>
</div>
<p>A slightly more cumbersome way is using the <code>summarise()</code>
function from <code>tidyverse</code>:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>avg_mass <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">body_mass_g</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 1 × 1
  avg_mass
     &lt;dbl&gt;
1    4202.</code></pre>
</div>
<p>As we will see below, this function streamlines the process of
getting multiple descriptive values.</p>
<p>Barring significant outliers, <code>mean</code> is an expression of
position of the data. This is the weight we would expect a random
penguin in our dataset to have.</p>
<p>However, we have three different species of penguins in the dataset,
and they have quite different average weights. There is also a
significant difference in the average weight for the two sexes.</p>
<p>We will get to that at the end of this segment.</p>
</div>
<div class="section level3">
<h3 id="median">Median<a class="anchor" aria-label="anchor" href="#median"></a>
</h3>
<p>Similarly to the average/mean, the <code>median</code> is an
expression of the location of the data. If we order our data by size,
from the smallest to the largest value, and locate the middle
observation, we get the median. This is the value that half of the
observations is smaller than. And half the observations is larger.</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">median</span><span class="op">(</span><span class="va">penguins</span><span class="op">$</span><span class="va">body_mass_g</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 4050</code></pre>
</div>
<p>We can note that the mean is larger than the median. This indicates
that the data is skewed, in this case toward the larger penguins.</p>
<p>We can get both <code>median</code> and <code>mean</code> in one go
using the <code>summarise()</code> function:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>median <span class="op">=</span> <span class="fu">median</span><span class="op">(</span><span class="va">body_mass_g</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>            mean   <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">body_mass_g</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 1 × 2
  median  mean
   &lt;dbl&gt; &lt;dbl&gt;
1   4050 4202.</code></pre>
</div>
<div id="accordionInstructor2" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor2" aria-expanded="false" aria-controls="collapseInstructor2">
  <h3 class="accordion-header" id="headingInstructor2">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Instructor Note </h3>
</button>
<div id="collapseInstructor2" class="accordion-collapse collapse" aria-labelledby="headingInstructor2" data-bs-parent="#accordionInstructor2">
<div class="accordion-body">
<p>This illustrates for the learners that we can calculate more than one
summary statistics in one summarise function.</p>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="mode">Mode<a class="anchor" aria-label="anchor" href="#mode"></a>
</h3>
<p>Mode is the most common, or frequently occurring, observation. R does
not have a build-in function for this, but we can easily find the mode
by counting the different observations,and locating the most common
one.</p>
<p>We typically do not use this for continous variables. The mode of the
<code>sex</code> variable in this dataset can be found like this:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">sex</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 3 × 2
  sex        n
  &lt;fct&gt;  &lt;int&gt;
1 male     168
2 female   165
3 &lt;NA&gt;      11</code></pre>
</div>
<p>We count the different values in the <code>sex</code> variable, and
arrange the counts in descending order (<code>desc</code>). The mode of
the <code>sex</code> variable is male.</p>
<p>In this specific case, we note that the dataset is pretty evenly
balanced regarding the two sexes.</p>
</div>
</section><section><h2 class="section-heading" id="measures-of-variance">Measures of variance<a class="anchor" aria-label="anchor" href="#measures-of-variance"></a>
</h2>
<hr class="half-width">
<p>Knowing where the observations are located is interesting. But how do
they vary? How can we describe the variation in the data?</p>
<div class="section level3">
<h3 id="range">Range<a class="anchor" aria-label="anchor" href="#range"></a>
</h3>
<p>The simplest information about the variation is the range. What is
the smallest and what is the largest value? Or, what is the spread?</p>
<p>We can get that by using the <code>min()</code> and
<code>max()</code> functions in a <code>summarise()</code> function:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>min <span class="op">=</span> <span class="fu">min</span><span class="op">(</span><span class="va">body_mass_g</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,</span>
<span>            max <span class="op">=</span> <span class="fu">max</span><span class="op">(</span><span class="va">body_mass_g</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 1 × 2
    min   max
  &lt;int&gt; &lt;int&gt;
1  2700  6300</code></pre>
</div>
<p>There is a dedicated function, <code>range()</code>, that does the
same. However it returns two values (for each row), and the summarise
function expects to get <em>one</em> value.</p>
<p>If we would like to use the <code>range()</code> function, we can add
it using the <code>reframe()</code> function instead of
<code>summarise()</code>:</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">reframe</span><span class="op">(</span>range <span class="op">=</span> <span class="fu">range</span><span class="op">(</span><span class="va">body_mass_g</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 2 × 1
  range
  &lt;int&gt;
1  2700
2  6300</code></pre>
</div>
<div id="accordionInstructor3" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor3" aria-expanded="false" aria-controls="collapseInstructor3">
  <h3 class="accordion-header" id="headingInstructor3">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Instructor Note </h3>
</button>
<div id="collapseInstructor3" class="accordion-collapse collapse" aria-labelledby="headingInstructor3" data-bs-parent="#accordionInstructor3">
<div class="accordion-body">
<p>Hvorfor ikke bare bruge reframe generelt? Kognitivt load. Summarise
angiver hvad det er vi gør. Vi summariser noget data. Reframe angiver
hvordan vi omdanner et output til en dataframe. Resultatet bliver det
samme, men vi taler ikke længere om hvad det egentlig er vi er ude efter
i operationen.</p>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="variance">Variance<a class="anchor" aria-label="anchor" href="#variance"></a>
</h3>
<p>The observations varies. They are not all located at the mean (or
median), but are spread out on both sides of the mean. Can we get a
numerical value describing that?</p>
<p>An obvious way would be to calculate the difference between each of
the observations and the mean, and then take the average of those
differences.</p>
<p>That will give us the average deviation. But we have a problem. The
average weight of penguins was 4202 (rounded). Look at two penguins, one
weighing 5000, and another weighing 3425. The differences are:</p>
<ul>
<li>5000 - 4202 = 798</li>
<li>3425 - 4202 = -777</li>
</ul>
<p>The sum of those two differences is: -777 + 798 = 21 g. And the
average is then 10.5 gram. That is <em>not</em> a good estimate of a
variation from the mean of more than 700 gram.</p>
<p>The problem is, that the differences can be both positive and
negative, and might cancel each other out.</p>
<p>We solve that problem by squaring the differences, and calculate the
mean of those.</p>
<div id="accordionInstructor4" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor4" aria-expanded="false" aria-controls="collapseInstructor4">
  <h3 class="accordion-header" id="headingInstructor4">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Instructor Note </h3>
</button>
<div id="collapseInstructor4" class="accordion-collapse collapse" aria-labelledby="headingInstructor4" data-bs-parent="#accordionInstructor4">
<div class="accordion-body">
<p>Why not just averaging the absolute values? Using the square rather
than the absolute difference, weighs the deviations so larger deviations
have relatively larger influence on the variance. Squaring results in a
continous and differentiable function, which helps in situations where
we have to do an optimisation. Also the normal distribution is defined
by the variance as defined here, and we would really like to get a
connection between what we observe here, and the normal
distribution.</p>
</div>
</div>
</div>
</div>
<p>For the population variance, the mathematical notation would be:</p>
<p><span class="math display">\[
\sigma^2 = \frac{\sum_{i=1}^N(x_i - \mu)^2}{N}
\]</span></p>
<div id="population-or-sample" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="population-or-sample" class="callout-inner">
<h3 class="callout-title">Population or sample?</h3>
<div class="callout-content">
<p>Why are we suddenly using <span class="math inline">\(\mu\)</span>
instead of <span class="math inline">\(\overline{x}\)</span>? Because
this definition uses the population mean. The mean, or average, in the
entire population of all penguins everywhere in the universe. But we
have not weighed all those penguins.</p>
</div>
</div>
</div>
<p>And the sample variance:</p>
<p><span class="math display">\[
s^2 = \frac{\sum_{i=1}^N(x_i - \overline{x})^2}{N-1}
\]</span></p>
<p>Note that we also change the <span class="math inline">\(\sigma\)</span> to an <span class="math inline">\(s\)</span>.</p>
<p>And again we are not going to do that by hand, but will ask R to do
it for us:</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span></span>
<span>            variance <span class="op">=</span> <span class="fu">var</span><span class="op">(</span><span class="va">body_mass_g</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span>          <span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 1 × 1
  variance
     &lt;dbl&gt;
1  643131.</code></pre>
</div>
<div id="accordionInstructor5" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor5" aria-expanded="false" aria-controls="collapseInstructor5">
  <h3 class="accordion-header" id="headingInstructor5">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Instructor Note </h3>
</button>
<div id="collapseInstructor5" class="accordion-collapse collapse" aria-labelledby="headingInstructor5" data-bs-parent="#accordionInstructor5">
<div class="accordion-body">
<p>Et godt spørgsmål vil være - hvorfor dividerer vi med N-1 i stedet
for N?</p>
<p>Det kaldes for en “Bessel korrektion”. Den ene årsag til at vi gør
det er, at godt nok er gennemsnittet i stikprøven et godt estimat for
gennemsnittet i populationen. Men det er ikke præcis det samme. Når vi
dividerer med et mindre tal, får vi en større værdi for variancen - og
dermed et mere konservativt, eller forsigtigt, estimat på variansen.</p>
<p>Den anden årsag handler om frihedsgrader. Hvis vi har tre værdier og
et gennemsnit, kan vi vælge hvad de to af værdierne er, og hvad
gennemsnittet er. Helt frit. Men den tredie værdi er givet. Den kan vi
ikke vælge frit.</p>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="standard-deviation">Standard deviation<a class="anchor" aria-label="anchor" href="#standard-deviation"></a>
</h3>
<p>There is a problem with the variance. It is 643131, completely off
scale from the actual values. There is also a problem with the unit
which is in <span class="math inline">\(g^2\)</span>.</p>
<p>A measurement of the variation of the data would be the standard
deviation, simply defined as the square root of the variance:</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span></span>
<span>            s <span class="op">=</span> <span class="fu">sd</span><span class="op">(</span><span class="va">body_mass_g</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span>          <span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 1 × 1
      s
  &lt;dbl&gt;
1  802.</code></pre>
</div>
<p>Since the standard deviation occurs in several statistical tests, it
is more frequently used than the variance. It is also more intuitively
relateable to the mean.</p>
</div>
</section><section><h2 class="section-heading" id="a-histogram">A histogram<a class="anchor" aria-label="anchor" href="#a-histogram"></a>
</h2>
<hr class="half-width">
<p>A visual illustration of the data can be nice. Often one of the first
we make, is a histogram.</p>
<p>A histogram is a plot or graph where we split the range of
observations in a number of “buckets”, and count the number of
observations in each bucket:</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">body_mass_g</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="op">!</span><span class="fu">is.na</span><span class="op">(</span><span class="va">body_mass_g</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>buckets <span class="op">=</span> <span class="fu">cut</span><span class="op">(</span><span class="va">body_mass_g</span>, breaks<span class="op">=</span><span class="fu">seq</span><span class="op">(</span><span class="fl">2500</span>,<span class="fl">6500</span>,<span class="fl">500</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span><span class="fu">group_by</span><span class="op">(</span><span class="va">buckets</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span><span class="fu">summarise</span><span class="op">(</span>antal <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 8 × 2
  buckets         antal
  &lt;fct&gt;           &lt;int&gt;
1 (2.5e+03,3e+03]    11
2 (3e+03,3.5e+03]    67
3 (3.5e+03,4e+03]    92
4 (4e+03,4.5e+03]    57
5 (4.5e+03,5e+03]    54
6 (5e+03,5.5e+03]    33
7 (5.5e+03,6e+03]    26
8 (6e+03,6.5e+03]     2</code></pre>
</div>
<p>Typically, rather than counting ourself, we leave the work to R, and
make a histogram directly:</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">%&gt;%</span> </span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">body_mass_g</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu">geom_histogram</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">WARNING<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="warning" tabindex="0"><code>Warning: Removed 2 rows containing non-finite outside the scale range
(`stat_bin()`).</code></pre>
</div>
<figure><img src="../fig/descript-stat-rendered-histogram-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>By default ggplot chooses 30 bins, typically we should chose a
different number:</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">%&gt;%</span> </span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">body_mass_g</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu">geom_histogram</span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">25</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">WARNING<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="warning" tabindex="0"><code>Warning: Removed 2 rows containing non-finite outside the scale range
(`stat_bin()`).</code></pre>
</div>
<figure><img src="../fig/descript-stat-rendered-change_bin_n-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Or, ideally, set the widths of them, manually:</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">%&gt;%</span> </span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">body_mass_g</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu">geom_histogram</span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">250</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Histogram with binwidth = 250 g"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">WARNING<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="warning" tabindex="0"><code>Warning: Removed 2 rows containing non-finite outside the scale range
(`stat_bin()`).</code></pre>
</div>
<p><img src="../fig/descript-stat-rendered-change_bin_width-1.png" style="display: block; margin: auto;" class="figure">
Or even specify the exact intervals we want, here intervals from 0 to
6500 gram in intervals of 250 gram:</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">%&gt;%</span> </span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">body_mass_g</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu">geom_histogram</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu">seq</span><span class="op">(</span><span class="fl">0</span>,<span class="fl">6500</span>,<span class="fl">250</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Histogram with bins in 250 g steps from 0 to 6500 g"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">WARNING<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="warning" tabindex="0"><code>Warning: Removed 2 rows containing non-finite outside the scale range
(`stat_bin()`).</code></pre>
</div>
<p><img src="../fig/descript-stat-rendered-bin_breaks-1.png" style="display: block; margin: auto;" class="figure">
The histogram provides us with a visual indication of both range, the
variation of the values, and an idea about where the data is
located.</p>
</section><section><h2 class="section-heading" id="quartiles">Quartiles<a class="anchor" aria-label="anchor" href="#quartiles"></a>
</h2>
<hr class="half-width">
<p>The median can be understood as splitting the data in two equally
sized parts, where one is characterized by having values smaller than
the median and the other as having values larger than the median. It is
the value where 50% of the observations are smaller.</p>
<p>Similary we can calculate the value where 25% of the observations are
smaller.</p>
<p>That is often called the first quartile, where the median is the 50%,
or second quartile. Quartile implies four parts, and the existence of a
third or 75% quartile.</p>
<p>We can calcultate those using the quantile function:</p>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">quantile</span><span class="op">(</span><span class="va">penguins</span><span class="op">$</span><span class="va">body_mass_g</span>, probs <span class="op">=</span> <span class="fl">.25</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> 25%
3550 </code></pre>
</div>
<p>and</p>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">quantile</span><span class="op">(</span><span class="va">penguins</span><span class="op">$</span><span class="va">body_mass_g</span>, probs <span class="op">=</span> <span class="fl">.75</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> 75%
4750 </code></pre>
</div>
<div id="accordionInstructor6" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor6" aria-expanded="false" aria-controls="collapseInstructor6">
  <h3 class="accordion-header" id="headingInstructor6">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Instructor Note </h3>
</button>
<div id="collapseInstructor6" class="accordion-collapse collapse" aria-labelledby="headingInstructor6" data-bs-parent="#accordionInstructor6">
<div class="accordion-body">
<p>probs because if we select a random penguin, we have a 25% chance of
selecting a penguin that weighs less than 3550 gram. This ties in to
percentiles and qq-plots.</p>
</div>
</div>
</div>
</div>
<p>We are often interested in knowing the range in which 50% of the
observations fall.</p>
<p>That is used often enough that we have a dedicated function for
it:</p>
<div class="codewrapper sourceCode" id="cb39">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>iqr <span class="op">=</span> <span class="fu">IQR</span><span class="op">(</span><span class="va">body_mass_g</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 1 × 1
    iqr
  &lt;dbl&gt;
1  1200</code></pre>
</div>
<p>The name of the quantile function implies that we might have other
quantiles than quartiles. Actually we can calculate any quantile, eg the
2.5% quantile:</p>
<div class="codewrapper sourceCode" id="cb41">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">quantile</span><span class="op">(</span><span class="va">penguins</span><span class="op">$</span><span class="va">body_mass_g</span>, probs <span class="op">=</span> <span class="fl">.025</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>    2.5%
2988.125 </code></pre>
</div>
<p>The individual quantiles can be interesting in themselves. If we want
a visual representation of <em>all</em> quantiles, we can calculate all
of them, and plot them.</p>
<p>Instead of doing that by hand, we can use a concept called
<em>CDF</em> or cumulative density function:</p>
<div class="codewrapper sourceCode" id="cb43">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CDF</span> <span class="op">&lt;-</span> <span class="fu">ecdf</span><span class="op">(</span><span class="va">penguins</span><span class="op">$</span><span class="va">body_mass_g</span><span class="op">)</span></span>
<span><span class="va">CDF</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Empirical CDF
Call: ecdf(penguins$body_mass_g)
 x[1:94] =   2700,   2850,   2900,  ...,   6050,   6300</code></pre>
</div>
<p>That was not very informative. Lets plot it:</p>
<figure><img src="../fig/descript-stat-rendered-cdf-plot-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="accordionInstructor7" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor7" aria-expanded="false" aria-controls="collapseInstructor7">
  <h3 class="accordion-header" id="headingInstructor7">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Instructor Note </h3>
</button>
<div id="collapseInstructor7" class="accordion-collapse collapse" aria-labelledby="headingInstructor7" data-bs-parent="#accordionInstructor7">
<div class="accordion-body">
<p>den skal vi nok have beskrevet lidt mere.</p>
<p>Men pointen er, at vi for enhver værdi kan aflæse ting. Hvor stor en
andel af pingvinerne vejer mindre end 3000 g? Vi kan finde 3000 på
x-aksen, og aflæse den matchende værdi på y-aksen.</p>
<p>Det svarer også til - hvis vi tager en tilfældig pingvin, hvad er så
sandsynligheden for at den vejer mindre end 3000 gram? Eller for at den
vejer mere end 5000 gram?</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="measures-of-shape">Measures of shape<a class="anchor" aria-label="anchor" href="#measures-of-shape"></a>
</h2>
<hr class="half-width">
<div class="section level3">
<h3 id="skewness">Skewness<a class="anchor" aria-label="anchor" href="#skewness"></a>
</h3>
<p>We previously saw a histogram of the data, and noted that the
observations were skewed to the left, and that the “tail” on the right
was longer than on the left. That skewness can be quantised.</p>
<p>There is no function for skewness build into R, but we can get it
from the library <code>e1071</code></p>
<div class="codewrapper sourceCode" id="cb45">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">e1071</span><span class="op">)</span></span>
<span><span class="fu">skewness</span><span class="op">(</span><span class="va">penguins</span><span class="op">$</span><span class="va">body_mass_g</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 0.4662117</code></pre>
</div>
<p>The skewness is positive, indicating that the data are skewed to the
left, just as we saw. A negative skewness would indicate that the data
skew to the right.</p>
<div id="accordionInstructor8" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor8" aria-expanded="false" aria-controls="collapseInstructor8">
  <h3 class="accordion-header" id="headingInstructor8">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Instructor Note </h3>
</button>
<div id="collapseInstructor8" class="accordion-collapse collapse" aria-labelledby="headingInstructor8" data-bs-parent="#accordionInstructor8">
<div class="accordion-body">
<p>Nej, det er ikke på nogen måde intuitivt. Vi må nok finde ud af
hvorfor konventionen er som den er.</p>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="kurtosis">Kurtosis<a class="anchor" aria-label="anchor" href="#kurtosis"></a>
</h3>
<p>Another parameter describing the shape of the data is kurtosis. We
can think of that as either “are there too many observations in the
tails?” leading to a relatively low peak. Or, as “how pointy is the
peak” - because the majority of observations are centered in the peak,
rather than appearing in the tails.</p>
<p>We use the <code>e1071</code> package again:</p>
<div class="codewrapper sourceCode" id="cb47">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">kurtosis</span><span class="op">(</span><span class="va">penguins</span><span class="op">$</span><span class="va">body_mass_g</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] -0.73952</code></pre>
</div>
<p>Kurtosis is defined weirdly, and here we get “excess” kurtosis, the
actual kurtosis minus 3. We have negative kurtosis, indicating that the
peak is flat, and the tails are fat.</p>
</div>
</section><section><h2 class="section-heading" id="everything-everywhere-all-at-once">Everything Everywhere All at Once<a class="anchor" aria-label="anchor" href="#everything-everywhere-all-at-once"></a>
</h2>
<hr class="half-width">
<p>A lot of these descriptive values can be gotten for every variable in
the dataset using the <code>summary</code> function:</p>
<div class="codewrapper sourceCode" id="cb49">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">summary</span><span class="op">(</span><span class="va">penguins</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>      species          island    bill_length_mm  bill_depth_mm
 Adelie   :152   Biscoe   :168   Min.   :32.10   Min.   :13.10
 Chinstrap: 68   Dream    :124   1st Qu.:39.23   1st Qu.:15.60
 Gentoo   :124   Torgersen: 52   Median :44.45   Median :17.30
                                 Mean   :43.92   Mean   :17.15
                                 3rd Qu.:48.50   3rd Qu.:18.70
                                 Max.   :59.60   Max.   :21.50
                                 NA's   :2       NA's   :2
 flipper_length_mm  body_mass_g       sex           year
 Min.   :172.0     Min.   :2700   female:165   Min.   :2007
 1st Qu.:190.0     1st Qu.:3550   male  :168   1st Qu.:2007
 Median :197.0     Median :4050   NA's  : 11   Median :2008
 Mean   :200.9     Mean   :4202                Mean   :2008
 3rd Qu.:213.0     3rd Qu.:4750                3rd Qu.:2009
 Max.   :231.0     Max.   :6300                Max.   :2009
 NA's   :2         NA's   :2                                 </code></pre>
</div>
<p>Here we get the range, the 1st and 3rd quantiles (and from those the
IQR), the median and the mean and, rather useful, the number of missing
values in each variable.</p>
<p>We can also get all the descriptive values in one table, by adding
more than one summarizing function to the summarise function:</p>
<div class="codewrapper sourceCode" id="cb51">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>min <span class="op">=</span> <span class="fu">min</span><span class="op">(</span><span class="va">body_mass_g</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,</span>
<span>            max <span class="op">=</span> <span class="fu">max</span><span class="op">(</span><span class="va">body_mass_g</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,</span>
<span>            mean <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">body_mass_g</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,</span>
<span>            median <span class="op">=</span> <span class="fu">median</span><span class="op">(</span><span class="va">body_mass_g</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,</span>
<span>            stddev <span class="op">=</span> <span class="fu">sd</span><span class="op">(</span><span class="va">body_mass_g</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,</span>
<span>            var <span class="op">=</span> <span class="fu">var</span><span class="op">(</span><span class="va">body_mass_g</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,</span>
<span>            Q1 <span class="op">=</span> <span class="fu">quantile</span><span class="op">(</span><span class="va">body_mass_g</span>, probs <span class="op">=</span> <span class="fl">.25</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,</span>
<span>            Q3 <span class="op">=</span> <span class="fu">quantile</span><span class="op">(</span><span class="va">body_mass_g</span>, probs <span class="op">=</span> <span class="fl">.75</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,</span>
<span>            iqr <span class="op">=</span> <span class="fu">IQR</span><span class="op">(</span><span class="va">body_mass_g</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,</span>
<span>            skew <span class="op">=</span> <span class="fu">skewness</span><span class="op">(</span><span class="va">body_mass_g</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,</span>
<span>            kurtosis <span class="op">=</span> <span class="fu">kurtosis</span><span class="op">(</span><span class="va">body_mass_g</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 1 × 11
    min   max  mean median stddev     var    Q1    Q3   iqr  skew kurtosis
  &lt;int&gt; &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;
1  2700  6300 4202.   4050   802. 643131.  3550  4750  1200 0.466   -0.740</code></pre>
</div>
<p>As noted, we have three different species of penguins in the dataset.
Their weight varies a lot. If we want to do the summarising on each for
the species, we can group the data by species, before summarising:</p>
<div class="codewrapper sourceCode" id="cb53">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">species</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>min <span class="op">=</span> <span class="fu">min</span><span class="op">(</span><span class="va">body_mass_g</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,</span>
<span>            max <span class="op">=</span> <span class="fu">max</span><span class="op">(</span><span class="va">body_mass_g</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,</span>
<span>            mean <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">body_mass_g</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,</span>
<span>            median <span class="op">=</span> <span class="fu">median</span><span class="op">(</span><span class="va">body_mass_g</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,</span>
<span>            stddev <span class="op">=</span> <span class="fu">sd</span><span class="op">(</span><span class="va">body_mass_g</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 3 × 6
  species     min   max  mean median stddev
  &lt;fct&gt;     &lt;int&gt; &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
1 Adelie     2850  4775 3701.   3700   459.
2 Chinstrap  2700  4800 3733.   3700   384.
3 Gentoo     3950  6300 5076.   5000   504.</code></pre>
</div>
<p>We have removed some summary statistics in order to get a smaller
table.</p>
</section><section><h2 class="section-heading" id="boxplots">Boxplots<a class="anchor" aria-label="anchor" href="#boxplots"></a>
</h2>
<hr class="half-width">
<p>Finally boxplots offers a way of visualising some of the summary
statistics:</p>
<div class="codewrapper sourceCode" id="cb55">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">body_mass_g</span>, y <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_boxplot</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">WARNING<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="warning" tabindex="0"><code>Warning: Removed 2 rows containing non-finite outside the scale range
(`stat_boxplot()`).</code></pre>
</div>
<figure><img src="../fig/descript-stat-rendered-boxplots-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>The boxplot shows us the median (the fat line in the middel of each
box), the 1st and 3rd quartiles (the ends of the boxes), and the range,
with the whiskers at each end of the boxes, illustrating the minimum and
maximum. Any observations, more than 1.5 times the IQR from either the
1st or 3rd quartiles, are deemed as outliers and would be plotted as
individual points in the plot.</p>
</section><section><h2 class="section-heading" id="counting">Counting<a class="anchor" aria-label="anchor" href="#counting"></a>
</h2>
<hr class="half-width">
<p>Most of the descriptive functions above are focused on continuous
variables, maybe grouped by one or more categorical variables.</p>
<p>What about the categorical themselves?</p>
<p>The one thing we can do looking only at categorical variables, is
counting.</p>
<p>Counting the different values in a single categorical variable in
base-R is done using the <code>table(()</code> function</p>
<div class="codewrapper sourceCode" id="cb57">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">table</span><span class="op">(</span><span class="va">penguins</span><span class="op">$</span><span class="va">sex</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
female   male
   165    168 </code></pre>
</div>
<p>Often we are interested in cross tables, tables where we count the
different combinations of the values in more than one categorical
variable, eg the distribution of the two different penguin sexes on the
three different islands:</p>
<div class="codewrapper sourceCode" id="cb59">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">table</span><span class="op">(</span><span class="va">penguins</span><span class="op">$</span><span class="va">island</span>, <span class="va">penguins</span><span class="op">$</span><span class="va">sex</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
            female male
  Biscoe        80   83
  Dream         61   62
  Torgersen     24   23</code></pre>
</div>
<p>We can event group on three (or more) categorical variables, but the
output becomes increasingly difficult to read the mote variables we
add:</p>
<div class="codewrapper sourceCode" id="cb61">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">table</span><span class="op">(</span><span class="va">penguins</span><span class="op">$</span><span class="va">island</span>, <span class="va">penguins</span><span class="op">$</span><span class="va">sex</span>, <span class="va">penguins</span><span class="op">$</span><span class="va">species</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>, ,  = Adelie


            female male
  Biscoe        22   22
  Dream         27   28
  Torgersen     24   23

, ,  = Chinstrap


            female male
  Biscoe         0    0
  Dream         34   34
  Torgersen      0    0

, ,  = Gentoo


            female male
  Biscoe        58   61
  Dream          0    0
  Torgersen      0    0</code></pre>
</div>
</section><section><h2 class="section-heading" id="aggregate">Aggregate<a class="anchor" aria-label="anchor" href="#aggregate"></a>
</h2>
<hr class="half-width">
<p>A different way of doing that in base-R is using the
<code>aggregate()</code> function:</p>
<div class="codewrapper sourceCode" id="cb63">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">aggregate</span><span class="op">(</span><span class="va">sex</span> <span class="op">~</span> <span class="va">island</span>, data <span class="op">=</span> <span class="va">penguins</span>, FUN <span class="op">=</span> <span class="va">length</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>     island sex
1    Biscoe 163
2     Dream 123
3 Torgersen  47</code></pre>
</div>
<p>Here we construct the crosstable using the formula notation, and
specify which function we want to apply on the results. This can be used
to calculate summary statistics on groups, by adjusting the
<code>FUN</code> argument.</p>
</section><section><h2 class="section-heading" id="counting-in-tidyverse">Counting in tidyverse<a class="anchor" aria-label="anchor" href="#counting-in-tidyverse"></a>
</h2>
<hr class="half-width">
<p>In tidyverse we will typically group the data by the variables we
want to count, and then tallying them:</p>
<div class="codewrapper sourceCode" id="cb65">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">sex</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">tally</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 3 × 2
  sex        n
  &lt;fct&gt;  &lt;int&gt;
1 female   165
2 male     168
3 &lt;NA&gt;      11</code></pre>
</div>
<p><code>group_by</code> works equally well with more than one
group:</p>
<div class="codewrapper sourceCode" id="cb67">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">sex</span>, <span class="va">species</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">tally</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 8 × 3
# Groups:   sex [3]
  sex    species       n
  &lt;fct&gt;  &lt;fct&gt;     &lt;int&gt;
1 female Adelie       73
2 female Chinstrap    34
3 female Gentoo       58
4 male   Adelie       73
5 male   Chinstrap    34
6 male   Gentoo       61
7 &lt;NA&gt;   Adelie        6
8 &lt;NA&gt;   Gentoo        5</code></pre>
</div>
<p>But the output is in a long format, and often requires some
manipulation to get into a wider tabular format.</p>
<p>A shortcut exists in tidyverse, <code>count</code>, which combines
group_by and tally:</p>
<div class="codewrapper sourceCode" id="cb69">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">sex</span>, <span class="va">species</span><span class="op">)</span> </span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 8 × 3
  sex    species       n
  &lt;fct&gt;  &lt;fct&gt;     &lt;int&gt;
1 female Adelie       73
2 female Chinstrap    34
3 female Gentoo       58
4 male   Adelie       73
5 male   Chinstrap    34
6 male   Gentoo       61
7 &lt;NA&gt;   Adelie        6
8 &lt;NA&gt;   Gentoo        5</code></pre>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>We have access to a lot of summarising descriptive indicators the
the location, spread and shape of our data.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-table1"><p>Content from <a href="table1.html">Table One</a></p>
<hr>
<p>Last updated on 2025-04-15 |

        <a href="https://github.com/KUBDatalab/R-toolbox/edit/main/episodes/table1.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 12 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do you make a Table One?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Explain what a Table One is</li>
<li>Know how to make a Tabel One and adjust key parameters</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="what-is-a-table-one">What is a “Table One”?<a class="anchor" aria-label="anchor" href="#what-is-a-table-one"></a>
</h2>
<hr class="half-width">
<p>Primarily used in medical and epidemiological research, a Table One
is typically the first table in any publication using data.</p>
<p>It presents the baseline characteristics of the participants in a
study, and provides a concise overview of the relevant demographic and
clinical variables.</p>
<p>It typically compares different groups (male~female,
treatment~control), to highlight similarities and differences.</p>
<p>It can look like this:</p>
<!--html_preserve-->
<div class="Rtable1">
<table class="table Rtable1">
<thead>
<tr>
<th class="grouplabel">
</th>
<th colspan="2" class="grouplabel">
<div>
control
</div>
</th>
<th colspan="2" class="grouplabel">
<div>
case
</div>
</th>
<th colspan="2" class="grouplabel">
<div>
Overall
</div>
</th>
</tr>
<tr>
<th class="rowlabel firstrow lastrow">
</th>
<th class="firstrow lastrow">
<span class="stratlabel">no<br><span class="stratn">(N=298)</span></span>
</th>
<th class="firstrow lastrow">
<span class="stratlabel">yes<br><span class="stratn">(N=48)</span></span>
</th>
<th class="firstrow lastrow">
<span class="stratlabel">no<br><span class="stratn">(N=135)</span></span>
</th>
<th class="firstrow lastrow">
<span class="stratlabel">yes<br><span class="stratn">(N=29)</span></span>
</th>
<th class="firstrow lastrow">
<span class="stratlabel">no<br><span class="stratn">(N=433)</span></span>
</th>
<th class="firstrow lastrow">
<span class="stratlabel">yes<br><span class="stratn">(N=77)</span></span>
</th>
</tr>
</thead>
<tbody>
<tr>
<td class="rowlabel firstrow">
Age (years)
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
</tr>
<tr>
<td class="rowlabel">
Mean (SD)
</td>
<td>
61.3 (4.75)
</td>
<td>
58.9 (5.68)
</td>
<td>
61.5 (4.85)
</td>
<td>
58.1 (5.32)
</td>
<td>
61.4 (4.78)
</td>
<td>
58.6 (5.53)
</td>
</tr>
<tr>
<td class="rowlabel lastrow">
Median [Min, Max]
</td>
<td class="lastrow">
62.0 [46.0, 69.0]
</td>
<td class="lastrow">
59.0 [46.0, 68.0]
</td>
<td class="lastrow">
62.0 [45.0, 69.0]
</td>
<td class="lastrow">
58.0 [49.0, 68.0]
</td>
<td class="lastrow">
62.0 [45.0, 69.0]
</td>
<td class="lastrow">
58.0 [46.0, 68.0]
</td>
</tr>
<tr>
<td class="rowlabel firstrow">
testost
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
</tr>
<tr>
<td class="rowlabel">
Mean (SD)
</td>
<td>
25.3 (13.2)
</td>
<td>
22.2 (10.7)
</td>
<td>
27.6 (16.1)
</td>
<td>
28.2 (15.6)
</td>
<td>
26.0 (14.2)
</td>
<td>
24.4 (13.0)
</td>
</tr>
<tr>
<td class="rowlabel">
Median [Min, Max]
</td>
<td>
23.0 [4.00, 111]
</td>
<td>
21.5 [8.00, 63.0]
</td>
<td>
25.0 [6.00, 144]
</td>
<td>
24.0 [10.0, 69.0]
</td>
<td>
23.0 [4.00, 144]
</td>
<td>
22.0 [8.00, 69.0]
</td>
</tr>
<tr>
<td class="rowlabel lastrow">
Missing
</td>
<td class="lastrow">
6 (2.0%)
</td>
<td class="lastrow">
2 (4.2%)
</td>
<td class="lastrow">
3 (2.2%)
</td>
<td class="lastrow">
1 (3.4%)
</td>
<td class="lastrow">
9 (2.1%)
</td>
<td class="lastrow">
3 (3.9%)
</td>
</tr>
<tr>
<td class="rowlabel firstrow">
prolactn
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
</tr>
<tr>
<td class="rowlabel">
Mean (SD)
</td>
<td>
9.60 (5.10)
</td>
<td>
13.7 (12.3)
</td>
<td>
10.8 (6.79)
</td>
<td>
9.57 (3.29)
</td>
<td>
9.99 (5.70)
</td>
<td>
12.2 (10.1)
</td>
</tr>
<tr>
<td class="rowlabel">
Median [Min, Max]
</td>
<td>
8.16 [1.96, 37.3]
</td>
<td>
8.81 [3.87, 55.8]
</td>
<td>
9.30 [2.66, 59.9]
</td>
<td>
8.88 [4.49, 17.6]
</td>
<td>
8.64 [1.96, 59.9]
</td>
<td>
8.84 [3.87, 55.8]
</td>
</tr>
<tr>
<td class="rowlabel lastrow">
Missing
</td>
<td class="lastrow">
14 (4.7%)
</td>
<td class="lastrow">
0 (0%)
</td>
<td class="lastrow">
6 (4.4%)
</td>
<td class="lastrow">
1 (3.4%)
</td>
<td class="lastrow">
20 (4.6%)
</td>
<td class="lastrow">
1 (1.3%)
</td>
</tr>
</tbody>
</table>
</div>
<!--/html_preserve-->
<p>Please note that the automatic styling of this site results in a
table-one that is not very nice looking.</p>
<p>We have 510 participants in a study, split into control and case
groups, and further subdivided into two groups based on PostMenopausal
Hormone use. It describes the distribution of sex and concentration of
testosterone and prolactin in a blood sample.</p>
</section><section><h2 class="section-heading" id="how-do-we-make-that">How do we make that?<a class="anchor" aria-label="anchor" href="#how-do-we-make-that"></a>
</h2>
<hr class="half-width">
<div class="section level3">
<h3 id="structuring-the-data">Structuring the data<a class="anchor" aria-label="anchor" href="#structuring-the-data"></a>
</h3>
<p>Most things in R are simple to do (but rarely simple to understand)
when the data has the correct structure.</p>
<p>If we follow the general rules of thumb for tidy data, we are off to
a good start. This is the structure of the data set we are working with
here - after we have made some modifications as described above.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="va">blood</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 6 × 8
      ID matchid case    curpmh ageblood estradol testost prolactn
   &lt;dbl&gt;   &lt;dbl&gt; &lt;fct&gt;   &lt;fct&gt;     &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
1 100013  164594 control yes          46       57      25     11.1
2 100241  107261 control no           65       11      NA      2.8
3 100696  110294 control yes          66        3       8     38
4 101266  101266 case    no           57        4       6      8.9
5 101600  101600 case    no           66        6      25      6.9
6 102228  155717 control yes          57       10      31     13.9</code></pre>
</div>
<p>The important thing to note is that when we stratify the summary
statistics by some variable, this variable have to be a categorical
variable. The variables we want to do summary statistics <em>on</em>
also have to have the correct type. Are the values categorical, the
column in the dataframe have to actually be categorical. Are they
numeric, the data type have to be numeric.</p>
</div>
<div class="section level3">
<h3 id="and-having-the-data---how-do-we-actually-do-it">And having the data - how do we actually do it?<a class="anchor" aria-label="anchor" href="#and-having-the-data---how-do-we-actually-do-it"></a>
</h3>
<p>A number of packages making it easy to make a Table One exists. Here
we look at the package <code>table1</code>.</p>
<p>The specific way of doing it depends on the data available. If we do
not have data on the weight of the participants, we are not able to
describe the distribution of their weight.</p>
<p>Let us begin by looking at the data. We begin by loading the two
packages <code>tidyverse</code> and <code>table1</code>. We then read in
the data from the csv-file “BLOOD.csv”, which we have <a href="https://raw.githubusercontent.com/KUBDatalab/R-toolbox/main/episodes/data/BLOOD.csv" class="external-link">downloaded
from this link</a>.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">table1</span><span class="op">)</span></span>
<span><span class="va">blood</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"data/BLOOD.csv"</span><span class="op">)</span></span>
<span><span class="fu">head</span><span class="op">(</span><span class="va">blood</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 6 × 9
      ID matchid  case curpmh ageblood estradol estrone testost prolactn
   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
1 100013  164594     0      1       46       57      65      25     11.1
2 100241  107261     0      0       65       11      26     999      2.8
3 100696  110294     0      1       66        3     999       8     38
4 101266  101266     1      0       57        4      18       6      8.9
5 101600  101600     1      0       66        6      18      25      6.9
6 102228  155717     0      1       57       10     999      31     13.9</code></pre>
</div>
<p>510 rows. Its a case-control study, where the ID represents one
individual, and matchid gives us the link between cases and controls.
Ageblood is the age of the individual at the time when the blood sample
was drawn, and we then have levels of four different hormones.</p>
<p>The data contains missing values, coded as “999.0” for estrone and
testost, and 99.99 for prolactin.</p>
<p>Let us fix that:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">blood</span> <span class="op">&lt;-</span> <span class="va">blood</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>estrone <span class="op">=</span> <span class="fu">na_if</span><span class="op">(</span><span class="va">estrone</span>, <span class="fl">999.0</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>testost <span class="op">=</span> <span class="fu">na_if</span><span class="op">(</span><span class="va">testost</span>, <span class="fl">999.0</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>prolactn <span class="op">=</span> <span class="fu">na_if</span><span class="op">(</span><span class="va">prolactn</span>, <span class="fl">99.99</span><span class="op">)</span><span class="op">)</span> </span></code></pre>
</div>
<p>We then ensure that categorical values are stored as categorical
values, and adjust the labels of those categorical values:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">blood</span> <span class="op">&lt;-</span> <span class="va">blood</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>case <span class="op">=</span> <span class="fu">factor</span><span class="op">(</span><span class="va">case</span>, labels <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"control"</span>, <span class="st">"case"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>curpmh <span class="op">=</span> <span class="fu">factor</span><span class="op">(</span><span class="va">curpmh</span>, labels <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"no"</span>, <span class="st">"yes"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>And now we can make our table one like this. Note that we only
include testosterone and prolactin, in order to get a more manageble
table 1:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">table1</span><span class="op">(</span><span class="op">~</span><span class="va">ageblood</span> <span class="op">+</span> <span class="va">testost</span> <span class="op">+</span> <span class="va">prolactn</span><span class="op">|</span><span class="va">case</span> <span class="op">+</span> <span class="va">curpmh</span>, data <span class="op">=</span> <span class="va">blood</span><span class="op">)</span></span></code></pre>
</div>
<!--html_preserve-->
<div class="Rtable1">
<table class="table Rtable1">
<thead>
<tr>
<th class="grouplabel">
</th>
<th colspan="2" class="grouplabel">
<div>
control
</div>
</th>
<th colspan="2" class="grouplabel">
<div>
case
</div>
</th>
<th colspan="2" class="grouplabel">
<div>
Overall
</div>
</th>
</tr>
<tr>
<th class="rowlabel firstrow lastrow">
</th>
<th class="firstrow lastrow">
<span class="stratlabel">no<br><span class="stratn">(N=298)</span></span>
</th>
<th class="firstrow lastrow">
<span class="stratlabel">yes<br><span class="stratn">(N=48)</span></span>
</th>
<th class="firstrow lastrow">
<span class="stratlabel">no<br><span class="stratn">(N=135)</span></span>
</th>
<th class="firstrow lastrow">
<span class="stratlabel">yes<br><span class="stratn">(N=29)</span></span>
</th>
<th class="firstrow lastrow">
<span class="stratlabel">no<br><span class="stratn">(N=433)</span></span>
</th>
<th class="firstrow lastrow">
<span class="stratlabel">yes<br><span class="stratn">(N=77)</span></span>
</th>
</tr>
</thead>
<tbody>
<tr>
<td class="rowlabel firstrow">
ageblood
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
</tr>
<tr>
<td class="rowlabel">
Mean (SD)
</td>
<td>
61.3 (4.75)
</td>
<td>
58.9 (5.68)
</td>
<td>
61.5 (4.85)
</td>
<td>
58.1 (5.32)
</td>
<td>
61.4 (4.78)
</td>
<td>
58.6 (5.53)
</td>
</tr>
<tr>
<td class="rowlabel lastrow">
Median [Min, Max]
</td>
<td class="lastrow">
62.0 [46.0, 69.0]
</td>
<td class="lastrow">
59.0 [46.0, 68.0]
</td>
<td class="lastrow">
62.0 [45.0, 69.0]
</td>
<td class="lastrow">
58.0 [49.0, 68.0]
</td>
<td class="lastrow">
62.0 [45.0, 69.0]
</td>
<td class="lastrow">
58.0 [46.0, 68.0]
</td>
</tr>
<tr>
<td class="rowlabel firstrow">
testost
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
</tr>
<tr>
<td class="rowlabel">
Mean (SD)
</td>
<td>
25.3 (13.2)
</td>
<td>
22.2 (10.7)
</td>
<td>
27.6 (16.1)
</td>
<td>
28.2 (15.6)
</td>
<td>
26.0 (14.2)
</td>
<td>
24.4 (13.0)
</td>
</tr>
<tr>
<td class="rowlabel">
Median [Min, Max]
</td>
<td>
23.0 [4.00, 111]
</td>
<td>
21.5 [8.00, 63.0]
</td>
<td>
25.0 [6.00, 144]
</td>
<td>
24.0 [10.0, 69.0]
</td>
<td>
23.0 [4.00, 144]
</td>
<td>
22.0 [8.00, 69.0]
</td>
</tr>
<tr>
<td class="rowlabel lastrow">
Missing
</td>
<td class="lastrow">
6 (2.0%)
</td>
<td class="lastrow">
2 (4.2%)
</td>
<td class="lastrow">
3 (2.2%)
</td>
<td class="lastrow">
1 (3.4%)
</td>
<td class="lastrow">
9 (2.1%)
</td>
<td class="lastrow">
3 (3.9%)
</td>
</tr>
<tr>
<td class="rowlabel firstrow">
prolactn
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
</tr>
<tr>
<td class="rowlabel">
Mean (SD)
</td>
<td>
9.60 (5.10)
</td>
<td>
13.7 (12.3)
</td>
<td>
10.8 (6.79)
</td>
<td>
9.57 (3.29)
</td>
<td>
9.99 (5.70)
</td>
<td>
12.2 (10.1)
</td>
</tr>
<tr>
<td class="rowlabel">
Median [Min, Max]
</td>
<td>
8.16 [1.96, 37.3]
</td>
<td>
8.81 [3.87, 55.8]
</td>
<td>
9.30 [2.66, 59.9]
</td>
<td>
8.88 [4.49, 17.6]
</td>
<td>
8.64 [1.96, 59.9]
</td>
<td>
8.84 [3.87, 55.8]
</td>
</tr>
<tr>
<td class="rowlabel lastrow">
Missing
</td>
<td class="lastrow">
14 (4.7%)
</td>
<td class="lastrow">
0 (0%)
</td>
<td class="lastrow">
6 (4.4%)
</td>
<td class="lastrow">
1 (3.4%)
</td>
<td class="lastrow">
20 (4.6%)
</td>
<td class="lastrow">
1 (1.3%)
</td>
</tr>
</tbody>
</table>
</div>
<!--/html_preserve-->
<p>It is a good idea, and increases readability, to add labels and units
to the variables. The <code>table1</code> package provides functions for
that:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">label</span><span class="op">(</span><span class="va">blood</span><span class="op">$</span><span class="va">curpmh</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"current_pmh"</span></span>
<span><span class="fu">label</span><span class="op">(</span><span class="va">blood</span><span class="op">$</span><span class="va">case</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"case_control"</span></span>
<span><span class="fu">label</span><span class="op">(</span><span class="va">blood</span><span class="op">$</span><span class="va">ageblood</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"Age"</span></span>
<span><span class="fu">units</span><span class="op">(</span><span class="va">blood</span><span class="op">$</span><span class="va">ageblood</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"years"</span></span></code></pre>
</div>
<p>Which looks a bit nicer:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">table1</span><span class="op">(</span><span class="op">~</span><span class="va">ageblood</span> <span class="op">+</span> <span class="va">testost</span> <span class="op">+</span> <span class="va">prolactn</span><span class="op">|</span><span class="va">case</span> <span class="op">+</span> <span class="va">curpmh</span>, data <span class="op">=</span> <span class="va">blood</span><span class="op">)</span></span></code></pre>
</div>
<!--html_preserve-->
<div class="Rtable1">
<table class="table Rtable1">
<thead>
<tr>
<th class="grouplabel">
</th>
<th colspan="2" class="grouplabel">
<div>
control
</div>
</th>
<th colspan="2" class="grouplabel">
<div>
case
</div>
</th>
<th colspan="2" class="grouplabel">
<div>
Overall
</div>
</th>
</tr>
<tr>
<th class="rowlabel firstrow lastrow">
</th>
<th class="firstrow lastrow">
<span class="stratlabel">no<br><span class="stratn">(N=298)</span></span>
</th>
<th class="firstrow lastrow">
<span class="stratlabel">yes<br><span class="stratn">(N=48)</span></span>
</th>
<th class="firstrow lastrow">
<span class="stratlabel">no<br><span class="stratn">(N=135)</span></span>
</th>
<th class="firstrow lastrow">
<span class="stratlabel">yes<br><span class="stratn">(N=29)</span></span>
</th>
<th class="firstrow lastrow">
<span class="stratlabel">no<br><span class="stratn">(N=433)</span></span>
</th>
<th class="firstrow lastrow">
<span class="stratlabel">yes<br><span class="stratn">(N=77)</span></span>
</th>
</tr>
</thead>
<tbody>
<tr>
<td class="rowlabel firstrow">
Age (years)
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
</tr>
<tr>
<td class="rowlabel">
Mean (SD)
</td>
<td>
61.3 (4.75)
</td>
<td>
58.9 (5.68)
</td>
<td>
61.5 (4.85)
</td>
<td>
58.1 (5.32)
</td>
<td>
61.4 (4.78)
</td>
<td>
58.6 (5.53)
</td>
</tr>
<tr>
<td class="rowlabel lastrow">
Median [Min, Max]
</td>
<td class="lastrow">
62.0 [46.0, 69.0]
</td>
<td class="lastrow">
59.0 [46.0, 68.0]
</td>
<td class="lastrow">
62.0 [45.0, 69.0]
</td>
<td class="lastrow">
58.0 [49.0, 68.0]
</td>
<td class="lastrow">
62.0 [45.0, 69.0]
</td>
<td class="lastrow">
58.0 [46.0, 68.0]
</td>
</tr>
<tr>
<td class="rowlabel firstrow">
testost
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
</tr>
<tr>
<td class="rowlabel">
Mean (SD)
</td>
<td>
25.3 (13.2)
</td>
<td>
22.2 (10.7)
</td>
<td>
27.6 (16.1)
</td>
<td>
28.2 (15.6)
</td>
<td>
26.0 (14.2)
</td>
<td>
24.4 (13.0)
</td>
</tr>
<tr>
<td class="rowlabel">
Median [Min, Max]
</td>
<td>
23.0 [4.00, 111]
</td>
<td>
21.5 [8.00, 63.0]
</td>
<td>
25.0 [6.00, 144]
</td>
<td>
24.0 [10.0, 69.0]
</td>
<td>
23.0 [4.00, 144]
</td>
<td>
22.0 [8.00, 69.0]
</td>
</tr>
<tr>
<td class="rowlabel lastrow">
Missing
</td>
<td class="lastrow">
6 (2.0%)
</td>
<td class="lastrow">
2 (4.2%)
</td>
<td class="lastrow">
3 (2.2%)
</td>
<td class="lastrow">
1 (3.4%)
</td>
<td class="lastrow">
9 (2.1%)
</td>
<td class="lastrow">
3 (3.9%)
</td>
</tr>
<tr>
<td class="rowlabel firstrow">
prolactn
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
</tr>
<tr>
<td class="rowlabel">
Mean (SD)
</td>
<td>
9.60 (5.10)
</td>
<td>
13.7 (12.3)
</td>
<td>
10.8 (6.79)
</td>
<td>
9.57 (3.29)
</td>
<td>
9.99 (5.70)
</td>
<td>
12.2 (10.1)
</td>
</tr>
<tr>
<td class="rowlabel">
Median [Min, Max]
</td>
<td>
8.16 [1.96, 37.3]
</td>
<td>
8.81 [3.87, 55.8]
</td>
<td>
9.30 [2.66, 59.9]
</td>
<td>
8.88 [4.49, 17.6]
</td>
<td>
8.64 [1.96, 59.9]
</td>
<td>
8.84 [3.87, 55.8]
</td>
</tr>
<tr>
<td class="rowlabel lastrow">
Missing
</td>
<td class="lastrow">
14 (4.7%)
</td>
<td class="lastrow">
0 (0%)
</td>
<td class="lastrow">
6 (4.4%)
</td>
<td class="lastrow">
1 (3.4%)
</td>
<td class="lastrow">
20 (4.6%)
</td>
<td class="lastrow">
1 (1.3%)
</td>
</tr>
</tbody>
</table>
</div>
<!--/html_preserve-->
</div>
</section><section><h2 class="section-heading" id="more-advanced-stuff">More advanced stuff<a class="anchor" aria-label="anchor" href="#more-advanced-stuff"></a>
</h2>
<hr class="half-width">
<p>We might want to be able to precisely control the summary statistics
presented in the table.</p>
<p>We can do that by specifying input to the arguments
<code>render.continuous</code> and <code>render.categorical</code> that
control how continuous and categorical data respectively, is shown in
the table.</p>
<p>The simple way of doing that is by using abbrevieated function names.
We only include testosterone and prolactin in the the table to save
space:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">table1</span><span class="op">(</span><span class="op">~</span><span class="va">ageblood</span> <span class="op">+</span> <span class="va">testost</span> <span class="op">+</span> <span class="va">prolactn</span><span class="op">|</span><span class="va">case</span> <span class="op">+</span> <span class="va">curpmh</span>, data <span class="op">=</span> <span class="va">blood</span>,</span>
<span>        render.continuous<span class="op">=</span><span class="fu">c</span><span class="op">(</span>.<span class="op">=</span><span class="st">"Mean (SD%)"</span>, .<span class="op">=</span><span class="st">"Median [Min, Max]"</span>,</span>
<span>                           <span class="st">"Geom. mean (Geo. SD%)"</span><span class="op">=</span><span class="st">"GMEAN (GSD%)"</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<!--html_preserve-->
<div class="Rtable1">
<table class="table Rtable1">
<thead>
<tr>
<th class="grouplabel">
</th>
<th colspan="2" class="grouplabel">
<div>
control
</div>
</th>
<th colspan="2" class="grouplabel">
<div>
case
</div>
</th>
<th colspan="2" class="grouplabel">
<div>
Overall
</div>
</th>
</tr>
<tr>
<th class="rowlabel firstrow lastrow">
</th>
<th class="firstrow lastrow">
<span class="stratlabel">no<br><span class="stratn">(N=298)</span></span>
</th>
<th class="firstrow lastrow">
<span class="stratlabel">yes<br><span class="stratn">(N=48)</span></span>
</th>
<th class="firstrow lastrow">
<span class="stratlabel">no<br><span class="stratn">(N=135)</span></span>
</th>
<th class="firstrow lastrow">
<span class="stratlabel">yes<br><span class="stratn">(N=29)</span></span>
</th>
<th class="firstrow lastrow">
<span class="stratlabel">no<br><span class="stratn">(N=433)</span></span>
</th>
<th class="firstrow lastrow">
<span class="stratlabel">yes<br><span class="stratn">(N=77)</span></span>
</th>
</tr>
</thead>
<tbody>
<tr>
<td class="rowlabel firstrow">
Age (years)
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
</tr>
<tr>
<td class="rowlabel">
Mean (SD%)
</td>
<td>
61.3 (4.75%)
</td>
<td>
58.9 (5.68%)
</td>
<td>
61.5 (4.85%)
</td>
<td>
58.1 (5.32%)
</td>
<td>
61.4 (4.78%)
</td>
<td>
58.6 (5.53%)
</td>
</tr>
<tr>
<td class="rowlabel">
Median [Min, Max]
</td>
<td>
62.0 [46.0, 69.0]
</td>
<td>
59.0 [46.0, 68.0]
</td>
<td>
62.0 [45.0, 69.0]
</td>
<td>
58.0 [49.0, 68.0]
</td>
<td>
62.0 [45.0, 69.0]
</td>
<td>
58.0 [46.0, 68.0]
</td>
</tr>
<tr>
<td class="rowlabel lastrow">
Geom. mean (Geo. SD%)
</td>
<td class="lastrow">
61.1 (1.08%)
</td>
<td class="lastrow">
58.7 (1.10%)
</td>
<td class="lastrow">
61.3 (1.08%)
</td>
<td class="lastrow">
57.9 (1.10%)
</td>
<td class="lastrow">
61.2 (1.08%)
</td>
<td class="lastrow">
58.4 (1.10%)
</td>
</tr>
<tr>
<td class="rowlabel firstrow">
testost
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
</tr>
<tr>
<td class="rowlabel">
Mean (SD%)
</td>
<td>
25.3 (13.2%)
</td>
<td>
22.2 (10.7%)
</td>
<td>
27.6 (16.1%)
</td>
<td>
28.2 (15.6%)
</td>
<td>
26.0 (14.2%)
</td>
<td>
24.4 (13.0%)
</td>
</tr>
<tr>
<td class="rowlabel">
Median [Min, Max]
</td>
<td>
23.0 [4.00, 111]
</td>
<td>
21.5 [8.00, 63.0]
</td>
<td>
25.0 [6.00, 144]
</td>
<td>
24.0 [10.0, 69.0]
</td>
<td>
23.0 [4.00, 144]
</td>
<td>
22.0 [8.00, 69.0]
</td>
</tr>
<tr>
<td class="rowlabel">
Geom. mean (Geo. SD%)
</td>
<td>
22.4 (1.65%)
</td>
<td>
20.0 (1.58%)
</td>
<td>
24.6 (1.60%)
</td>
<td>
24.6 (1.69%)
</td>
<td>
23.1 (1.64%)
</td>
<td>
21.6 (1.63%)
</td>
</tr>
<tr>
<td class="rowlabel lastrow">
Missing
</td>
<td class="lastrow">
6 (2.0%)
</td>
<td class="lastrow">
2 (4.2%)
</td>
<td class="lastrow">
3 (2.2%)
</td>
<td class="lastrow">
1 (3.4%)
</td>
<td class="lastrow">
9 (2.1%)
</td>
<td class="lastrow">
3 (3.9%)
</td>
</tr>
<tr>
<td class="rowlabel firstrow">
prolactn
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
</tr>
<tr>
<td class="rowlabel">
Mean (SD%)
</td>
<td>
9.60 (5.10%)
</td>
<td>
13.7 (12.3%)
</td>
<td>
10.8 (6.79%)
</td>
<td>
9.57 (3.29%)
</td>
<td>
9.99 (5.70%)
</td>
<td>
12.2 (10.1%)
</td>
</tr>
<tr>
<td class="rowlabel">
Median [Min, Max]
</td>
<td>
8.16 [1.96, 37.3]
</td>
<td>
8.81 [3.87, 55.8]
</td>
<td>
9.30 [2.66, 59.9]
</td>
<td>
8.88 [4.49, 17.6]
</td>
<td>
8.64 [1.96, 59.9]
</td>
<td>
8.84 [3.87, 55.8]
</td>
</tr>
<tr>
<td class="rowlabel">
Geom. mean (Geo. SD%)
</td>
<td>
8.59 (1.58%)
</td>
<td>
10.7 (1.89%)
</td>
<td>
9.63 (1.58%)
</td>
<td>
9.05 (1.41%)
</td>
<td>
8.90 (1.59%)
</td>
<td>
10.1 (1.73%)
</td>
</tr>
<tr>
<td class="rowlabel lastrow">
Missing
</td>
<td class="lastrow">
14 (4.7%)
</td>
<td class="lastrow">
0 (0%)
</td>
<td class="lastrow">
6 (4.4%)
</td>
<td class="lastrow">
1 (3.4%)
</td>
<td class="lastrow">
20 (4.6%)
</td>
<td class="lastrow">
1 (1.3%)
</td>
</tr>
</tbody>
</table>
</div>
<!--/html_preserve-->
<p><code>table1</code> recognizes the following summary statisticis: N,
NMISS, MEAN, SD, CV, GMEAN, GCV, MEDIAN, MIN, MAX, IQR, Q1, Q2, Q3, T1,
T2, FREQ, PCT</p>
<p>Details can be found in the help to the function
<code>stats.default()</code></p>
<p>Note that they are case-insensitive, and we can write Median or
mediAn instead of median.</p>
<p>Also note that we write <code>.="Mean (SD%)"</code> which will be
recognized as the functions <code>mean()</code> and <code>sd()</code>,
but also that the label shown should be “Mean (SD%)”.</p>
<p>If we want to specify the label, we can write
<code>"Geom. mean (Geo. SD%)"="GMEAN (GSD%)"</code></p>
<div id="change-the-labels" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="change-the-labels" class="callout-inner">
<h3 class="callout-title">Change the labels</h3>
<div class="callout-content">
<p>We have two unusual values in this table - geometric mean and
geometric standard deviation. Change the code to write out “Geom.” and
“geo.” as geometric.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">table1</span><span class="op">(</span><span class="op">~</span><span class="va">ageblood</span> <span class="op">+</span> <span class="va">testost</span> <span class="op">+</span> <span class="va">prolactn</span> <span class="op">|</span><span class="va">case</span> <span class="op">+</span> <span class="va">curpmh</span>, data <span class="op">=</span> <span class="va">blood</span>,</span>
<span>        render.continuous<span class="op">=</span><span class="fu">c</span><span class="op">(</span>.<span class="op">=</span><span class="st">"Mean (SD%)"</span>, .<span class="op">=</span><span class="st">"Median [Min, Max]"</span>,</span>
<span>                           <span class="st">"Geometric mean (Geometric SD%)"</span><span class="op">=</span><span class="st">"GMEAN (GSD%)"</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>The geometric mean of two numbers is the squareroot of the product of
the two numbers. If we have three numbers, we take the cube root of the
product. In general:</p>
<p><span class="math display">\[\left( \prod_{i=1}^{n} x_i
\right)^{\frac{1}{n}}\]</span></p>
<p>The geometric standard deviation is defined by: <span class="math display">\[ \exp\left(\sqrt{\frac{1}{n} \sum_{i=1}^{n}
\left( \log x_i - \frac{1}{n} \sum_{j=1}^{n} \log x_j
\right)^2}\right)\]</span></p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="very-advanced-stuff">Very advanced stuff<a class="anchor" aria-label="anchor" href="#very-advanced-stuff"></a>
</h2>
<hr class="half-width">
<p>If we want to specify the summary statistics very precisely, we have
to define a function ourself:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_summary</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu">c</span><span class="op">(</span><span class="st">""</span>,<span class="st">"Median"</span> <span class="op">=</span> <span class="fu">sprintf</span><span class="op">(</span><span class="st">"%.3f"</span>, <span class="fu">median</span><span class="op">(</span><span class="va">x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span><span class="st">"Variance"</span> <span class="op">=</span> <span class="fu">sprintf</span><span class="op">(</span><span class="st">"%.1f"</span>, <span class="fu">var</span><span class="op">(</span><span class="va">x</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">table1</span><span class="op">(</span><span class="op">~</span><span class="va">ageblood</span> <span class="op">+</span> <span class="va">testost</span> <span class="op">+</span> <span class="va">prolactn</span><span class="op">|</span><span class="va">case</span> <span class="op">+</span> <span class="va">curpmh</span>, data <span class="op">=</span> <span class="va">blood</span>,</span>
<span>render.continuous <span class="op">=</span> <span class="va">my_summary</span><span class="op">)</span></span></code></pre>
</div>
<!--html_preserve-->
<div class="Rtable1">
<table class="table Rtable1">
<thead>
<tr>
<th class="grouplabel">
</th>
<th colspan="2" class="grouplabel">
<div>
control
</div>
</th>
<th colspan="2" class="grouplabel">
<div>
case
</div>
</th>
<th colspan="2" class="grouplabel">
<div>
Overall
</div>
</th>
</tr>
<tr>
<th class="rowlabel firstrow lastrow">
</th>
<th class="firstrow lastrow">
<span class="stratlabel">no<br><span class="stratn">(N=298)</span></span>
</th>
<th class="firstrow lastrow">
<span class="stratlabel">yes<br><span class="stratn">(N=48)</span></span>
</th>
<th class="firstrow lastrow">
<span class="stratlabel">no<br><span class="stratn">(N=135)</span></span>
</th>
<th class="firstrow lastrow">
<span class="stratlabel">yes<br><span class="stratn">(N=29)</span></span>
</th>
<th class="firstrow lastrow">
<span class="stratlabel">no<br><span class="stratn">(N=433)</span></span>
</th>
<th class="firstrow lastrow">
<span class="stratlabel">yes<br><span class="stratn">(N=77)</span></span>
</th>
</tr>
</thead>
<tbody>
<tr>
<td class="rowlabel firstrow">
Age (years)
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
</tr>
<tr>
<td class="rowlabel">
Median
</td>
<td>
62.000
</td>
<td>
59.000
</td>
<td>
62.000
</td>
<td>
58.000
</td>
<td>
62.000
</td>
<td>
58.000
</td>
</tr>
<tr>
<td class="rowlabel lastrow">
Variance
</td>
<td class="lastrow">
22.6
</td>
<td class="lastrow">
32.3
</td>
<td class="lastrow">
23.5
</td>
<td class="lastrow">
28.3
</td>
<td class="lastrow">
22.8
</td>
<td class="lastrow">
30.6
</td>
</tr>
<tr>
<td class="rowlabel firstrow">
testost
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
</tr>
<tr>
<td class="rowlabel">
Median
</td>
<td>
23.000
</td>
<td>
21.500
</td>
<td>
25.000
</td>
<td>
24.000
</td>
<td>
23.000
</td>
<td>
22.000
</td>
</tr>
<tr>
<td class="rowlabel">
Variance
</td>
<td>
173.6
</td>
<td>
115.0
</td>
<td>
257.7
</td>
<td>
241.9
</td>
<td>
200.4
</td>
<td>
169.0
</td>
</tr>
<tr>
<td class="rowlabel lastrow">
Missing
</td>
<td class="lastrow">
6 (2.0%)
</td>
<td class="lastrow">
2 (4.2%)
</td>
<td class="lastrow">
3 (2.2%)
</td>
<td class="lastrow">
1 (3.4%)
</td>
<td class="lastrow">
9 (2.1%)
</td>
<td class="lastrow">
3 (3.9%)
</td>
</tr>
<tr>
<td class="rowlabel firstrow">
prolactn
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
<td class="firstrow">
</td>
</tr>
<tr>
<td class="rowlabel">
Median
</td>
<td>
8.155
</td>
<td>
8.805
</td>
<td>
9.300
</td>
<td>
8.880
</td>
<td>
8.640
</td>
<td>
8.835
</td>
</tr>
<tr>
<td class="rowlabel">
Variance
</td>
<td>
26.1
</td>
<td>
151.3
</td>
<td>
46.1
</td>
<td>
10.8
</td>
<td>
32.5
</td>
<td>
102.8
</td>
</tr>
<tr>
<td class="rowlabel lastrow">
Missing
</td>
<td class="lastrow">
14 (4.7%)
</td>
<td class="lastrow">
0 (0%)
</td>
<td class="lastrow">
6 (4.4%)
</td>
<td class="lastrow">
1 (3.4%)
</td>
<td class="lastrow">
20 (4.6%)
</td>
<td class="lastrow">
1 (1.3%)
</td>
</tr>
</tbody>
</table>
</div>
<!--/html_preserve-->
<p>We do not <em>need</em> to use the <code>sprintf()</code> function,
but it is a very neat way of combining text with numeric variables
because it allows us to format them directly.</p>
<p>Summary statistics for categorical data can be adjusted similarly, by
specifying <code>render.categorical</code>.</p>
<div id="what-does-.3f-actually-do" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="what-does-.3f-actually-do" class="callout-inner">
<h3 class="callout-title">What does %.3f actually do?</h3>
<div class="callout-content">
<p>Can you guess what the formatting in ´sprintf´ does?</p>
<p>Try to change “%.3f” in the function to “%.2f”.</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_summary</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu">c</span><span class="op">(</span><span class="st">""</span>,<span class="st">"Median"</span> <span class="op">=</span> <span class="fu">sprintf</span><span class="op">(</span><span class="st">"%.3f"</span>, <span class="fu">median</span><span class="op">(</span><span class="va">x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span><span class="st">"Variance"</span> <span class="op">=</span> <span class="fu">sprintf</span><span class="op">(</span><span class="st">"%.1f"</span>, <span class="fu">var</span><span class="op">(</span><span class="va">x</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<p><code>sprintf</code> uses a bit of an arcane way of specifying the
way numbers should be formatted when we combine them with text. The
“%”-sign specifies that “this is where we place the number in the
function”. “.3f” specifies that we are treating the number as a floating
point number (which is just a fancy way of saying that it is a decimal
number), and that we would like three digits after the decimal
point.</p>
</div>
</div>
</div>
</div>
<div id="whats-up-with-that-blank-line" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="whats-up-with-that-blank-line" class="callout-inner">
<h3 class="callout-title">Whats up with that blank line?</h3>
<div class="callout-content">
<p>Note that in the function, we define a vector as output, with three
elements:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_summary</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu">c</span><span class="op">(</span><span class="st">""</span>,</span>
<span><span class="st">"Median"</span> <span class="op">=</span> <span class="fu">sprintf</span><span class="op">(</span><span class="st">"%.3f"</span>, <span class="fu">median</span><span class="op">(</span><span class="va">x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span><span class="st">"Variance"</span> <span class="op">=</span> <span class="fu">sprintf</span><span class="op">(</span><span class="st">"%.1f"</span>, <span class="fu">var</span><span class="op">(</span><span class="va">x</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<p>Calculating and formatting the median and the varianse is pretty
straightforward.</p>
<p>But the first element is an empty string. Whats up with that?</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<p>Try to remove the empty string from the function, and use it is a
table one as previously shown:</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_summary</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu">c</span><span class="op">(</span><span class="st">"Median"</span> <span class="op">=</span> <span class="fu">sprintf</span><span class="op">(</span><span class="st">"%.3f"</span>, <span class="fu">median</span><span class="op">(</span><span class="va">x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span><span class="st">"Variance"</span> <span class="op">=</span> <span class="fu">sprintf</span><span class="op">(</span><span class="st">"%.1f"</span>, <span class="fu">var</span><span class="op">(</span><span class="va">x</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">table1</span><span class="op">(</span><span class="op">~</span><span class="va">ageblood</span> <span class="op">+</span> <span class="va">testost</span> <span class="op">+</span> <span class="va">prolactn</span><span class="op">|</span><span class="va">case</span> <span class="op">+</span> <span class="va">curpmh</span>, data <span class="op">=</span> <span class="va">blood</span>,</span>
<span>render.continuous <span class="op">=</span> <span class="va">my_summary</span><span class="op">)</span></span></code></pre>
</div>
<p>The line beginning with “Median” does not show up, but the median
value is shown next to the “Age” and “Weight” lines.</p>
</div>
</div>
</div>
</div>
<div id="accordionInstructor1" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor1" aria-expanded="false" aria-controls="collapseInstructor1">
  <h3 class="accordion-header" id="headingInstructor1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Instructor Note </h3>
</button>
<div id="collapseInstructor1" class="accordion-collapse collapse" aria-labelledby="headingInstructor1" data-bs-parent="#accordionInstructor1">
<div class="accordion-body">
<p>Primarily of use if there are medical students on the course</p>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>A Table One provides a compact describtion of the data we are
working with</li>
<li>With a little bit of work we can control the content of the
table.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-tidy-data"><p>Content from <a href="tidy-data.html">Tidy Data</a></p>
<hr>
<p>Last updated on 2025-04-15 |

        <a href="https://github.com/KUBDatalab/R-toolbox/edit/main/episodes/tidy-data.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 12 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do we structure our data best?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Explain what tidy data is</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<hr class="half-width">
<p>Most of what we want to do with our data is relatively simple.
<em>If</em> the data is structured in the right way.</p>
<p>Working within the paradigm of <code>tidyverse</code> it is
preferable if the data is <em>tidy</em>.</p>
<figure><img src="../fig/tidy_why.jpg" alt="" class="figure mx-auto d-block"></figure><p>Tidy data is not the opposite of messy data. Data can be nice and
well structured, tidy as in non-messy, without being tidy in the way we
understand it in this context.</p>
<figure><img src="../fig/tidy_hadley_2.jpg" alt="" class="figure mx-auto d-block"></figure><p>Tidy data in the world of R, especially the dialect of R we call
tidyverse, are characterized by:</p>
<ul>
<li>Each variable is a column; each column is a variable.</li>
<li>Each observation is a row; each row is an observation.</li>
<li>Each value is a cell; each cell is a single value.</li>
</ul>
<figure><img src="../fig/tidy_hadley.jpg" alt="" class="figure mx-auto d-block"></figure><p>This way of structuring our data is useful not only in R, but also in
other software packages.</p>
</section><section><h2 class="section-heading" id="an-examples">An examples<a class="anchor" aria-label="anchor" href="#an-examples"></a>
</h2>
<hr class="half-width">
<p>This is an example of untidy data, on new cases of tubercolosis in
Afghanistan. It is well structured, however there are information in the
column names.</p>
<p>“new_sp_m014” describes “new” cases. Diagnosed with the “sp” method
(culturing a sample of sputum and identifying the presence of
Mycobacterium Tuberculosis bacteria). In “m” meaning males, between the
ages of 0 and 14.</p>
<p>Picking out information on all new cases eg. distribution between the
two sexes is difficult. Similar problems arise if we want to follow the
total number of new cases.</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 10 × 6
   country      year new_sp_m014 new_sp_m1524 new_sp_m2534 new_sp_m3544
   &lt;chr&gt;       &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;
 1 Afghanistan  2000          52          228          183          149
 2 Afghanistan  2001         129          379          349          274
 3 Afghanistan  2002          90          476          481          368
 4 Afghanistan  2003         127          511          436          284
 5 Afghanistan  2004         139          537          568          360
 6 Afghanistan  2005         151          606          560          472
 7 Afghanistan  2006         193          837          791          574
 8 Afghanistan  2007         186          856          840          597
 9 Afghanistan  2008         187          941          773          545
10 Afghanistan  2009         200          906          705          499</code></pre>
</div>
<p>Getting this data on a tidy format is not trivial, but a resulting,
tidy, organised dataset would look something like this:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 40 × 7
   country      year new   method sex   age_group cases
   &lt;fct&gt;       &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt;  &lt;fct&gt; &lt;fct&gt;     &lt;dbl&gt;
 1 Afghanistan  2000 new   sp     m     0-14         52
 2 Afghanistan  2000 new   sp     m     15-24       228
 3 Afghanistan  2000 new   sp     m     25-34       183
 4 Afghanistan  2000 new   sp     m     35-44       149
 5 Afghanistan  2001 new   sp     m     0-14        129
 6 Afghanistan  2001 new   sp     m     15-24       379
 7 Afghanistan  2001 new   sp     m     25-34       349
 8 Afghanistan  2001 new   sp     m     35-44       274
 9 Afghanistan  2002 new   sp     m     0-14         90
10 Afghanistan  2002 new   sp     m     15-24       476
# ℹ 30 more rows</code></pre>
</div>
<p>The fact that we are recording “new” cases is now a variable in it
self. The method used is also a variable, and the categorical variabel
sex is similarly a separate variable as is the age group.</p>
<p>The variables <code>new</code>, <code>method</code> and
<code>sex</code> might appear redundant - all values are identical,
however the entire dataset contains data on non-new cases, other methods
for diagnosis and the other sex, recorded as “f”.</p>
</section><section><h2 class="section-heading" id="dos-and-donts-in-excel">Do’s and dont’s in Excel<a class="anchor" aria-label="anchor" href="#dos-and-donts-in-excel"></a>
</h2>
<hr class="half-width">
<p>Excel is a very useful tool, especially for collecting data.</p>
<p>But even though we are able to do everything we can do in R, in
Excel, we will normally do the main part of our work with data in R.</p>
<p>It is therefor a very good idea to think about how we collect and
organise the data in Excel, to make our life easier later on.</p>
<p>We have collected some good rules of thumb for structuring data in
Excel, based on time-consuming and traumatic experiences wrangling data
from Excel to R.</p>
<p><strong>Always</strong></p>
<ul>
<li>Use one column for one variable</li>
<li>Use one row for one observation</li>
<li>Use one cell for one value</li>
<li>Begin your data in the upper left corner (cell A1)</li>
<li>Use one sheet for each type of data</li>
</ul>
<p><strong>Never (EVER!)</strong></p>
<ul>
<li>Modify your raw data - always make a copy before making any
change</li>
<li>Merge cells</li>
<li>Use colours for information</li>
</ul>
<p>Illustrations from the Openscapes blog Tidy Data for reproducibility,
efficiency, and collaboration by Julia Lowndes and Allison Horst</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>tidy data provides a consistent way of organizing data</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-normal-distribution"><p>Content from <a href="normal-distribution.html">The normal distribution</a></p>
<hr>
<p>Last updated on 2025-04-15 |

        <a href="https://github.com/KUBDatalab/R-toolbox/edit/main/episodes/normal-distribution.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 12 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What even is a normal distribution?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Explain how to use markdown with the new lesson template</li>
<li>Demonstrate how to include pieces of code, figures, and nested
challenge blocks</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="accordionInstructor1" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor1" aria-expanded="false" aria-controls="collapseInstructor1">
  <h3 class="accordion-header" id="headingInstructor1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Instructor Note </h3>
</button>
<div id="collapseInstructor1" class="accordion-collapse collapse" data-bs-parent="#accordionInstructor1" aria-labelledby="headingInstructor1">
<div class="accordion-body">
<p>Inline instructor notes can help inform instructors of timing
challenges associated with the lessons. They appear in the “Instructor
View”</p>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="what-is-the-normal-distribution">What is the normal distribution<a class="anchor" aria-label="anchor" href="#what-is-the-normal-distribution"></a>
</h2>
<hr class="half-width">
<p>A probability distribution is a mathematical function, that describes
the likelihood of different outcomes in a random experiment. It gives us
probabilities for all possible outcomes, and is normalised so that the
sum of all the probabilities is 1.</p>
<figure><img src="../fig/normal-distribution-rendered-4-distibutions-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Probability distributions can be discrete, or they can be continuous.
The normal distribution is just one of several different continuous
probability distributions.</p>
<p>The normal distribution is especially important, for a number of
reasons:</p>
<ol style="list-style-type: decimal">
<li><p>If we take a lot of samples from a population and calculate the
averages of a given variable in those samples, the averages, or means
will be normally distributed. This is know as the <a href="CLT-en.html">Central Limit Theorem</a>.</p></li>
<li><p>Many natural (and human made) processes follow a normal
distribution.</p></li>
<li><p>The normal distribution have useful mathematical properties. It
might not appear to be simple working with the normal distribution. But
the alternative is worse.</p></li>
<li><p>Many statistical methods and tests are based on assumptions of
normality.</p></li>
</ol></section><section><h2 class="section-heading" id="how-does-it-look---mathematically">How does it look - mathematically?<a class="anchor" aria-label="anchor" href="#how-does-it-look---mathematically"></a>
</h2>
<hr class="half-width">
<p>The normal distribution follows this formula:</p>
<p><span class="math display">\[
f(x) = \frac{1}{\sqrt{2\pi\sigma^2}} e^{-\frac{(x-\mu)^2}{2\sigma^2}}
\]</span></p>
<p>If a variable in our population is normally distributed, have a mean
<span class="math inline">\(\mu\)</span> and a standard deviation <span class="math inline">\(\sigma\)</span>, we can find the probability of
observing the value <span class="math inline">\(x\)</span> of the
varibel by plugging in the values, and calculate <span class="math inline">\(f(x)\)</span>.</p>
<p>Note that we are here working with the population mean and standard
deviation. Those are the “true” mean and standard deviation for the
<em>entire</em> universe. That is signified by using the greek letters
<span class="math inline">\(\mu\)</span> and <span class="math inline">\(\sigma\)</span>. In practise we do not know what
those true values are.</p>
<div id="what-does-it-mean-that-our-data-is-normally-distributed" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="what-does-it-mean-that-our-data-is-normally-distributed" class="callout-inner">
<h3 class="callout-title">What does it mean that our data is normally distributed</h3>
<div class="callout-content">
<p>We have an entire section on that - but in short: The probabilities
we get from the formula above should match the frequencies we observe in
our data.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="how-does-it-look--graphically">How does it look- graphically?<a class="anchor" aria-label="anchor" href="#how-does-it-look--graphically"></a>
</h2>
<hr class="half-width">
<p>It is useful to be able to compare the distributions of different
variables. That can be difficult if one have a mean of 1000, and the
other have a mean of 2. Therefore we often work with standardized normal
distributions, where we transform the data to have a mean of 0 and a
standard deviation of 1. So let us look at the standardized normal
distribution.</p>
<p>If we plot it, it looks like this:</p>
<p><img src="../fig/The_Normal_Distribution.svg" alt="The Normal Distribution." class="figure"> The area under the curve is 1,
equivalent to 100%.</p>
<p>The normal distribution have a lot of nice mathematical properties,
some of which are indicated on the graph.</p>
</section><section><h2 class="section-heading" id="so---what-is-the-probability">So - what <em>is</em> the probability?<a class="anchor" aria-label="anchor" href="#so---what-is-the-probability"></a>
</h2>
<hr class="half-width">
<p>The normal distribution curve tell what the probability density for a
given observation is. But in general we are interested in the
probability that something is larger, or smaller, than something. Or
between certain values.</p>
<p>Rather that plotting the probability density, we can plot the
cumulative density.</p>
<figure><img src="../fig/normal-distribution-rendered-cdf-plot-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Note that we also find the cumulitive probability in the original
plot of the normal distribution - now it is a bit more direct.</p>
<p>This allow us to see that the probability of observing a value that
is 2 standard deviations smaller than the mean is rather small.</p>
<p>We can also, more indirectly, note that the probability of observing
a value that is 2 standard deviations larger than the mean is rather
small. Note that the probability of an observation that is smaller than
2 standard deviations larger than the mean is 97.7% (hard to read on the
graph, but we will get to that). Since the total probability is 100%,
the probability of an observation being larger than 2 standard
deviations is 100 - 97.7 = 2.3%</p>
</section><section><h2 class="section-heading" id="do-not-read-the-graph---do-the-calculation">Do not read the graph - do the calculation<a class="anchor" aria-label="anchor" href="#do-not-read-the-graph---do-the-calculation"></a>
</h2>
<hr class="half-width">
<p>Instead of trying to measure the values on the graph, we can do the
calculations directly.</p>
<p>R provides us with a set of functions:</p>
<ul>
<li>
<em>pnorm</em> returns the probability of having a smaller value
than x</li>
<li>
<em>qnorm</em> the value x corresponding to a given probability</li>
<li>
<em>dnorm</em> returns the probability density of the normal
distribution at a given x.</li>
</ul>
<p>We have an additional <em>rnorm</em> that returns a random value,
drawn from a normal distribution.</p>
<div id="try-it-your-self" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="try-it-your-self" class="callout-inner">
<h3 class="callout-title">Try it your self!</h3>
<div class="callout-content">
<p>Assuming that our observations are normally distributed with a mean
of 0 and a standard deviation of 1.</p>
<p>What is the probability of an observation x &lt; 2?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pnorm</span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 0.9772499</code></pre>
</div>
<p>About 98% of the observations are smaller than 2</p>
</div>
</div>
</div>
</div>
<div id="challenge2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p>Making the same assumptions, what is the value of the observation,
for which 42% of the observations is smaller?</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">qnorm</span><span class="op">(</span><span class="fl">0.42</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] -0.2018935</code></pre>
</div>
<p>42% of the observations are smaller than -0.2</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="what-about-other-means-and-standard-deviations">What about other means and standard deviations?<a class="anchor" aria-label="anchor" href="#what-about-other-means-and-standard-deviations"></a>
</h2>
<hr class="half-width">
<p>Being able to find out what the probablity of some observation being
smaller when the mean is 0 and the standard deviation is 1, is nice. But
this is not a common problem.</p>
<p>Rather we might know that adult men in a given country have an
average height of 183 cm, and that the standard deviation of their
height is 9.7 cm.</p>
<p>What is the probability to encounter a man that is taller than 2
meters?</p>
<p>The R-functions handle this easily, we “simply” specify the mean and
standard deviation in the function:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">1</span> <span class="op">-</span> <span class="fu">pnorm</span><span class="op">(</span><span class="fl">200</span>, mean <span class="op">=</span> <span class="fl">183</span>, sd <span class="op">=</span> <span class="fl">9.7</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 0.03983729</code></pre>
</div>
<p>The function calculate the probability of a man being shorter than
200 cm, if the distribution is normal and the mean and standard devation
is 183 and 9.7 respectively. The probability of the man having a height
is 1 (equivalent to 100%). So if the probability of the man being
shorter than 200 cm is 96%, the probability of him being taller than 200
cm is 4%</p>
<div id="accordionSpoiler1" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler1" aria-expanded="false" aria-controls="collapseSpoiler1">
  <h3 class="accordion-header" id="headingSpoiler1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div> How does that work? </h3>
</button>
<div id="collapseSpoiler1" class="accordion-collapse collapse" data-bs-parent="#accordionSpoiler1" aria-labelledby="headingSpoiler1">
<div class="accordion-body">
<p>We have a lot of men with an average height of 183. They all have an
individual heigth. If we subtract 183 from their height, and use that as
a measurement of their height, that will have a mean of 0.</p>
<p>We are not going into the details, but if we divide all the heights
with the original standard deviation, and do all the math, we will
discover that the standard deviation of the new heights will be 1.</p>
<p>Therefore, if we subtract 183 from all the individual heights, and
divide them by 9.7, the resulting measurements of the heights have a
mean of 0 and a standard deviation of 1. Bringing all that together, we
get:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">1</span> <span class="op">-</span> <span class="fu">pnorm</span><span class="op">(</span><span class="op">(</span><span class="fl">200</span><span class="op">-</span><span class="fl">183</span><span class="op">)</span><span class="op">/</span><span class="fl">9.7</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 0.03983729</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="how-many-men-are-in-an-interval" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="how-many-men-are-in-an-interval" class="callout-inner">
<h3 class="callout-title">How many men are in an interval?</h3>
<div class="callout-content">
<p>How many men have a height between 170 and 190 cm?</p>
<p>Assume mean = 183 cm and sd = 9.7</p>
</div>
</div>
</div>
<div id="accordionSpoiler2" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler2" aria-expanded="false" aria-controls="collapseSpoiler2">
  <h3 class="accordion-header" id="headingSpoiler2">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div> Hint </h3>
</button>
<div id="collapseSpoiler2" class="accordion-collapse collapse" data-bs-parent="#accordionSpoiler2" aria-labelledby="headingSpoiler2">
<div class="accordion-body">
<p>What proportion of men are shorter than 190 cm? And what proportion
of men are shorter than 170 cm?</p>
</div>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pnorm</span><span class="op">(</span><span class="fl">190</span>, mean <span class="op">=</span><span class="fl">183</span>, sd <span class="op">=</span> <span class="fl">9.7</span> <span class="op">)</span>  <span class="op">-</span> <span class="fu">pnorm</span><span class="op">(</span><span class="fl">170</span>, mean <span class="op">=</span> <span class="fl">183</span>, sd <span class="op">=</span> <span class="fl">9.7</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 0.6746558</code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="clt">CLT<a class="anchor" aria-label="anchor" href="#clt"></a>
</h2>
<hr class="half-width">
<p>But my data is not normally distributed?</p>
<p>No, it is not. Actually most data is not normally distributed. Often
it <em>cannot</em> be normally distributed. Serum molybdenum, an
essential trace metal in human physiology has a mean of 1.55 and a
standard deviation of 0.74 in normal healthy adult humans.</p>
<div id="how-many-danes-have-negative-serum-molybdenum" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="how-many-danes-have-negative-serum-molybdenum" class="callout-inner">
<h3 class="callout-title">How many danes have negative serum molybdenum?</h3>
<div class="callout-content">
<p>Assuming an adult population of 5000000 danes, a mean of 1.55 and a
standard deviation of 0.74, how many danes have a negative concentration
of Molybdenum (Mo) in their blood?</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4"> Show me the solution </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" data-bs-parent="#accordionSolution4" aria-labelledby="headingSolution4">
<div class="accordion-body">
<p>We begin by calculating the probability of observing a Mo
concentration lower than 0:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pnorm</span><span class="op">(</span><span class="fl">0</span>, mean <span class="op">=</span> <span class="fl">1.55</span>, sd <span class="op">=</span> <span class="fl">0.74</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 0.01810352</code></pre>
</div>
<p>We then multiply by the number of people:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">5000000</span><span class="op">*</span><span class="fl">0.01810352</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 90517.6</code></pre>
</div>
<p>About 90000 adult danes have not only none, but actually negative
amounts of Molybdenum in their blood. Which is impossible.</p>
</div>
</div>
</div>
</div>
<p>So - your data is not normally distributed. But the properties of
your samples are!</p>
<p>We are not actually measuring the average height of all men in the
world ever. We are taking a sample, and calculating the mean. And
standard deviation. And proportion.</p>
<p>And those, the mean etc, <em>are</em> normally distributed, even if
the underlying distribution of the population is not.</p>
<p>The Central Limit Theorem allow us to assume that, if we take enough
random samples, the mean and standard deviation of these samples, will
be normally distributed.</p>
<p>This is what we use when doing statistical tests. We posit a
null-hypothesis that the “true” mean of some value should be something.
We take a sample, and calculate the mean. And using the normal
distribution, we can look at the CDF-plot above, and determine the
probability of seeing the value we get.</p>
<p>In practice we are usually not using the normal distribution, but
rather the t-distribution, to correct for the fact that we do not
actually know the true mean and varians/standard deviation of the
population. It gives us a more conservative estimate taht is more likely
to be “true”.</p>
<div id="what-is-normal" class="callout testimonial">
<div class="callout-square">
<i class="callout-icon" data-feather="heart"></i>
</div>
<div id="what-is-normal" class="callout-inner">
<h3 class="callout-title">What is normal?</h3>
<div class="callout-content">
<p>The normal distribution is normal, because Karl Pearson and Francis
Galton in the 19th century took a lot of samples of different
phenomenons in the population data. Height, weight, intelligence etc.
Calculating the mean (and other descriptive statistical parameters) they
noted that these means followed a specific distribution. This was not
the case for every phenomenon. But for a lot.</p>
<p>Looking at the distributions describing a lot of phenomenons, the
most common was one specific distribution.</p>
<p>In descriptive statistics, the normal observation is simply the most
frequent. In this set of numbers:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1 2 3 4 5 5</code></pre>
</div>
<p>5 is the normal observation - because it is the most frequent, even
if it only represents 20% of the observations. In a statistical sense
normal is not normative. The normal colour eye among humans is brown.
Not because there is anything wrong with other colours, but simply
because brown is the most frequent.</p>
<p>The most frequent, ie normal, distribution found, was named the
normal distribution.</p>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Use <code>.md</code> files for episodes when you want static
content</li>
<li>Use <code>.Rmd</code> files for episodes when you need to generate
output</li>
<li>Run <code>sandpaper::check_lesson()</code> to identify any issues
with your lesson</li>
<li>Run <code>sandpaper::build_lesson()</code> to preview your lesson
locally</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-is-it-normal"><p>Content from <a href="is-it-normal.html">Testing for normality</a></p>
<hr>
<p>Last updated on 2025-04-15 |

        <a href="https://github.com/KUBDatalab/R-toolbox/edit/main/episodes/is-it-normal.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 12 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do we determine if a dataset might be normally distributed?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Explain how to visually estimate normality</li>
<li>Explain how to get numerical indications of normality</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>A common question is: Is my data normally distributed?</p>
<p>Before panicking make sure that it actually is a problem that your
data might not be normally distributed. Making a linear regression eg
does not require the data to be normally distributed.</p>
<p>On the other hand, a linear regression requires the residuals to be
normally distributed. So it is useful to be able to determine if it
is.</p>
<div class="section level3">
<h3 id="what-does-it-mean-that-it-is-normally-distributed">What does it mean that it is normally distributed?<a class="anchor" aria-label="anchor" href="#what-does-it-mean-that-it-is-normally-distributed"></a>
</h3>
<p>It means that the distribution of our data has the same properties as
the normal distribution.</p>
<p>Let us get some data that we can test, first by loading the
<code>palmerpenguins</code> dataset:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">palmerpenguins</span><span class="op">)</span></span></code></pre>
</div>
<p>And then by extracting the bill depth of chinstrap penguins:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">normal_test_data</span> <span class="op">&lt;-</span> <span class="va">penguins</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">species</span> <span class="op">==</span> <span class="st">"Chinstrap"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">bill_depth_mm</span><span class="op">)</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="mean-and-median">Mean and median<a class="anchor" aria-label="anchor" href="#mean-and-median"></a>
</h3>
<p>One of the properties of the normal distribution is that the mean and
median of the data is equal. Let us look at the penguins:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">summary</span><span class="op">(</span><span class="va">normal_test_data</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> bill_depth_mm
 Min.   :16.40
 1st Qu.:17.50
 Median :18.45
 Mean   :18.42
 3rd Qu.:19.40
 Max.   :20.80  </code></pre>
</div>
<p>This is actually pretty close! But equality between median and mean
is a neccesary, not a sufficient condition.</p>
<p>What next. A histogram of the data should look normal. Let us take a
closer look at bill_depth_mm where mean and median are closest:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">normal_test_data</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">bill_depth_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<figure><img src="../fig/is-it-normal-rendered-histogram-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>A normal distribution would have this shape:</p>
<p><img src="../fig/is-it-normal-rendered-normal_curve-1.png" style="display: block; margin: auto;" class="figure">
Our histogram does not really look like the theoretical curve. The fact
that mean and median are almost identical was not a sufficient criterium
for normalcy.</p>
<p>The shape of a histogram is heavily dependent on the bins we choose.
Density plots are often a better way of visualizing the
distribution:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">normal_test_data</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">bill_depth_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_density</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/is-it-normal-rendered-densityplot-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>We can think of this as a histogram with infinitely small bins.</p>
<p>This does look more normal - but it would be nice to be able to
quantize the degree of normalcy.</p>
</div>
<section><h2 class="section-heading" id="percentiels-and-qq-plots-as-a-test">Percentiels and QQ-plots as a test<a class="anchor" aria-label="anchor" href="#percentiels-and-qq-plots-as-a-test"></a>
</h2>
<hr class="half-width">
<p>We know a lot about the properties of the normal distribution.</p>
<ul>
<li>50% of the observations in the data are smaller than the mean
<ul>
<li>conversely 50% are larger.</li>
</ul>
</li>
<li>We also know that 50% of the observations should be in the
interquartile range.</li>
<li>2.5% of the observations (the 2.5 percentile) are smaller than the
mean minus 1.96 times the standard deviation.</li>
</ul>
<p>And for each of the observations we actually have, we can calculate
which quantile, or percentile it <em>is</em> in. And we can calculate
what percentile it <em>should</em> be in.</p>
<p>Comparing those gives us an indication of how well the data conforms
to a normal distribution.</p>
<p>Rather than doing that by hand, we can get R to do it for us in a
nice graphical way:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">normal_test_data</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>sample <span class="op">=</span> <span class="va">bill_depth_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_qq</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_qq_line</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/is-it-normal-rendered-qq-plot-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>The <code>geom_qq</code> function calculate and plots which
percentile an observation is in.</p>
<p>Rather than being given percentiles, we are given the value that the
percentile corresponds to if we calculate it as number of standard
deviations from the mean.</p>
<p>This results in plots that are more comparable.</p>
<p><code>geom_qq_line</code> plots the line corresponding til the values
the percentiles should have, if the data was normally distributed.</p>
<p>A common theme is that the midle of the data falls relatively close
to the line, and that there are deviations from the line at both ends.
In this case the deviations are largish, indicating that the data is not
normally distributed.</p>
<div id="accordionSpoiler1" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler1" aria-expanded="false" aria-controls="collapseSpoiler1">
  <h3 class="accordion-header" id="headingSpoiler1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div> How skewed is the plot? </h3>
</button>
<div id="collapseSpoiler1" class="accordion-collapse collapse" data-bs-parent="#accordionSpoiler1" aria-labelledby="headingSpoiler1">
<div class="accordion-body">
<p>We have two tails in the qq-plot, a left and a right. And they can be
either above or below the qq-line.</p>
<p>That results in four different cases, that informs us about what is
wrong with the data - in regards to how it deviates from normalcy.</p>
<table class="table">
<colgroup>
<col width="15%">
<col width="15%">
<col width="15%">
<col width="54%">
</colgroup>
<thead><tr class="header">
<th>Left tail</th>
<th>Right tail</th>
<th>Name</th>
<th>What</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Above</td>
<td>Below</td>
<td>Leptokurtic</td>
<td>Heavier tails - ie. more extreme values. Higher kurtosis</td>
</tr>
<tr class="even">
<td>Below</td>
<td>Above</td>
<td>Platykurtic</td>
<td>Lighter tails - ie. fewer extreme values. Lower kurtosis</td>
</tr>
<tr class="odd">
<td>Above</td>
<td>Above</td>
<td>Right skewed</td>
<td>A tail that stretches to the higher values - the extreme values are
larger.</td>
</tr>
<tr class="even">
<td>Below</td>
<td>Below</td>
<td>Left skewed</td>
<td>A tail that stretches to the lower values - the extreme values are
smaller.</td>
</tr>
</tbody>
</table>
<figure><img src="../fig/is-it-normal-rendered-different_kurtoses-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="numerical-measures-rather-than-graphical">Numerical measures rather than graphical<a class="anchor" aria-label="anchor" href="#numerical-measures-rather-than-graphical"></a>
</h2>
<hr class="half-width">
<p>With experience the qq-plots can be used to determine if the data is
normally distributed - the points are exactly on the line. But only
rarely will the points match exactly - even if the data is normally
distributed <em>enough</em>. And how much can the tails deviate from the
line before the data is not normally distributed <em>enough</em>?</p>
<p>The deviations can be described numerically using two parameters:</p>
<p>Kurtosis and skewness.</p>
<p>Base-R do not have functions for this, but the package
<code>e1071</code> does:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">e1071</span><span class="op">)</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="skewness">Skewness<a class="anchor" aria-label="anchor" href="#skewness"></a>
</h4>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">skewness</span><span class="op">(</span><span class="va">normal_test_data</span><span class="op">$</span><span class="va">bill_depth_mm</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 0.006578141</code></pre>
</div>
<p>As a rule of thumb, skewness should be within +/-0.5 if the data is
normally distributed. Values between +/-0.5 and +/- 1 indicates a
moderate skewness, where data <em>can</em> still be approximately
normally distributed. Values larger that +/-1 indicates a significant
skewness, and the data is probably not normally distributed.</p>
</div>
<div class="section level4">
<h4 id="kurtosis">Kurtosis<a class="anchor" aria-label="anchor" href="#kurtosis"></a>
</h4>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">kurtosis</span><span class="op">(</span><span class="va">normal_test_data</span><span class="op">$</span><span class="va">bill_depth_mm</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] -0.960087</code></pre>
</div>
<p>Evaluating the kurtosis is a bit more complicated as the kurtosis for
a normal distribution is 3. We therefore look at excess kurtosis, where
we subtract 3 from the calculated kurtosis. * An value of +/-1 excess
kurtosis indicates that the data has a ‘tailedness’ close to the normal
distribution. * Values between +/-1 and +/-2 indicates a moderate
deviation from the normal distribution, but the data can still be
approximately normally distributed. * Values larger than +/-2 is in
general taken as an indication that the data is not normally
distributed.</p>
</div>
</section><section><h2 class="section-heading" id="more-direct-tests">More direct tests<a class="anchor" aria-label="anchor" href="#more-direct-tests"></a>
</h2>
<hr class="half-width">
<p>The question of whether or not data is normally distributed is
important in many contexts, and it should come as no surprise that a
multitude of tests has been devised for testing exactly that.</p>
<div id="accordionInstructor1" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor1" aria-expanded="false" aria-controls="collapseInstructor1">
  <h3 class="accordion-header" id="headingInstructor1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Instructor Note </h3>
</button>
<div id="collapseInstructor1" class="accordion-collapse collapse" data-bs-parent="#accordionInstructor1" aria-labelledby="headingInstructor1">
<div class="accordion-body">
<p>These tests can be difficult for learners that have not encountered
hypothesis-testing before.</p>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="shapiro-wilk">Shapiro-Wilk<a class="anchor" aria-label="anchor" href="#shapiro-wilk"></a>
</h3>
<p>The Shapiro-Wilk test is especially suited for small sample sizes
(&lt;50, some claim it works well up to &lt;2000).</p>
<p>It is a measure of the linear correlation between data and the
normally distributed quantiles, what we see in the qqplot.</p>
<p>The null-hypothesis is that data is normally distributed, and the
Shapiro-Wilk test returns a p-value reporting the risk of being wrong if
we reject the null-hypothesis.</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">shapiro.test</span><span class="op">(</span><span class="va">normal_test_data</span><span class="op">$</span><span class="va">bill_depth_mm</span><span class="op">)</span> </span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
	Shapiro-Wilk normality test

data:  normal_test_data$bill_depth_mm
W = 0.97274, p-value = 0.1418</code></pre>
</div>
<p>The p-value in this case is 0.1418 - and we do not have enough
evidense to reject the null-hypothesis. The data is probably normally
distributed.</p>
</div>
<div class="section level3">
<h3 id="kolmogorov-smirnov">Kolmogorov-Smirnov<a class="anchor" aria-label="anchor" href="#kolmogorov-smirnov"></a>
</h3>
<p>The KS-test allows us to test if the data is distributed as a lot of
different distributions, not only the normal distribution. Because of
this, we need to specify the specific distribution we are testing for,
in this case a normal distribution with specific values for mean and
standard deviation.</p>
<p>Therefore we need to calculate those:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mean</span> <span class="op">&lt;-</span> <span class="fu">mean</span><span class="op">(</span><span class="va">normal_test_data</span><span class="op">$</span><span class="va">bill_depth_mm</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">sd</span> <span class="op">&lt;-</span> <span class="fu">sd</span><span class="op">(</span><span class="va">normal_test_data</span><span class="op">$</span><span class="va">bill_depth_mm</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">ks.test</span><span class="op">(</span><span class="va">normal_test_data</span><span class="op">$</span><span class="va">bill_depth_mm</span>, <span class="st">"pnorm"</span>, mean <span class="op">=</span> <span class="va">mean</span>, sd <span class="op">=</span> <span class="va">sd</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">WARNING<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="warning" tabindex="0"><code>Warning in ks.test.default(normal_test_data$bill_depth_mm, "pnorm", mean =
mean, : ties should not be present for the one-sample Kolmogorov-Smirnov test</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
	Asymptotic one-sample Kolmogorov-Smirnov test

data:  normal_test_data$bill_depth_mm
D = 0.073463, p-value = 0.8565
alternative hypothesis: two-sided</code></pre>
</div>
<p>In this test the null-hypothesis is also that data is normally
distributed. The p-values is very high, and therefore we cannot reject
the null-hypothesis. Again, this is not the same as the data
<em>actually</em> being normally distributed.</p>
<p>This test assumes that there are no repeated values in the data, as
that can affect the precision of the test. The p-value is still very
high, and we will conclude that we cannot rule out that the data is not
normally distributed.</p>
<p>Note that the KS-test assumes that we actually know the true mean and
standard deviation. Here we calculate those values based on the sample,
which is problematic.</p>
</div>
<div class="section level3">
<h3 id="liliefors-test">Liliefors test<a class="anchor" aria-label="anchor" href="#liliefors-test"></a>
</h3>
<p>This is a variation on the KS-test, that is designed specifically for
testing for normality. It does not require us to know the true mean and
standard deviation for the population.</p>
<p>This test is also not available in base-R, but can be found in the
<code>nortest</code> package:</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">nortest</span><span class="op">)</span></span>
<span><span class="fu">lillie.test</span><span class="op">(</span><span class="va">normal_test_data</span><span class="op">$</span><span class="va">bill_depth_mm</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
	Lilliefors (Kolmogorov-Smirnov) normality test

data:  normal_test_data$bill_depth_mm
D = 0.073463, p-value = 0.483</code></pre>
</div>
<p>Again the p-value is so high, that we cannot reject the
null-hypothesis.</p>
</div>
<div class="section level3">
<h3 id="anderson-darling-test">Anderson-Darling test<a class="anchor" aria-label="anchor" href="#anderson-darling-test"></a>
</h3>
<p>This test is more sensitive for deviations in the tails.</p>
<p>It is not available in base-R, but can be found in the
<code>nortest</code> package.</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ad.test</span><span class="op">(</span><span class="va">normal_test_data</span><span class="op">$</span><span class="va">bill_depth_mm</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
	Anderson-Darling normality test

data:  normal_test_data$bill_depth_mm
A = 0.44788, p-value = 0.2714</code></pre>
</div>
<p>In this case the null-hypothesis is also that data is normally
distributed, and the p-value indicates that we cannot reject the
null-hypothesis.</p>
</div>
</section><section><h2 class="section-heading" id="and-is-it-actually-normally-distributed">And is it actually normally distributed?<a class="anchor" aria-label="anchor" href="#and-is-it-actually-normally-distributed"></a>
</h2>
<hr class="half-width">
<p>Probably not. Except for the excess kurtosis, all the tests we have
done indicate that the depth of the beaks of chinstrap penguins
<em>can</em> be normally distributed. Or rather, that we cannot reject
the null-hypothesis that they are normally distributed.</p>
<p>But the fact that we cannot reject this hypothesis is not the same as
concluding that the data actually <strong>is</strong> normally
distributed.</p>
<p>Based on the excess kurtosis and the qq-plot, it would be reasonable
to conclude that it is not.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Use <code>.md</code> files for episodes when you want static
content</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-which-distribution"><p>Content from <a href="which-distribution.html">How is the data distributed?</a></p>
<hr>
<p>Last updated on 2025-04-15 |

        <a href="https://github.com/KUBDatalab/R-toolbox/edit/main/episodes/which-distribution.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 12 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>If my data is not normally distributed - which distribution does it
actually follow?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Show how to identify possible distributions describing the data</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<hr class="half-width">
<p>Your data was not normally distributed. Now what?</p>
<p>The process generating your data is probably following some
distribution. The size distribution of cities appears to follow a Pareto
distibution, as is wealth. The number of mutations in a string of DNA
appears to follow a poisson distribution. And the distribution of wind
speeds as well as times to failure for technical components both follow
the Weibull distribution.</p>
<p>If you have a theoretical foundation for which distribution you data
generating function follows, that is nice.</p>
<p>If you do not - we will be interested in figuring out which
distribution your data actually follow.</p>
</section><section><h2 class="section-heading" id="how">How?<a class="anchor" aria-label="anchor" href="#how"></a>
</h2>
<hr class="half-width">
<p>We fit our data to a distribution. Or rather - we fit the data to
several different distributions and then choose the best.</p>
<p>Let us look at some data. The <code>faithful</code> data set contains
272 observations of the Old Faithful geyser in Yellowstone National Park
in USA. We only look at eruptions that lasts longer than 3 minutes:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span>
<span><span class="va">eruption_example</span> <span class="op">&lt;-</span> <span class="va">faithful</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">eruptions</span> <span class="op">&gt;</span> <span class="fl">3</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">select</span><span class="op">(</span><span class="va">eruptions</span><span class="op">)</span></span></code></pre>
</div>
<div id="accordionInstructor1" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor1" aria-expanded="false" aria-controls="collapseInstructor1">
  <h3 class="accordion-header" id="headingInstructor1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Instructor Note </h3>
</button>
<div id="collapseInstructor1" class="accordion-collapse collapse" data-bs-parent="#accordionInstructor1" aria-labelledby="headingInstructor1">
<div class="accordion-body">
<p>Det er nødvendigt at specificere at vi bruger
<code>dplyr::select</code> da den maskeres af MASS-pakken</p>
</div>
</div>
</div>
</div>
<p>Rather than testing a lot of different distributions, we can use the
<code>gamlss</code> package, and two add-ons to that.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">gamlss</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">gamlss.dist</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">gamlss.add</span><span class="op">)</span></span></code></pre>
</div>
<p><code>gamlss</code> has the advantage of implementing a <em>lot</em>
of different statistical distributions.</p>
<p>The function <code>fitDist()</code> from <code>gamlss</code> will fit
the data to a selection of different statistical distributions,
calculate a measure of the goodness of fit, and return the best fit (and
information on all the others). Rather than testing against all 97
different distributions supported by <code>gamlss</code>, we can specify
only a selection, in this case <code>realplus</code>, that only includes
the 23 distributions that are defined for positive, real numbers:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">fitDist</span><span class="op">(</span><span class="va">eruptions</span>, type <span class="op">=</span> <span class="st">"realplus"</span>, data <span class="op">=</span> <span class="va">eruption_example</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  |                                                                              |                                                                      |   0%  |                                                                              |===                                                                   |   4%  |                                                                              |======                                                                |   9%  |                                                                              |=========                                                             |  13%  |                                                                              |============                                                          |  17%</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  |                                                                              |===============                                                       |  22%  |                                                                              |==================                                                    |  26%  |                                                                              |=====================                                                 |  30%  |                                                                              |========================                                              |  35%  |                                                                              |===========================                                           |  39%  |                                                                              |==============================                                        |  43%</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  |                                                                              |=================================                                     |  48%  |                                                                              |=====================================                                 |  52%</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  |                                                                              |========================================                              |  57%  |                                                                              |===========================================                           |  61%  |                                                                              |==============================================                        |  65%</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  |                                                                              |=================================================                     |  70%  |                                                                              |====================================================                  |  74%</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  |                                                                              |=======================================================               |  78%  |                                                                              |==========================================================            |  83%Error in solve.default(oout$hessian) :
  Lapack routine dgesv: system is exactly singular: U[4,4] = 0
  |                                                                              |=============================================================         |  87%Error in solve.default(oout$hessian) :
  Lapack routine dgesv: system is exactly singular: U[4,4] = 0
  |                                                                              |================================================================      |  91%  |                                                                              |===================================================================   |  96%  |                                                                              |======================================================================| 100%</code></pre>
</div>
<p>If you do this yourself, you will notice a lot of error-messages. It
is not possible to fit this particular data to <em>all</em> the
distributions, and the ones where the fit fails (enough), we will get an
error message.</p>
<p>The output from <code>fitDist()</code> will return the best fit:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
Family:  c("WEI2", "Weibull type 2")
Fitting method: "nlminb"

Call:  gamlssML(formula = y, family = DIST[i])

Mu Coefficients:
[1]  -18.69
Sigma Coefficients:
[1]  2.524

 Degrees of Freedom for the fit: 2 Residual Deg. of Freedom   173
Global Deviance:     175.245
            AIC:     179.245
            SBC:     185.574 </code></pre>
</div>
<p>We are told that the statistical distribution that best fits the data
is <code>Weibull type 2</code> and that the AIC-measurement of goodness
of fit is 170.245.</p>
<div id="callout1" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout</h3>
<div class="callout-content">
<p>Is that a good fit? That is a good question. It strongly depends on
the values in the dataset. In this dataset, the length of the eruptions
are measured in minutes If we choose to measure that length in another
unit, eg seconds, the distribution should not change. But the AIC
will.</p>
<p>We can use the AIC to decide that one distribution fits the data
better than another, but not to conclude that that distribution is the
correct one.</p>
</div>
</div>
</div>
<p>The <code>fit</code> object containing the output of the
<code>fitDist()</code> function contains quite a bit more.</p>
<p>If we start by getting the errors out of the way,
<code>fit$failed</code> returns the two distributions that failed enough
to cause errors:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span><span class="op">$</span><span class="va">failed</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[[1]]
[1] "GIG"

[[2]]
[1] "LNO"</code></pre>
</div>
<p>As mentioned <code>fitDist()</code> fitted the data to 23 different
distributions. We can inspect the rest, and their associated AIC-values
like this:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span><span class="op">$</span><span class="va">fits</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>    WEI2     WEI3      WEI       GG    BCPEo     BCPE    BCCGo     BCCG
179.2449 179.2449 179.2449 181.1349 181.4953 181.4953 183.1245 183.1245
     GB2      BCT     BCTo   exGAUS       GA   LOGNO2    LOGNO       IG
183.1354 185.1245 185.1245 190.2994 194.4665 198.3047 198.3047 198.3558
  IGAMMA      EXP       GP PARETO2o  PARETO2
202.6759 861.8066 863.8067 863.8079 863.8081 </code></pre>
</div>
<p>Here we get <code>WEI2</code> first, with an AIC of 179.2449, but we
can see that <code>WEI3</code> and <code>WEI1</code> have almost exactly
the same AIC. Not that surprising if we guess that
<code>Weibull type 3</code> is probably rather similar to
<code>Weibull type 2</code>.</p>
<p>The difference in AIC for the first two distributions tested is very
small. Is it large enough for us to think that <code>WEI2</code> is
significantly better than <code>WEI3</code>?</p>
<p>No. As a general rule of thumb, the difference between the AIC of two
distributions have to be larger than 2 for us to see a significant
difference.</p>
<p>We can get more details using the <code>summary()</code>
function:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">summary</span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>*******************************************************************
Family:  c("WEI2", "Weibull type 2")

Call:  gamlssML(formula = y, family = DIST[i])

Fitting method: "nlminb"


Coefficient(s):
             Estimate  Std. Error  t value   Pr(&gt;|t|)
eta.mu    -18.6934274   1.1306427 -16.5334 &lt; 2.22e-16 ***
eta.sigma   2.5242093   0.0589965  42.7858 &lt; 2.22e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

 Degrees of Freedom for the fit: 2 Residual Deg. of Freedom   173
Global Deviance:     175.245
            AIC:     179.245
            SBC:     185.574 </code></pre>
</div>
<p>And we can get at graphical description as well:</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot</span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/which-distribution-rendered-plot-fit-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>******************************************************************
	      Summary of the Quantile Residuals
                           mean   =  -0.001205749
                       variance   =  0.9953007
               coef. of skewness  =  0.09022876
               coef. of kurtosis  =  2.529951
Filliben correlation coefficient  =  0.9976953
******************************************************************</code></pre>
</div>
</section><section><h2 class="section-heading" id="what-about-the-other-options">What about the other options?<a class="anchor" aria-label="anchor" href="#what-about-the-other-options"></a>
</h2>
<hr class="half-width">
<div class="section level3">
<h3 id="general-comments">General comments<a class="anchor" aria-label="anchor" href="#general-comments"></a>
</h3>
<p>Above we got the “best” fit. But we also noted that in order for us
to conclude that one distribution is a better fit than another, the
difference in AIC should be at least 2.</p>
<p>What we are looking for might not actually be the probability
distribution that best fits our data. Our data might be noisy or there
might me systematic errors. The probability distribution we really want,
is the one that best matches the underlying data generating function,
the mechanisms in the real world that we are studying, that actually is
at the hearth of the data we collect.</p>
<p>We might not be able to find that. But we should consider if some of
the other possibilities provided by <code>fitDist()</code> might
actually be better.</p>
<div id="accordionInstructor2" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor2" aria-expanded="false" aria-controls="collapseInstructor2">
  <h3 class="accordion-header" id="headingInstructor2">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Instructor Note </h3>
</button>
<div id="collapseInstructor2" class="accordion-collapse collapse" data-bs-parent="#accordionInstructor2" aria-labelledby="headingInstructor2">
<div class="accordion-body">
<p>Og her er det vi holder dem fast på at det faktisk er dem selv der er
de bedst kvalificerede til at afgøre det. For det er dem der forstår
domænet og data.</p>
</div>
</div>
</div>
</div>
<p>First step is to look at the relevant distributions. In the setup
with <code>gamlss</code>, <code>gamlss.dist</code> and
<code>gamlss.add</code> we can test distributions of different types.
The complete list can be found using the help function for
<code>fitDist()</code>, but falls in the following families:</p>
<ul>
<li>realline - continuous distributions for all real values</li>
<li>realplus - continuous distributions for positive real values</li>
<li>realAll - all continuous distributions - the combination of realline
and realplus</li>
<li>real0to1 - continuous distributions defined for real values between
0 and 1</li>
<li>counts - distributions for counts</li>
<li>binom - binomial distributions</li>
</ul>
<p>Begin by considering which type whatever your data is describing,
best matches.</p>
</div>
<div class="section level3">
<h3 id="actually-looking-at-the-fits">Actually looking at the fits<a class="anchor" aria-label="anchor" href="#actually-looking-at-the-fits"></a>
</h3>
<p>For the selection of eruptions that we fitted, we chose the
“realplus” selection of distibutions to test. We did that, because the
eruption times are all positive, and on the real number line.</p>
<div id="accordionInstructor3" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor3" aria-expanded="false" aria-controls="collapseInstructor3">
  <h3 class="accordion-header" id="headingInstructor3">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Instructor Note </h3>
</button>
<div id="collapseInstructor3" class="accordion-collapse collapse" data-bs-parent="#accordionInstructor3" aria-labelledby="headingInstructor3">
<div class="accordion-body">
<p>“Real numbers”, på dansk reelle tal. Hvis du ved hvad imaginære tal
er, ved du også hvad reelle tal er. Hvis ikke - så er reelle tal alle de
tal du vil tænke på som tal.</p>
</div>
</div>
</div>
</div>
<p>Behind the scenes <code>fitDist</code> fits the data to the chosen
selection of distributions, and returns the best.</p>
<p>Looking at the result of the fit we see this:</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
Family:  c("WEI2", "Weibull type 2")
Fitting method: "nlminb"

Call:  gamlssML(formula = y, family = DIST[i])

Mu Coefficients:
[1]  -18.69
Sigma Coefficients:
[1]  2.524

 Degrees of Freedom for the fit: 2 Residual Deg. of Freedom   173
Global Deviance:     175.245
            AIC:     179.245
            SBC:     185.574 </code></pre>
</div>
<p>In the <code>Call</code> part of the output, we see this:</p>
<p><code>Call:  gamlssML(formula = y, family = DIST[i])</code></p>
<p>and from that we can deduces that if we want to fit the data to eg
the log-normal distribution (in the documentation we find that the
abbreviation for that is “LOGNO”), we can do it like this:</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">log_norm_fit</span> <span class="op">&lt;-</span> <span class="fu">gamlss</span><span class="op">(</span><span class="va">eruptions</span> <span class="op">~</span> <span class="fl">1</span>, family <span class="op">=</span> <span class="va">LOGNO</span>, data <span class="op">=</span> <span class="va">eruption_example</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>GAMLSS-RS iteration 1: Global Deviance = 194.3047
GAMLSS-RS iteration 2: Global Deviance = 194.3047 </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">summary</span><span class="op">(</span><span class="va">log_norm_fit</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>******************************************************************
Family:  c("LOGNO", "Log Normal")

Call:
gamlss(formula = eruptions ~ 1, family = LOGNO, data = eruption_example)

Fitting method: RS()

------------------------------------------------------------------
Mu link function:  identity
Mu Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)
(Intercept) 1.451832   0.007461   194.6   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

------------------------------------------------------------------
Sigma link function:  log
Sigma Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)
(Intercept) -2.31561    0.05345  -43.32   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

------------------------------------------------------------------
No. of observations in the fit:  175
Degrees of Freedom for the fit:  2
      Residual Deg. of Freedom:  173
                      at cycle:  2

Global Deviance:     194.3047
            AIC:     198.3047
            SBC:     204.6343
******************************************************************</code></pre>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>The data generating function is not necessarily the same as the
distribution that best fit the data</li>
<li>Chose the distribution that best describes your data - not the one
that fits best</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div>
</section></section><section id="aio-linear-regression"><p>Content from <a href="linear-regression.html">Linear regression</a></p>
<hr>
<p>Last updated on 2025-04-15 |

        <a href="https://github.com/KUBDatalab/R-toolbox/edit/main/episodes/linear-regression.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 12 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do I make a linear regression?</li>
<li>How do I interpret the results of a linear regression?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Explain how to fit data to a linear equation in one dimension</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<hr class="half-width">
<p>Here is some data, observations of the distance (in ft) it takes to
stop a car driving at different speeds (in mph):</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.1     ✔ tibble    3.2.1
✔ lubridate 1.9.4     ✔ tidyr     1.3.1
✔ purrr     1.0.4
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cars</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">speed</span>,<span class="va">dist</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/linear-regression-rendered-unnamed-chunk-1-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Not surprisingly the faster the car travels, the longer distance it
takes to stop it.</p>
<p>If we want to predict how long a car traveling at 10 mph takes to
stop, we could look at the observations at 10 mph and note that there is
some variation. We might take the average of those observations, and use
that as an estimate of how many feet it takes to stop a car traveling at
10 mph.</p>
<p>But what if we want to predict how long it takes to stop the car if
we are driving it at 12.5 mph instead? That would be nice to know, in
order to avoid hitting stuff. There are no observations in the data at
12.5 mph! We could estimate it as the average of the (average) stopping
distance at 12 mph and at 13 mph (21.5 and 35 ft respectively) and give
an estimate of 28.25 ft.</p>
<p>This is easy - 12.5 is exactly at the middle of the interval of 12 to
13 mph. But what if we want the distance at 12.4 mph?</p>
<p>Instead of fiddling with the numbers manually, we note that it
appears to be possible to draw a straight line through the points,
describing the connection between the two variables.</p>
<p>Let’s do that:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cars</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">speed</span>,<span class="va">dist</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_smooth</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, se <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<figure><img src="../fig/linear-regression-rendered-unnamed-chunk-2-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>The points do not fall precisely on the line, but it’s not very
bad.</p>
<div id="accordionInstructor1" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor1" aria-expanded="false" aria-controls="collapseInstructor1">
  <h3 class="accordion-header" id="headingInstructor1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Instructor Note </h3>
</button>
<div id="collapseInstructor1" class="accordion-collapse collapse" aria-labelledby="headingInstructor1" data-bs-parent="#accordionInstructor1">
<div class="accordion-body">
<p>Bremselængden er faktisk ikke en lineær funktion af hastigheden.
Bilen har kinetisk (bevægelses) energi så længe den bevæger sig. Den
skal vi have ned på 0. Og eftersom den kinetiske energi er givet ved
<span class="math inline">\(E_{kin} = \frac{1}{2}mv^2\)</span> hvor m er
bilens masse og v er hastigheden, vil dist afhænge af speed i anden.</p>
</div>
</div>
</div>
</div>
<p>When we want to figure out how long it takes to stop a car driving at
12.5 mph, we can locate 12.5 on the x-axis, move vertically up to the
line, and read the corresponding value on the y-axis, about 30 mph.</p>
<p>But we can do better. Such a line can be described mathematically.
Straight lines in two dimensions can in general be described using the
formula:</p>
<p><span class="math display">\[
y = ax + b
\]</span> or, in this specific case:</p>
<p><span class="math display">\[
dist = a*speed + b
\]</span></p>
<p><code>a</code> and <code>b</code> are the coefficients of this
“model”. <code>a</code> is the slope, or how much the distance changes,
if we change speed by one. <code>b</code> is the intercept, the value
where the line crosses the y-axis. Or the distance it takes to stop a
car, traveling at a speed of 0 miles per hour - a value that does not
necessarily make sense, but is still a part of the model.</p>
<p>If we want to be very strict about it, that <code>=</code> is not
really equal. The expression describes the straight line, but the actual
observations do not actually fall on the line. If, for a given dist and
speed, we want the expression to actually be equal, there is some
variation that we need to include. We do that by adding a
<code>residual</code>:</p>
<p><span class="math display">\[
dist = a*speed + b + \epsilon
\]</span></p>
<p>And, if we want to be very mathematical concise, instead of using
<code>a</code>and <code>b</code> for the coefficients in the expression,
we would instead write it like this:</p>
<p><span class="math display">\[
dist = \beta_0 + \beta_1 speed + \epsilon
\]</span></p>
<p>That is all very nice. But how do we find the actual <code>a</code>
and <code>b</code> (or <span class="math inline">\(\beta_i\)</span>)?
What is the “best” line or model for this?</p>
<p>We do that by fitting <code>a</code> and <code>b</code> to values
that minimizes <span class="math inline">\(\epsilon\)</span>, that is,
we need to find the difference between the actual observed values, and
the prediction from the expression or model. Instead of looking at the
individual differences one by one, we look at the sum of the
differences, and minimizes that. However, the observed values can be
larger than the prediction, or smaller. The differences can therefore be
both negative and positive, and the sum can become zero because the
difference might cancel each other out.</p>
<p>To avoid that problem, we square the differences, and then minimize
the sum of the squares. That is the reason for calling the method for
minimizing <span class="math inline">\(\epsilon\)</span>, and by that
finding the optimal <code>a</code> and <code>b</code>, “least
squares”.</p>
<p>In a simple linear model like this, we can calculate the coefficients
directly:</p>
<p><span class="math display">\[\beta_1 = \frac{\sum_{i=1}^{n} (x_i -
\overline{x})(y_i - \overline{y})}{\sum_{i=1}^{n} (x_i -
\overline{x})^2}\]</span></p>
<p><span class="math display">\[\beta_0 = \overline{y} -
\beta_1\overline{x}\]</span></p>
<p>We do not want to do that - R can do it for us, with the function
<code>lm()</code></p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">lm</span><span class="op">(</span><span class="va">y</span><span class="op">~</span><span class="va">x</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span></code></pre>
</div>
<p>y~x is the “formula notation” in R, and describes that y is a
function of x.</p>
<p>Using the example from above:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linear_model</span> <span class="op">&lt;-</span> <span class="fu">lm</span><span class="op">(</span><span class="va">dist</span><span class="op">~</span><span class="va">speed</span>, data <span class="op">=</span> <span class="va">cars</span><span class="op">)</span></span></code></pre>
</div>
<p>We saved the result of the function in an object, in order to be able
to work with it. If we just want the coefficients, we can output the
result directly:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linear_model</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
Call:
lm(formula = dist ~ speed, data = cars)

Coefficients:
(Intercept)        speed
    -17.579        3.932  </code></pre>
</div>
<p>This gives us the coefficients of the model. The intercept,
<code>b</code> or <span class="math inline">\(\beta_0\)</span> is
-17.579. And the slope, <code>a</code> or <span class="math inline">\(\beta_1\)</span> is 3.932.</p>
<p>Having a negative intercept, or in this case any intercept different
from 0 does not make physical sense - a car travelling at 0 miles pr
hour should have a stopping distance of 0 ft.</p>
<p>The slope tells us, that if we increase the speed of the car by 1
mph, the stopping distance will increase by 3.932 ft.</p>
<div id="challenge-1-can-you-do-it" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-1-can-you-do-it" class="callout-inner">
<h3 class="callout-title">Challenge 1: Can you do it?</h3>
<div class="callout-content">
<p>What stopping distance does the model predict if the speed i 12.5
mph?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>3.932*12.5 - 17.579 = 31.571 ft</p>
</div>
</div>
</div>
</div>
<div id="challenge-2-might-there-be-a-problem-with-that-prediction" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-2-might-there-be-a-problem-with-that-prediction" class="callout-inner">
<h3 class="callout-title">Challenge 2: Might there be a problem with that prediction?</h3>
<div class="callout-content">

</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<p>Yep. We might be able to measure the speed with the implied
precision. But the prediction implies a precision on the scale of
1/10000 mm.</p>
</div>
</div>
</div>
</div>
<p>We can get more details using the <code>summary()</code>
function:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">summary</span><span class="op">(</span><span class="va">linear_model</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
Call:
lm(formula = dist ~ speed, data = cars)

Residuals:
    Min      1Q  Median      3Q     Max
-29.069  -9.525  -2.272   9.215  43.201

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)
(Intercept) -17.5791     6.7584  -2.601   0.0123 *
speed         3.9324     0.4155   9.464 1.49e-12 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 15.38 on 48 degrees of freedom
Multiple R-squared:  0.6511,	Adjusted R-squared:  0.6438
F-statistic: 89.57 on 1 and 48 DF,  p-value: 1.49e-12</code></pre>
</div>
<p>Let us look at that output in detail.</p>
<p><code>Call</code> simply repeats the model that we build, just in
case we have forgotten it - but also to have the actual model included
in the output, in order for other functions to access it and use it. We
will get to that.</p>
<p>The residuals are included. It is often important to take a look at
those, and we will do that shortly.</p>
<p>Now, the coefficients.</p>
<p>The estimates for intercept and speed, that is the intercept and the
slope of the line, are given. Those are the same we saw previously. We
also get a standard error. We need that for testing how much trust we
have in the result.</p>
<p>We are almost certain that the estimates of the values for intercept
and slope are not correct. They are estimates after all and we will
never know what the <em>true</em> values are. But we can test if they
are zero.</p>
<p>The hypothesis we can test is - is the coefficient for the slope
actually zero, even though the estimate we get is 3.9? If it is zero,
speed will not have any influence on the stopping distance. So; with
what certainty can we rule out that it is in fact zero?</p>
<p>We are testing the hypothesis that we have gotten a value for speed
of 3.9 by random chance, but that the true value is zero. If it is zero,
the value of 3.9 is 9.5 standard errors away from 0: 3.9324/0.4155 =
9.46426. And, using the t-distribution which describes these sorts of
things pretty well, that will happen very rarely. The Pr, or p-value, is
1.49e-12. That is the chance, or probability, that we will get a value
for the slope in our model that is 9.464 standard errors away from zero,
if the true value of the slope is zero.</p>
<p>In general if the p-value is smaller than 0.05, we reject the
hypothesis that the true value of the slope is 0.</p>
<p>Since we can assume that the estimates are normally distributed, we
can see that, <em>if</em> the true value of the slope was zero, the
value we get here, is 3.9324/0.4155 = 9.46426, standard errors away from
zero.</p>
<p>RSE is the squareroot of the sum of the squared residuals, divided by
the number of observations, <span class="math inline">\(n\)</span> minus
the number of parameters in the model, in this case 2. It is an estimate
of the average difference between the observed values, and the values
the model predicts. We want RSE to be as small as possible. What is
small? That depends on the size of the values. If we predict values in
the range of 0 to 2, an RSE of 15 is very large. If we predict values in
the range 0 to 1000, it is small.</p>
<p>Multiple R-squared, is a measure of how much of the variation in
<code>dist</code> that our model explains. In this case the model
explains ~65% of the variation. Not that impressive, but acceptable.</p>
<p>The adjusted R-squared adjusts the multiple R-square by the number of
independent variables in the model. It becomes an important measure of
how good the model is, when we get to multiple linear regression,
because we will get a better R-squared by adding independent variables,
even if these variables do not actually have any connection to the
dependent variables.</p>
<p>The F-statistic is 89.57 and has a p-value of 1.49e-12.</p>
<p>This tests our model against a model where all the slopes (we only
have one in this case) are 0; that is, is the overall model significant.
In this case it is, and there is overall strong evidence for the claim
that the speed of the car influences the stopping distance.</p>
<div id="challenge3" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p>Make a model, where you describe the length of the flipper of a
penguin, as a function of its weigth. You find data on penguins in the
library <code>palmerpenguins</code>.</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">palmerpenguins</span><span class="op">)</span></span>
<span><span class="va">penguin_model</span> <span class="op">&lt;-</span> <span class="fu">lm</span><span class="op">(</span><span class="va">flipper_length_mm</span><span class="op">~</span><span class="va">body_mass_g</span>, data <span class="op">=</span> <span class="va">penguins</span><span class="op">)</span></span>
<span><span class="fu">summary</span><span class="op">(</span><span class="va">penguin_model</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
Call:
lm(formula = flipper_length_mm ~ body_mass_g, data = penguins)

Residuals:
     Min       1Q   Median       3Q      Max
-23.7626  -4.9138   0.9891   5.1166  16.6392

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)
(Intercept) 1.367e+02  1.997e+00   68.47   &lt;2e-16 ***
body_mass_g 1.528e-02  4.668e-04   32.72   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 6.913 on 340 degrees of freedom
  (2 observations deleted due to missingness)
Multiple R-squared:  0.759,	Adjusted R-squared:  0.7583
F-statistic:  1071 on 1 and 340 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="testing-the-assumptions">Testing the assumptions<a class="anchor" aria-label="anchor" href="#testing-the-assumptions"></a>
</h2>
<hr class="half-width">
<p>We can <em>always</em> make a linear model. The questions is: should
we?</p>
<p>There are certain assumptions that needs to be met in order to trust
a linear model.</p>
<ol style="list-style-type: decimal">
<li><p>There should be a linear connection between the dependent and
independent variable. We test that by comparing the observed values with
the predicted values (the straight line).</p></li>
<li><p>Independence. The observations needs to be independent. If one
measurement influences another measurement, we are not allowed to use a
linear model.</p></li>
<li><p>Normality of residuals. The residuals must be normally
distributed.</p></li>
</ol>
<div id="accordionSpoiler1" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler1" aria-expanded="false" aria-controls="collapseSpoiler1">
  <h3 class="accordion-header" id="headingSpoiler1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div> The assumptions - differently defined </h3>
</button>
<div id="collapseSpoiler1" class="accordion-collapse collapse" aria-labelledby="headingSpoiler1" data-bs-parent="#accordionSpoiler1">
<div class="accordion-body">
<p>The three assumptions can be formulated in different ways, and it can
be useful to read more than one in order to understand them. This is a
different way:</p>
<ol style="list-style-type: decimal">
<li>For any given value of x, the corresponding value of y has an
average value of <span class="math inline">\(\alpha + \beta
x\)</span>
</li>
<li>For any two data points, the error terms are independent of each
other.</li>
<li>For any given value of x, the corresponding value of y is normally
distributed about <span class="math inline">\(\alpha + \beta x\)</span>
with the same variance <span class="math inline">\(\sigma^2\)</span> for
any x</li>
</ol>
</div>
</div>
</div>
</div>
<p>In general we know our data well enough to determine if the first two
are fulfilled. The third assumptions can be tested using a
<code>qqplot</code>. We begin by extracting the residuals from our
model:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">residuals</span> <span class="op">&lt;-</span> <span class="fu">residuals</span><span class="op">(</span><span class="va">linear_model</span><span class="op">)</span></span></code></pre>
</div>
<p>And then plotting them:</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">qqnorm</span><span class="op">(</span><span class="va">residuals</span><span class="op">)</span></span>
<span><span class="fu">qqline</span><span class="op">(</span><span class="va">residuals</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/linear-regression-rendered-unnamed-chunk-9-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>The points should be (close to be) on the straight line in the plot.
In this case they are close enough.</p>
<p>This is also a handy way to test if our data is normally
distributed.</p>
<div id="challenge4" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p>Test if the residuals in our penguin model from before, are normally
distributed.</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4"> Show me the solution </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" aria-labelledby="headingSolution4" data-bs-parent="#accordionSolution4">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguin_residuals</span> <span class="op">&lt;-</span> <span class="fu">residuals</span><span class="op">(</span><span class="va">penguin_model</span><span class="op">)</span></span>
<span><span class="fu">qqnorm</span><span class="op">(</span><span class="va">penguin_residuals</span><span class="op">)</span></span>
<span><span class="fu">qqline</span><span class="op">(</span><span class="va">penguin_residuals</span><span class="op">)</span></span></code></pre>
</div>
<p><img src="../fig/linear-regression-rendered-unnamed-chunk-10-1.png" style="display: block; margin: auto;" class="figure">
They are relatively close to normal.</p>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Linear regression show the (linear) relationship between
variables.</li>
<li>The assumption of normalcy is on the residuals, not the data!</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-multiple-linear-regression"><p>Content from <a href="multiple-linear-regression.html">Multiple Linear Regression</a></p>
<hr>
<p>Last updated on 2025-04-15 |

        <a href="https://github.com/KUBDatalab/R-toolbox/edit/main/episodes/multiple-linear-regression.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 12 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do you run a multiple linear regression?</li>
<li>What about conditional effects?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Learn how to build and trim a model with multiple independent
variabels</li>
<li>Learn how to build a model with interaction terms</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<hr class="half-width">
<p>A linear regression is relatively simple to understand and visualise.
We have a dependent variable that we try to predict - model - using an
independent variable. In principle we can change the independent
variable, and the model will predict the change in the dependent
variable. We can visualise this using a relatively simple graph,
plotting the two variables against each other, and adding the line
representing the model.</p>
<p>But what if we have reason to believe that the dependent variable
depends on more than one independent variable?</p>
<p>Let us find some data for illustrating this.</p>
<p>Before anything else, we load the <code>tidyverse</code> package,
download the data, and read it using <code>read_csv()</code>:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span>
<span><span class="fu">download.file</span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/KUBDatalab/R-toolbox/main/episodes/data/BONEDEN.csv"</span>,</span>
<span>              destfile <span class="op">=</span> <span class="st">"data/BONEDEN.csv"</span>, mode <span class="op">=</span> <span class="st">"wb"</span><span class="op">)</span></span>
<span><span class="va">boneden</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"data/BONEDEN.csv"</span><span class="op">)</span></span></code></pre>
</div>
<p>The data records the bonedensity in different parts of the skeleton
of female monozygotic twins, as well as height, age, weight, smoking,
alcohol, tea and coffee-habits. We are going to study the second twins,
where all variables are suffixed with the digit “2”:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">density</span> <span class="op">&lt;-</span> <span class="va">boneden</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="va">age</span>, <span class="fu">contains</span><span class="op">(</span><span class="st">"2"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">head</span><span class="op">(</span><span class="va">density</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 6 × 12
    age   ht2   wt2  tea2  cof2  alc2  cur2  men2  pyr2   ls2   fn2   fs2
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1    27   160    56    42    21     0     0     0  13.8  0.76  0.68  1.04
2    42   159    72    20    21     1     1     0  48    0.89  0.64  1.11
3    59   156    54     7    28     0     0     1  20.5  0.51  0.64  0.86
4    61   162    58    21    35     0     0     1  29.8  0.85  0.69  1.03
5    47   150    58    91     0     0     1     1  25    0.59  0.54  0.96
6    33   158    54    14    14     0     0     0   5    0.83  0.5   1.06</code></pre>
</div>
<div id="callout1" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout</h3>
<div class="callout-content">
<p>The package <code>tidyselect</code> is a part of the
<code>tidyverse</code>. It contains functions that allow us to choose
variables/columns based on patterns in their names rather than
specifying the names directly. <code>contains("2")</code> here return
all columns with a name containing the string “2”.</p>
</div>
</div>
</div>
<p>More specically we are trying to model the bone density in the
femoral shaft (lårbensskaft). As an intial hypothesis, we are going to
assume that the density depends on height (<code>ht2</code>), age
(<code>age</code>), weight (<code>wt2</code>), tea (<code>tea2</code>)
and coffee consumption (<code>cof2</code>).</p>
<p>That is, we assume that there is a linear correlation between the
bone density and each of the independent variables.</p>
<p>The simple linear regresion between just the bone density and the
height, can be done with:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">lm</span><span class="op">(</span><span class="va">fs2</span> <span class="op">~</span> <span class="va">ht2</span>, data <span class="op">=</span> <span class="va">density</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">summary</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
Call:
lm(formula = fs2 ~ ht2, data = density)

Residuals:
     Min       1Q   Median       3Q      Max
-0.41406 -0.02810  0.00190  0.07658  0.30722

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)
(Intercept) -1.78744    0.71928  -2.485 0.017351 *
ht2          0.01766    0.00445   3.969 0.000301 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.1315 on 39 degrees of freedom
Multiple R-squared:  0.2877,	Adjusted R-squared:  0.2694
F-statistic: 15.75 on 1 and 39 DF,  p-value: 0.0003006</code></pre>
</div>
<p>Where we pipe the output of the regression to the summary function to
take a closer look. There is a significant correlation between bone
density and height. If we increase the height of a woman by one
centimeter, the density of her femoral shaft is expected to increase by
0.0177 <span class="math inline">\(g/cm^3\)</span>. The correlation is
significant, that is, we are rather sure that the estimate of this
coefficient is different from 0.</p>
<p>Now we would like to add the other independent variables to the
model.</p>
<p>The model we are building can be described using math as:</p>
<p><span class="math display">\[ \text{fs2} = w_0 + w_1\text{ht2} +
w_2\text{wt2} + w_3\text{tea2} + w_4\text{cof2} + \epsilon  \]</span>
That is - we would like to figure out which coefficients <span class="math inline">\(w_1\)</span> to <span class="math inline">\(w_4\)</span>, and which intercept <span class="math inline">\(w_0\)</span> will give us estimates of fs2, that
minimizes the error <span class="math inline">\(\epsilon\)</span></p>
<p>This is pretty straight forward. Instead of running
<code>lm(fs2~ht2, data = density</code>, we add the additional
independent variables using the <code>+</code> sign. And again we pipe
the result to the summary function to take a closer look:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">lm</span><span class="op">(</span><span class="va">fs2</span> <span class="op">~</span> <span class="va">ht2</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">wt2</span> <span class="op">+</span> <span class="va">tea2</span> <span class="op">+</span> <span class="va">cof2</span>, data <span class="op">=</span> <span class="va">density</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span><span class="fu">summary</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
Call:
lm(formula = fs2 ~ ht2 + age + wt2 + tea2 + cof2, data = density)

Residuals:
      Min        1Q    Median        3Q       Max
-0.247601 -0.061517  0.005634  0.067826  0.166474

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)
(Intercept) -0.2800114  0.7774507  -0.360 0.720887
ht2          0.0090956  0.0046455   1.958 0.058246 .
age         -0.0068373  0.0015669  -4.364 0.000108 ***
wt2          0.0038274  0.0014934   2.563 0.014836 *
tea2        -0.0009246  0.0009837  -0.940 0.353677
cof2        -0.0005310  0.0009328  -0.569 0.572778
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.1043 on 35 degrees of freedom
Multiple R-squared:  0.5978,	Adjusted R-squared:  0.5403
F-statistic:  10.4 on 5 and 35 DF,  p-value: 3.566e-06</code></pre>
</div>
<p>It is <em>that</em> simple. Interpreting the results on the other
hand is a bit more complicated.</p>
<p>The bone density, for a newborn woman (0 years old), that is 0
centimeters high, weighing 0 kilogram, who does not drink either tea or
coffee, is -0.28 <span class="math inline">\(g/cm^3\)</span> - which is
obviously either impossible, or a discovery that would get you an
invitation to Stockholm.</p>
<p>For each centimeter the woman grows, <em>if all other variables are
held constant!</em> the bone density is expected to <em>increase</em> by
0.0091 <span class="math inline">\(g/cm^3\)</span>.</p>
<p>For each year the woman grows older, <em>if all other variables are
held constant!</em> the bone density is expected to <em>decrease</em> by
0.0068 <span class="math inline">\(g/cm^3\)</span>.</p>
<p>For each kilogram the woman puts on weight, <em>if all other
variables are held constant!</em> the bone density is expected to
<em>increase</em> by 0.0038 <span class="math inline">\(g/cm^3\)</span>.</p>
<p>The coefficient for the height variable is not significant (if we
have decided on a 5% significanse level), and neither consumption of teo
nor coffee has a significant influence on bone density. According to
this model.</p>
<p>Is this a good model? No. The coefficients for Tea and coffee
consumption are not significant, and should not be in the model. Let us
remove them.</p>
<p>But let us remove them one by one. First coffee that has the worst
p-value:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">lm</span><span class="op">(</span><span class="va">fs2</span> <span class="op">~</span> <span class="va">ht2</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">wt2</span> <span class="op">+</span> <span class="va">tea2</span>, data <span class="op">=</span> <span class="va">density</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">summary</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
Call:
lm(formula = fs2 ~ ht2 + age + wt2 + tea2, data = density)

Residuals:
     Min       1Q   Median       3Q      Max
-0.26036 -0.06261  0.01682  0.06366  0.17393

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)
(Intercept) -0.2209640  0.7632342  -0.290   0.7739
ht2          0.0085364  0.0044976   1.898   0.0657 .
age         -0.0068645  0.0015514  -4.425 8.58e-05 ***
wt2          0.0041140  0.0013927   2.954   0.0055 **
tea2        -0.0007497  0.0009257  -0.810   0.4233
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.1034 on 36 degrees of freedom
Multiple R-squared:  0.5941,	Adjusted R-squared:  0.5489
F-statistic: 13.17 on 4 and 36 DF,  p-value: 1.048e-06</code></pre>
</div>
<p>Note that not only is the coefficient for tea still not significant,
it actually gets “worse”. On the other hand, the coefficient for weight
now is larger, ie explains more of the variation.</p>
<div id="callout2" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout</h3>
<div class="callout-content">
<p>Why does this happen?</p>
<p>What the model does is “trying” to explain the variation in
<code>fs2</code>, using the independent variables. We have an underlying
assumption that we can change those variables independently. However,
they are often correlated. In this case there is a relatively large
correlation between <code>cof2</code> and <code>wt2</code>. When we
remove <code>cof2</code> from the model, some of the variation explained
by <code>cof2</code> can now be captured by <code>wt2</code>.</p>
</div>
</div>
</div>
<p>We do not actually explain that much of the variation in
<code>fs2</code>. The R<sup>2</sup> value tells us how much of the
variation is explained by the model, and 0.5941 is not <em>that</em>
impressive. We will be able to explain everything, including random
noise in the data. We just need to add enough independent variables to
our model. Some of the random noise will be explained by even a random
varible.</p>
<p>This is called <code>overfitting</code>, and one of ways we try to
identify that, is by looking at the <code>Adjusted R-squared</code>
instead. This adjusts the R<sup>2</sup> for the number of variables we
have in the model. This is the measure of how good the model is, that we
prefer.</p>
<p>We continue our “leave-one-out” approach. <code>tea2</code> is the
“worst” performing variable measured by the p-value, and that is the
next one we will remove:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">lm</span><span class="op">(</span><span class="va">fs2</span> <span class="op">~</span> <span class="va">ht2</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">wt2</span> , data <span class="op">=</span> <span class="va">density</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">summary</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
Call:
lm(formula = fs2 ~ ht2 + age + wt2, data = density)

Residuals:
      Min        1Q    Median        3Q       Max
-0.273490 -0.058038  0.005241  0.067527  0.169512

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)
(Intercept) -0.569569   0.627355  -0.908  0.36981
ht2          0.010524   0.003751   2.806  0.00796 **
age         -0.006489   0.001474  -4.404 8.74e-05 ***
wt2          0.004077   0.001385   2.943  0.00559 **
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.1029 on 37 degrees of freedom
Multiple R-squared:  0.5867,	Adjusted R-squared:  0.5531
F-statistic:  17.5 on 3 and 37 DF,  p-value: 3.078e-07</code></pre>
</div>
<p>Now we have a model where all coefficients are significant.</p>
<div id="callout3" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout</h3>
<div class="callout-content">
<p>What about the intercept?</p>
<p>The estimate of the intercept is not significant. Is that a
problem?</p>
<p>No, not in this case. The intercept is the estimate of what
<code>fs2</code> would be if all the independent variables are 0. That
might be meaningful for age, but definitely not for height or
weight.</p>
<p>Also the thing we are interested in is not actually making
predictions, in that case we would like a better estimate of the
intercept, but in studying the effect of height, age and weight on
bonedensity.</p>
</div>
</div>
</div>
<div id="challenge1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p>The dataset contains more variables than we have examined here.
Alcohol consumption <code>alc</code>, and how many years the individual
women have been smoking <code>pyr</code>.</p>
<p>We also only studied half of the dataset, the variables ending in
“2”. Data on the other twins have variables ending in “1”.</p>
<p>Build a model predicting the bonedensity of the femoral shaft
<code>fs1</code> using a selection of the variables <code>age</code>,
ht1<code>,</code>wt1<code>,</code>tea1<code>,</code>cof1<code>,</code>alc1<code>and</code>pyr1`.</p>
<p>Make sure that only significant (p&lt;0.05) variables are
included.</p>
<p>What is the adjusted R squared value?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dens_exercise</span> <span class="op">&lt;-</span> <span class="va">boneden</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">age</span>, <span class="fu">contains</span><span class="op">(</span><span class="st">"1"</span><span class="op">)</span>, <span class="op">-</span><span class="fu">c</span><span class="op">(</span><span class="va">cur1</span>, <span class="va">ls1</span>, <span class="va">fn1</span>, <span class="va">men1</span> <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model_1</span> <span class="op">&lt;-</span> <span class="fu">lm</span><span class="op">(</span><span class="va">fs1</span><span class="op">~</span><span class="va">.</span>, data <span class="op">=</span> <span class="va">dens_exercise</span><span class="op">)</span></span>
<span><span class="va">model_2</span> <span class="op">&lt;-</span> <span class="fu">lm</span><span class="op">(</span><span class="va">fs1</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">ht1</span> <span class="op">+</span> <span class="va">wt1</span><span class="op">+</span> <span class="va">cof1</span> <span class="op">+</span> <span class="va">alc1</span> <span class="op">+</span><span class="va">pyr1</span>, data <span class="op">=</span> <span class="va">dens_exercise</span><span class="op">)</span></span>
<span><span class="va">model_3</span> <span class="op">&lt;-</span> <span class="fu">lm</span><span class="op">(</span><span class="va">fs1</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">ht1</span> <span class="op">+</span> <span class="va">wt1</span> <span class="op">+</span> <span class="va">alc1</span> <span class="op">+</span><span class="va">pyr1</span>, data <span class="op">=</span> <span class="va">dens_exercise</span><span class="op">)</span></span>
<span><span class="va">model_4</span> <span class="op">&lt;-</span> <span class="fu">lm</span><span class="op">(</span><span class="va">fs1</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">ht1</span> <span class="op">+</span> <span class="va">wt1</span> <span class="op">+</span> <span class="va">pyr1</span>, data <span class="op">=</span> <span class="va">dens_exercise</span><span class="op">)</span></span>
<span><span class="va">model_5</span> <span class="op">&lt;-</span> <span class="fu">lm</span><span class="op">(</span><span class="va">fs1</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">ht1</span> <span class="op">+</span> <span class="va">pyr1</span>, data <span class="op">=</span> <span class="va">dens_exercise</span><span class="op">)</span></span>
<span><span class="va">model_6</span> <span class="op">&lt;-</span> <span class="fu">lm</span><span class="op">(</span><span class="va">fs1</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">ht1</span>, data <span class="op">=</span> <span class="va">dens_exercise</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">summary</span><span class="op">(</span><span class="va">model_6</span><span class="op">)</span><span class="op">$</span><span class="va">adj.r.squared</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 0.2555525</code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="categorical-data">Categorical data<a class="anchor" aria-label="anchor" href="#categorical-data"></a>
</h2>
<hr class="half-width">
<p>We also have categorical variables in the data. Can we use them?</p>
<p>Yes!</p>
<div class="section level3">
<h3 id="first-way---categorical-values-as-independent-variables">First way - categorical values as independent variables<a class="anchor" aria-label="anchor" href="#first-way---categorical-values-as-independent-variables"></a>
</h3>
<p>Let us add information about menopausal status,
<code>men2</code>:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">density</span> <span class="op">&lt;-</span> <span class="va">density</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>men2 <span class="op">=</span> <span class="fu">factor</span><span class="op">(</span><span class="va">men2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cat_model</span> <span class="op">&lt;-</span> <span class="fu">lm</span><span class="op">(</span><span class="va">fs2</span> <span class="op">~</span> <span class="va">ht2</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">wt2</span> <span class="op">+</span> <span class="va">men2</span>, data <span class="op">=</span> <span class="va">density</span><span class="op">)</span></span>
<span><span class="fu">summary</span><span class="op">(</span><span class="va">cat_model</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
Call:
lm(formula = fs2 ~ ht2 + age + wt2 + men2, data = density)

Residuals:
      Min        1Q    Median        3Q       Max
-0.282979 -0.049356 -0.006728  0.066710  0.171457

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)
(Intercept) -0.532553   0.643852  -0.827 0.413764
ht2          0.010650   0.003898   2.732 0.009799 **
age         -0.008232   0.002098  -3.924 0.000389 ***
wt2          0.004191   0.001414   2.963 0.005450 **
men21        0.053401   0.051460   1.038 0.306514
men22       -0.026286   0.059796  -0.440 0.662939
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.1032 on 35 degrees of freedom
Multiple R-squared:  0.6067,	Adjusted R-squared:  0.5505
F-statistic:  10.8 on 5 and 35 DF,  p-value: 2.462e-06</code></pre>
</div>
<p>There are three different categorical values in <code>men2</code>. 0:
premenopausal, 1: Postmenopausal and 2: Unknown or hysterectomy.</p>
<p>If we want to add categorical data to the model, we need to make sure
they are encoded as categorical, otherwise the model will treat them as
continous values. We do that by running <code>factor()</code> on the
relevant variable.</p>
<p>Again this is relatively simple, the interpretation on the other hand
is a bit more complex. The coefficients for <code>ht2</code>,
<code>age</code> and <code>wt2</code> now tells us how the value of
<code>fs2</code> changes for the base case 0, premenopausal. The
coefficient of <code>factor(men2)1</code> tells us that there is an
added “bonus” to the bonedensity to become postmenopausal. And
<code>factor(men2)2</code> that there is a “penalty” of -0.026286 to
have the “unknown” status. The coefficients are not significant, so this
might be a bad example.</p>
</div>
<div class="section level3">
<h3 id="the-second-way---interaction">The second way - interaction<a class="anchor" aria-label="anchor" href="#the-second-way---interaction"></a>
</h3>
<p>Maybe the influence of menopause status is not direct, but rather in
the form that the coefficient for <code>wt2</code> depends on menopausal
status. Ie increasing weight might lead to increasing bonedensity. But
to different degrees depending on menopausal status.</p>
<p>We can add this interaction term to the model by multiplying the
categorical variable to the variabel where we suspect that there might
be an interaction:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interact_model</span> <span class="op">&lt;-</span> <span class="fu">lm</span><span class="op">(</span><span class="va">fs2</span> <span class="op">~</span> <span class="va">ht2</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">wt2</span><span class="op">*</span><span class="va">men2</span>, data <span class="op">=</span> <span class="va">density</span><span class="op">)</span></span>
<span><span class="fu">summary</span><span class="op">(</span><span class="va">interact_model</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
Call:
lm(formula = fs2 ~ ht2 + age + wt2 * men2, data = density)

Residuals:
      Min        1Q    Median        3Q       Max
-0.264590 -0.053534 -0.000568  0.057129  0.168441

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)
(Intercept) -0.355334   0.648878  -0.548 0.587642
ht2          0.009842   0.004014   2.452 0.019661 *
age         -0.007966   0.002084  -3.823 0.000555 ***
wt2          0.003272   0.002281   1.434 0.160913
men21       -0.166698   0.196497  -0.848 0.402355
men22        0.149021   0.264316   0.564 0.576703
wt2:men21    0.003455   0.003070   1.126 0.268439
wt2:men22   -0.002592   0.004025  -0.644 0.524081
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.1021 on 33 degrees of freedom
Multiple R-squared:  0.637,	Adjusted R-squared:  0.5601
F-statistic: 8.274 on 7 and 33 DF,  p-value: 8.211e-06</code></pre>
</div>
<p>Once again it is “simple” to do, more complicated to interpret.</p>
<p>The (estimated) coefficients for <code>ht2</code>and <code>age</code>
should be understood as before.</p>
<p>But now we have a good deal more coefficients.
<code>factor(men2)1</code> and <code>factor(men2)2</code> should also be
understood as before.</p>
<p><code>wt2</code> is also still the same as before. But we have two
new. If the specific woman is postmenopausal, there is an additional
term, wt2:men21 that needs to be added to the prediction.</p>
<div id="challenge2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p>What is the prediction for <code>fs2</code> for a 52 year old, 164
centimeter high, postmenopausal woman weighing 62 kg?</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p>We find it by adding all the terms:</p>
<ul>
<li>intercept: -0.355334</li>
<li>52 × age: 52 × -0.007966 = -0.414232</li>
<li>164 × ht2: 164 × 0.009842 = 1.613488</li>
<li>62 × wt2: 62 × 0.003272 = 0.202864</li>
<li>factor(men2)1 = -0.166698 (because men2 is = 1)</li>
<li>65 × wt2:men21 = 62 × 0.003455 = 0.21421</li>
</ul>
<p>The result is: 1.094298</p>
<p>An alternative way would be to construct a dataframe containing the
values for which we want to make the prediction, and use the
<code>predict</code> function:</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_data</span> <span class="op">&lt;-</span> <span class="fu">data.frame</span><span class="op">(</span></span>
<span>  ht2 <span class="op">=</span> <span class="fl">164</span>,</span>
<span>  age <span class="op">=</span> <span class="fl">52</span>,</span>
<span>  wt2 <span class="op">=</span> <span class="fl">62</span>,</span>
<span>  men2 <span class="op">=</span> <span class="fu">factor</span><span class="op">(</span><span class="fl">1</span>, levels <span class="op">=</span> <span class="fu">levels</span><span class="op">(</span><span class="va">density</span><span class="op">$</span><span class="va">men2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">predict</span><span class="op">(</span><span class="va">interact_model</span>, newdata <span class="op">=</span> <span class="va">new_data</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span>       <span class="fl">1</span></span>
<span><span class="fl">1.094928</span> </span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>We can do linear regression on multiple independent variables</li>
<li>Be careful not to overfit - only retain variables that are
significant (and sensible)</li>
<li>We can fit just as well on categorical variables - but make sure
they <em>are</em> categorical</li>
<li>Interpreting linear models with multiple variables are not trivial _
Interpreting linear models with interaction terms are even less
trivial</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div>
</section></section><section id="aio-logistic-regression"><p>Content from <a href="logistic-regression.html">Logistic regression</a></p>
<hr>
<p>Last updated on 2025-04-15 |

        <a href="https://github.com/KUBDatalab/R-toolbox/edit/main/episodes/logistic-regression.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 12 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do you run a logistic regression?</li>
<li>What is the connection between odds and probabilities?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Learn how to run a logistic regression</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.1     ✔ tibble    3.2.1
✔ lubridate 1.9.4     ✔ tidyr     1.3.1
✔ purrr     1.0.4
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<section><h2 class="section-heading" id="logistic-regression">Logistic Regression<a class="anchor" aria-label="anchor" href="#logistic-regression"></a>
</h2>
<hr class="half-width">
<p>Using linear regression, or even non-linear multiple regression
techniques, we can predict the expected value of a dependent continuous
variable given values of one or more independent variables.</p>
<p>But what if the dependent variable we want to predict is not
continous, but categorical?</p>
<p>Eg, if we try to predict an outcome like “Healthy/Sick” based on a
number of independent variables?</p>
<p>We do that using the logistic regression. Strictly speaking the
logistic model does not predict a yes/no answer, but rather the
probability that the answer is yes (and conversely that it is no).
Rather than the continous outcome the linear methods model for the
dependent variable, the logistic regression returns a probability. By
definition that lies somewhere between 0 and 1 (or 0% and 100%).</p>
<p>And since the linear methods we would like to use for doing the
actual logistic regression does not play nice with those bounds, we need
to think about probabilities in a different way.</p>
</section><section><h2 class="section-heading" id="a-new-way-of-thinking-about-probability-">A new way of thinking about probability.<a class="anchor" aria-label="anchor" href="#a-new-way-of-thinking-about-probability-"></a>
</h2>
<hr class="half-width">
<p>We often talk about there being a “67%” probability or chance of
something. Reading p-values, we do that all the time. A p-value of 0.05,
equivalent to 5%, tells us that if we run the test often enough, there
is a 5% chance of seeing a result as extreme as the test value purely by
chance, if the null-hypothesis is true.</p>
<p>5% is equivalent to 5 instances out of 100 possibilities. As
indicated above, we want to convert those 5% to something that does not
have a range between 0 and 1.</p>
<p>Therefore, we convert probabilities to odds.</p>
<p>Odds are a different way of representing probabilities. A lot of
statistics and probability theory have their roots in gaming and
betting, so let us use that as an example.</p>
<p>If two soccer-teams play, and we want to bet on the outcome, the
betting company we place our bet at, will give us odds. 1:9 indicates
that if the two teams play 10 times, one team will win 1 game, and the
other will win 9 times (assuming that a tie is not possible, and
glossing over a lot of other details that relates more to the companys
profits). That is equivalent to one team having a 10% chance of winning,
and the other having a 90% chance of winning.</p>
<p>The connection between the two numbers is found by:</p>
<p><span class="math display">\[odds = \frac{p}{1-p}\]</span></p>
<p>We have now transformed a probability going between 0 and 1, to odds,
that can go between 0 and positive infinity.</p>
</section><section><h2 class="section-heading" id="going-a-step-further">Going a step further<a class="anchor" aria-label="anchor" href="#going-a-step-further"></a>
</h2>
<hr class="half-width">
<p>Modelling probabilities is difficult, because they can only have
values between 0 and 1. Converting them to odds, give us something that
can have values between 0 and infinity (positive). If we take one extra
step, we can convert those odds to something that is continuous and, can
have any value.</p>
<p>We do that by taking the (natural) logarithm of the odds, and the
entire conversion from probability to log-odds, is called the
logit-function:</p>
<p><span class="math display">\[logit(p) =
\log(\frac{p}{1-p})\]</span></p>
<div id="challenge1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p>Remember the probabilities of the soccer-match? One team had a 10%
probability of winning, corresponding to odds 1:9. That means that the
other team have a 90% probability of winning, or odds 9:1. Try to run
the logit function on both of those probabilities. Do you notice a nice
relation between them?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">log</span><span class="op">(</span><span class="fl">0.1</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] -2.197225</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">log</span><span class="op">(</span><span class="fl">0.9</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fl">0.9</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 2.197225</code></pre>
</div>
<p>The two log-odds values have different signs, but are otherwise
identical. This is nice and symmetrical.</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="so---what-are-we-modelling">So - what are we modelling?<a class="anchor" aria-label="anchor" href="#so---what-are-we-modelling"></a>
</h2>
<hr class="half-width">
<p>This:</p>
<p><span class="math display">\[\text{logit}(p) = \beta_0 + \beta_1 X_1
+ \beta_2 X_2 + \dots + \beta_k X_k\]</span></p>
<p>And that looks familiar, and the net result of <em>all</em> the stuff
about odds, logit-functions etc. have exactly that as their goal; we can
now use all the nice techniques from the linear regressions to model
categorical values.</p>
<p>It’s not exactly that simple. In the linear regression we fit the
data to a line, where we in the logistic regression fits the data to a
sigmoid curve:</p>
<figure><img src="../fig/logistic-regression-rendered-logit_func_plot-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure></section><section><h2 class="section-heading" id="ok-lets-make-a-fit-already">OK, lets make a fit already!<a class="anchor" aria-label="anchor" href="#ok-lets-make-a-fit-already"></a>
</h2>
<hr class="half-width">
<p>We start be getting some data. Download the FEV dataset, but start by
creating a folder called “data”:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">download.file</span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/KUBDatalab/R-toolbox/main/episodes/data/FEV.csv"</span>, <span class="st">"data/FEV.csv"</span>, mode <span class="op">=</span> <span class="st">"wb"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Rows: 654 Columns: 6
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
dbl (6): Id, Age, FEV, Hgt, Sex, Smoke

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fev</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"data/FEV.csv"</span><span class="op">)</span></span></code></pre>
</div>
<p>The data contains measurements of age, height, sex and lung function
for 654 children, as well as an indication of wether or not they
smoke.</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fev</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 654 × 6
      Id   Age   FEV   Hgt   Sex Smoke
   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1   301     9  1.71  57       0     0
 2   451     8  1.72  67.5     0     0
 3   501     7  1.72  54.5     0     0
 4   642     9  1.56  53       1     0
 5   901     9  1.90  57       1     0
 6  1701     8  2.34  61       0     0
 7  1752     6  1.92  58       0     0
 8  1753     6  1.42  56       0     0
 9  1901     8  1.99  58.5     0     0
10  1951     9  1.94  60       0     0
# ℹ 644 more rows</code></pre>
</div>
<p>We will do a logistic regression, to see if we can predict wether or
not a child is smoking, based on all the other variables (except the Id
value).</p>
<p>As both Sex and Smoke are categorical values, it is important that
they are actually coded as categorical values in the data, in order for
R to be able to handle them as such:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fev</span> <span class="op">&lt;-</span> <span class="va">fev</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>Sex <span class="op">=</span> <span class="fu">factor</span><span class="op">(</span><span class="va">Sex</span><span class="op">)</span>,</span>
<span>         Smoke <span class="op">=</span> <span class="fu">factor</span><span class="op">(</span><span class="va">Smoke</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>We can now build a model. It looks almost like the linear model, but
rather than using the <code>lm()</code> function we use the
<code>glm()</code>, or “generalised linear model”, which is able to
handle logistic models. It <em>is</em> general, so we need to specify
that we are running a binomial (ie two possible outcomes) fit. We save
the result to an object, so we can take a closer look:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">log_model</span> <span class="op">&lt;-</span> <span class="fu">glm</span><span class="op">(</span><span class="va">Smoke</span> <span class="op">~</span> <span class="va">Age</span> <span class="op">+</span> <span class="va">FEV</span> <span class="op">+</span> <span class="va">Hgt</span> <span class="op">+</span> <span class="va">Sex</span>, family <span class="op">=</span> <span class="st">"binomial"</span>, data <span class="op">=</span> <span class="va">fev</span><span class="op">)</span></span></code></pre>
</div>
<p>The result in itself looks like this:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">log_model</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
Call:  glm(formula = Smoke ~ Age + FEV + Hgt + Sex, family = "binomial",
    data = fev)

Coefficients:
(Intercept)          Age          FEV          Hgt         Sex1
   -18.6141       0.4308      -0.5452       0.2122      -1.1652

Degrees of Freedom: 653 Total (i.e. Null);  649 Residual
Null Deviance:	    423.4
Residual Deviance: 300 	AIC: 310</code></pre>
</div>
<p>And if we take a closer look:</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">summary</span><span class="op">(</span><span class="va">log_model</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
Call:
glm(formula = Smoke ~ Age + FEV + Hgt + Sex, family = "binomial",
    data = fev)

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)
(Intercept) -18.61406    3.51282  -5.299 1.17e-07 ***
Age           0.43075    0.07098   6.069 1.29e-09 ***
FEV          -0.54516    0.31662  -1.722 0.085103 .
Hgt           0.21224    0.06371   3.331 0.000865 ***
Sex1         -1.16517    0.38943  -2.992 0.002772 **
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 423.45  on 653  degrees of freedom
Residual deviance: 300.02  on 649  degrees of freedom
AIC: 310.02

Number of Fisher Scoring iterations: 7</code></pre>
</div>
<p>Interestingly lungfunction does not actually predict smoking status
very well.</p>
<p>But what does the coefficients actually mean?</p>
<p>The intercept is not very interesting in itself, and we do not
generally interpret directly on it. It represents the log-odds of
smoking if all the predictive variables (Age, FEV, Hgt, and Sex) are 0.
And the log-odds in that case is not very informative.</p>
<p>We have a positive coefficient for Age. That means, that for each
unit increase in age, here 1 year, the log-odds for smoking increase by
0.43075, <em>if all other</em> variables are kept constant. Since we
have log-odds, we can find the increase in odds for smoking by taking
the exponential of the log-odds:</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">exp</span><span class="op">(</span><span class="fl">0.43075</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1.538411</code></pre>
</div>
<p>That is - the odds for smoking increase by 53.8% for each year a
child get older.</p>
<p>The coefficients for FEV and Hgt are treated similarly. Note that for
FEV, the coefficient is negative. That means the log-odds, and therefore
odds, for smoking decreases as lungfunction measured by FEV, increases.
As always <em>if all other</em> variables are kept constant.</p>
<p>Sex is a bit different. Because Sex is a categorical variable, the
coefficient indicates that there is a difference between the two
different sexes. And because it is negative, we can calculate that the
odds for smoking if the child is female is</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">exp</span><span class="op">(</span><span class="op">-</span><span class="fl">1.16517</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 0.3118696</code></pre>
</div>
<p>compared with male childre, equivalent to a reduction in odds by
about 68.8%</p>
</section><section><h2 class="section-heading" id="how-to-get-the-odds-quickly">How to get the odds quickly?<a class="anchor" aria-label="anchor" href="#how-to-get-the-odds-quickly"></a>
</h2>
<hr class="half-width">
<p>We can get the odds in one go, rather than running the exponential
function on them one by one:</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">exp</span><span class="op">(</span><span class="fu">coef</span><span class="op">(</span><span class="va">log_model</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> (Intercept)          Age          FEV          Hgt         Sex1
8.241685e-09 1.538413e+00 5.797479e-01 1.236439e+00 3.118701e-01 </code></pre>
</div>
<p>We use the <code>coef()</code> function to extract the coefficients,
and then take the exponential on all of them.</p>
</section><section><h2 class="section-heading" id="and-what-about-the-probabilities">And what about the probabilities?<a class="anchor" aria-label="anchor" href="#and-what-about-the-probabilities"></a>
</h2>
<hr class="half-width">
<p>Sometimes it would be nice to get probabilities instead of odds. We
can get those using this expression:</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="fu">exp</span><span class="op">(</span><span class="op">-</span><span class="fu">coef</span><span class="op">(</span><span class="va">log_model</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> (Intercept)          Age          FEV          Hgt         Sex1
8.241685e-09 6.060530e-01 3.669876e-01 5.528606e-01 2.377294e-01 </code></pre>
</div>
</section><section><h2 class="section-heading" id="and-interpreting-the-probabilities">And interpreting the probabilities?<a class="anchor" aria-label="anchor" href="#and-interpreting-the-probabilities"></a>
</h2>
<hr class="half-width">
<p>A probability of 0.606 means that for each unit increase in Age, the
probabililty of the the outcome “smoking” increases by 60.6%</p>
<p>A probablity of 0.367 means that for each unit increase in FEV, the
probability of that outcome decreases by 36.7%</p>
</section><section><h2 class="section-heading" id="what-about-the-p-values">What about the p-values?<a class="anchor" aria-label="anchor" href="#what-about-the-p-values"></a>
</h2>
<hr class="half-width">
<p>p-values in logistic regression models are interpreted in the same
way as p-values in other statistical tests:</p>
<p>Given the NULL-hypothesis that the true value for the coefficient for
FEV in our model predicting the odds for smoking/non-smoking, is 0.</p>
<p>What is the probability of getting a value for the coefficient that
is as extreme as -0.54516?</p>
<p>If we run the experiment, or take the sample, often enough, we will
see a coefficient this large, or larger (in absolute values), 8.5% of
the times. If we decide that the criterium for significanse is 5%, this
coefficient is not significant.</p>
</section><section><h2 class="section-heading" id="predictions">Predictions<a class="anchor" aria-label="anchor" href="#predictions"></a>
</h2>
<hr class="half-width">
<p>We generally experience that students are not really interested in
predicting an outcome. However part of the rationale behind building
these models is to be able to predict - outcomes.</p>
<p>Given a certain age, height, FEV and sex of a child, what is the
log-odds of that child smoking?</p>
<p>The easiest and most general way of predicting outcomes based on a
model, is to use the <code>predict()</code> function in R.</p>
<p>It takes a model, and some new data, and returns a result.</p>
<p>We begin by building a dataframe containing the new data:</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_child</span> <span class="op">&lt;-</span> <span class="fu">data.frame</span><span class="op">(</span>Age <span class="op">=</span> <span class="fl">13</span>, Hgt <span class="op">=</span> <span class="fl">55</span>, FEV <span class="op">=</span> <span class="fl">1.8</span>, Sex <span class="op">=</span> <span class="fu">factor</span><span class="op">(</span><span class="fl">1</span>, levels <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>Here we are predicting on a boy (Sex = 1), aged 13, with a lungvolume
of 1.8l and a height of 55 inches.</p>
<p>It is important that we use the same units as the model. That is, we
need to use inches for the height, liters for the lung volume, and the
correct categorical value for Sex.</p>
<p>Now we plug that into the predict function, along with the model:</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">predict</span><span class="op">(</span><span class="va">log_model</span>, newdata <span class="op">=</span> <span class="va">new_child</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span>        <span class="fl">1</span></span>
<span><span class="op">-</span><span class="fl">3.487813</span> </span></code></pre>
</div>
<p>This will return the predicted log-odds, and we can either calculate
the probability from that. Or we can add a parameter to the predict
model, to the the probability directly:_</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">predict</span><span class="op">(</span><span class="va">log_model</span>, newdata <span class="op">=</span> <span class="va">new_child</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span>         <span class="fl">1</span></span>
<span><span class="fl">0.02966099</span> </span></code></pre>
</div>
<div id="do-the-conversion-yourself" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="do-the-conversion-yourself" class="callout-inner">
<h3 class="callout-title">Do the conversion yourself</h3>
<div class="callout-content">
<p>Convert the predicted log-odds to a probability</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<p>We run the prediction:</p>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">predicted_odds</span> <span class="op">&lt;-</span> <span class="fu">predict</span><span class="op">(</span><span class="va">log_model</span>, newdata <span class="op">=</span> <span class="va">new_child</span><span class="op">)</span></span></code></pre>
</div>
<p>And then:</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="fu">exp</span><span class="op">(</span><span class="op">-</span><span class="va">predicted_odds</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span>         <span class="fl">1</span></span>
<span><span class="fl">0.02966099</span> </span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="what-about-another-child" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="what-about-another-child" class="callout-inner">
<h3 class="callout-title">What about another child?</h3>
<div class="callout-content">
<p>What is the probability for smoking for a 10 year old 110 cm tall
girl, with a lung volume of 1.1 liter?</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<p>Begin by making a dataframe describing the girl:</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_girl</span> <span class="op">&lt;-</span> <span class="fu">data.frame</span><span class="op">(</span>Age <span class="op">=</span> <span class="fl">10</span>, Hgt <span class="op">=</span> <span class="fl">110</span><span class="op">/</span><span class="fl">2.54</span>, FEV <span class="op">=</span> <span class="fl">1.1</span>, Sex <span class="op">=</span> <span class="fu">factor</span><span class="op">(</span><span class="fl">0</span>, levels <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>And use <code>predict()</code> with the correct <code>type</code>
argument to get the result directly:</p>
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">predict</span><span class="op">(</span><span class="va">log_model</span>, newdata <span class="op">=</span> <span class="va">new_girl</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span>          <span class="fl">1</span></span>
<span><span class="fl">0.003285539</span> </span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Using the predict-function to predict results is the easier way</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-clt"><p>Content from <a href="clt.html">Central Limit Theorem</a></p>
<hr>
<p>Last updated on 2025-04-15 |

        <a href="https://github.com/KUBDatalab/R-toolbox/edit/main/episodes/clt.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 12 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do you write a lesson using R Markdown and
<a href="https://carpentries.github.io/sandpaper/" class="external-link">sandpaper</a>?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Explain how to use markdown with the new lesson template</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<hr class="half-width">
<p>An important phenomenon working with data is the “Central Limit
Theorem”.</p>
<p>It states that, if we take a lot of samples from a distribution, the
mean of those samples will approximate the normal distribution, even
though the distribution in it self is not normally distributed.</p>
<p>The uniform distribution is not normally distributed. Without any
additional arguments, it will produce x random values between 0 and 1,
with equal probability for all possible values. Here we get 100 random
values, and plot a histogram of them:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">random_numbers</span> <span class="op">&lt;-</span> <span class="fu">runif</span><span class="op">(</span><span class="fl">100</span><span class="op">)</span> </span>
<span><span class="fu">hist</span><span class="op">(</span><span class="va">random_numbers</span><span class="op">)</span></span></code></pre>
</div>
<p><img src="../fig/clt-rendered-random-histogram-1.png" style="display: block; margin: auto;" class="figure">
This is definitely not normally distributed.</p>
<p>The mean of these random numbers is:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">mean</span><span class="op">(</span><span class="va">random_numbers</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 0.5148832</code></pre>
</div>
<p>The important point of the Central Limit Theorem is, that if we take
a large number of random samples, and calculate the mean of each of
these samples, the means will be normally distributed.</p>
<p>We could also have found the mean of the 100 random numbers like
this:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">mean</span><span class="op">(</span><span class="fu">runif</span><span class="op">(</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 0.5188349</code></pre>
</div>
<p>And we can use the <code>replicate()</code> function to repeat that
calculation several times, in this case 1000 times:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">repeated_means</span> <span class="op">&lt;-</span> <span class="fu">replicate</span><span class="op">(</span><span class="fl">1000</span>, <span class="fu">mean</span><span class="op">(</span><span class="fu">runif</span><span class="op">(</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>When we plot the histogram of these 1000 means of 100 random numbers,
we get this result:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">hist</span><span class="op">(</span><span class="va">repeated_means</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/clt-rendered-repeated-means-histogram-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>The histogram looks quite normally distributed, even though the
distribution from which we drew the random samples were not.</p>
<p>This is the essense of the Central Limit Theorem. The distrubution of
the means of our samples will approximate the normal distribution,
regardless of the underlying distribution.</p>
<p>Because of this, we are able to treat the mean (and a number of other
statistical descriptors), as normally distributed - <em>and</em> use the
properties we know the normal distribution to have to work with
them.</p>
<p>The math required for proving this theorem is relatively complicated,
but can be found in the (extra material)[<a href="https://kubdatalab.github.io/R-toolbox/CLT-dk.html" class="external-link uri">https://kubdatalab.github.io/R-toolbox/CLT-dk.html</a>] on
this page. Note that the proof is in Danish, we are working on an
english version.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>The mean of a sample can be treated as if it is normally
distributed</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-barcharts"><p>Content from <a href="barcharts.html">Nicer barcharts</a></p>
<hr>
<p>Last updated on 2025-04-15 |

        <a href="https://github.com/KUBDatalab/R-toolbox/edit/main/episodes/barcharts.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 12 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do we style barcharts to look better?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Explain how to use ggplot to make barcharts look better</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<hr class="half-width">
<p>Barcharts are easy to make, but how can we get them to look
nicer.</p>
<p>This is a checklist for cleaning up your barchart.</p>
<p>We start by getting some data:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.1     ✔ tibble    3.2.1
✔ lubridate 1.9.4     ✔ tidyr     1.3.1
✔ purrr     1.0.4
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">palmerpenguins</span><span class="op">)</span></span>
<span><span class="va">penguin_example</span> <span class="op">&lt;-</span> <span class="va">penguins</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">species</span><span class="op">)</span></span></code></pre>
</div>
<p>Barcharts and histograms are often confused. Histograms visualizes 1
dimentional data, barcharts 2 dimensional. The easy way to distinguish
them is the white space between the columns. Histograms are describing a
continious set of data, broken down into bins. Therefore there is no
breaks between the columns. Barcharts describes values in discrete
categories.</p>
<p>A further distinction in ggplot is between bar charts and column
charts.</p>
<p>Bar charts, made with <code>geom_bar()</code> makes the height of the
bar propotional to the number of cases/observations in each group, where
as <code>geom_col</code> makes the heights proportional to a value in
the group - that is just one value pr. group.</p>
<div id="callout1" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout</h3>
<div class="callout-content">
<p>The way this happens is in the inner workings of the ggplot object.
All <code>geom</code>s come with an associated function/argument
<code>stats</code>, that controls the statistical transformation of the
input data. In <code>geom_bar</code> that transformation is
<code>stat_count()</code>, that counts the observations in each group.
In <code>geom_col´ it is ´stat_identity()</code>, which does nothing
with the data.</p>
</div>
</div>
</div>
<div id="accordionInstructor1" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor1" aria-expanded="false" aria-controls="collapseInstructor1">
  <h3 class="accordion-header" id="headingInstructor1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Instructor Note </h3>
</button>
<div id="collapseInstructor1" class="accordion-collapse collapse" aria-labelledby="headingInstructor1" data-bs-parent="#accordionInstructor1">
<div class="accordion-body">
<p>Men det er egentlig ikke vigtigt her - fokus er på hvordan man får et
barchart til at se pænere ud.</p>
</div>
</div>
</div>
</div>
<p>The us make the first barchart:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguin_example</span> <span class="op">%&gt;%</span> </span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span><span class="fu">geom_bar</span><span class="op">(</span><span class="op">)</span> </span></code></pre>
</div>
<figure><img src="../fig/barcharts-rendered-first-example-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>This barchart is <em>boring</em>. Grey in grey.</p>
</section><section><h2 class="section-heading" id="step-1---colours-and-labels">Step 1 - colours and labels<a class="anchor" aria-label="anchor" href="#step-1---colours-and-labels"></a>
</h2>
<hr class="half-width">
<p>The first step would be to do something about the colours, and add
labels and a title to the plot:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguin_example</span> <span class="op">%&gt;%</span> </span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span><span class="fu">geom_bar</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"darkorchid3"</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu">labs</span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  y <span class="op">=</span> <span class="st">"Number of penguins"</span>,</span>
<span>  title <span class="op">=</span> <span class="st">"Number of penguins at Palmer Station, Antarctica"</span><span class="op">)</span></span></code></pre>
</div>
<p><img src="../fig/barcharts-rendered-colours-labels-1.png" style="display: block; margin: auto;" class="figure">
It is not strictly necessary to remove the label of the x-axis, but it
is superfluous in this case.</p>
</section><section><h2 class="section-heading" id="second-step---the-order-of-the-bars">Second step - the order of the bars<a class="anchor" aria-label="anchor" href="#second-step---the-order-of-the-bars"></a>
</h2>
<hr class="half-width">
<p>Note that the plot orders the species of penguins in alphabetical
order. For some purposes this is perfectly fine. But in general we
prefer to have the categories ordered by size, that is the number of
observations.</p>
<p>The order of categories can be controlled by converting the
observations to a categorical value, and ordering the levels in that
<code>factor</code> by frequency.</p>
<p>The <code>forcats</code> library makes that relatively easy, using
the function <code>fct_infreq()</code>, which converts the character
vector that is <code>species</code> to a factor with levels ordered by
frequency:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguin_example</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>species <span class="op">=</span> <span class="fu">fct_infreq</span><span class="op">(</span><span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span><span class="fu">geom_bar</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"darkorchid3"</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu">labs</span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  y <span class="op">=</span> <span class="st">"Number of penguins"</span>,</span>
<span>  title <span class="op">=</span> <span class="st">"Number of penguins at Palmer Station, Antarctica"</span><span class="op">)</span></span></code></pre>
</div>
<p><img src="../fig/barcharts-rendered-order-1.png" style="display: block; margin: auto;" class="figure">
This facilitates the reading of the graph - it becomes very easy to see
that the most frequent species of penguin is Adelie penguins.</p>
<div id="accordionInstructor2" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor2" aria-expanded="false" aria-controls="collapseInstructor2">
  <h3 class="accordion-header" id="headingInstructor2">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Instructor Note </h3>
</button>
<div id="collapseInstructor2" class="accordion-collapse collapse" aria-labelledby="headingInstructor2" data-bs-parent="#accordionInstructor2">
<div class="accordion-body">
<p>Ja, det er let nok ellers, men nu er det ekstremt let.</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="rotating-the-plot">Rotating the plot<a class="anchor" aria-label="anchor" href="#rotating-the-plot"></a>
</h2>
<hr class="half-width">
<p>We only have three here, but if we have a lot of categories, it is
often preferable to have the columns as bars on the y-axis. We do that
by changing the <code>x</code> in the <code>aes()</code> function to
<code>y</code>:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguin_example</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>species <span class="op">=</span> <span class="fu">fct_infreq</span><span class="op">(</span><span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span><span class="fu">geom_bar</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"darkorchid3"</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu">labs</span><span class="op">(</span></span>
<span>  y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  x <span class="op">=</span> <span class="st">"Number of penguins"</span>,</span>
<span>  title <span class="op">=</span> <span class="st">"Number of penguins at Palmer Station, Antarctica"</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/barcharts-rendered-rotation-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure></section><section><h2 class="section-heading" id="size-of-text">Size of text<a class="anchor" aria-label="anchor" href="#size-of-text"></a>
</h2>
<hr class="half-width">
<p>The default size of the text on labels, title etc is a bit to the
small side. To improve readability, we change the base_size parameter in
the default theme of ggplot to 14. You might need to play around with
the value, depending on the number of categories.</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguin_example</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>species <span class="op">=</span> <span class="fu">fct_infreq</span><span class="op">(</span><span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span><span class="fu">geom_bar</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"darkorchid3"</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu">labs</span><span class="op">(</span></span>
<span>  y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  x <span class="op">=</span> <span class="st">"Number of penguins"</span>,</span>
<span>  title <span class="op">=</span> <span class="st">"Number of penguins at Palmer Station, Antarctica"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_grey</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fu">rel</span><span class="op">(</span><span class="fl">1.1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p><img src="../fig/barcharts-rendered-text-size-1.png" style="display: block; margin: auto;" class="figure">
We also changed the scaling of the title of the plot. The size of that
is now 10% larger than the base size. We can do that by specifying a
specific size, but here we have done it using the <code>rel()</code>
function which changes the size relative to the base font size in the
plot.</p>
</section><section><h2 class="section-heading" id="removing-unnecessary-space">Removing unnecessary space<a class="anchor" aria-label="anchor" href="#removing-unnecessary-space"></a>
</h2>
<hr class="half-width">
<p>There is a bit of empty space between the columns and the labels on
the y-axis.</p>
<p>Let us get rid of that:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguin_example</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>species <span class="op">=</span> <span class="fu">fct_infreq</span><span class="op">(</span><span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span><span class="fu">geom_bar</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"darkorchid3"</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu">labs</span><span class="op">(</span></span>
<span>  y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  x <span class="op">=</span> <span class="st">"Number of penguins"</span>,</span>
<span>  title <span class="op">=</span> <span class="st">"Number of penguins at Palmer Station, Antarctica"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_grey</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fu">rel</span><span class="op">(</span><span class="fl">1.1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu">expansion</span><span class="op">(</span>mult <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.01</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p><img src="../fig/barcharts-rendered-unnecessary-space-1.png" style="display: block; margin: auto;" class="figure">
We control what is happening on the x-scale by using the family of
<code>scale_x</code> functions. Because it is a continuous scale, more
specifically <code>scale_x_continuous()</code>.</p>
<p>What is happening by default is that the scale is expanded relative
to the minimum and maximum values of the data. If we want to change
that, we cab either add absolute values (or subtract by using negative
values), or we can make a change relative to the data. That makes the
change robust to changes in the underlying data.</p>
<p>The mult() function in this case add 0 expansion to the left side of
the scale, and 1% ~ 0.01 to the righthand side of the scale.</p>
</section><section><h2 class="section-heading" id="remove-clutter">Remove clutter<a class="anchor" aria-label="anchor" href="#remove-clutter"></a>
</h2>
<hr class="half-width">
<p>There ar horizontal lines in the plot background that are
unnessecary. And the grey background we get by default is not very nice.
Remove them:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguin_example</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>species <span class="op">=</span> <span class="fu">fct_infreq</span><span class="op">(</span><span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span><span class="fu">geom_bar</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"darkorchid3"</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu">labs</span><span class="op">(</span></span>
<span>  y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  x <span class="op">=</span> <span class="st">"Number of penguins"</span>,</span>
<span>  title <span class="op">=</span> <span class="st">"Number of penguins at Palmer Station, Antarctica"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fu">rel</span><span class="op">(</span><span class="fl">1.1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu">expansion</span><span class="op">(</span>mult <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.01</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    panel.grid.major.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.grid.minor.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="op">)</span></span></code></pre>
</div>
<p><img src="../fig/barcharts-rendered-decluttering-1.png" style="display: block; margin: auto;" class="figure">
First we change the default theme of the plot from
<code>theme_grey</code> to <code>theme_minimal</code>, which gets rid of
the grey background. In the additional <code>theme()</code> function we
remove the gridlines, both major and minor gridlines, on the y-axis, by
setting them to the speciel plot element
<code>element_blank()</code></p>
</section><section><h2 class="section-heading" id="add-raw-numbers-to-the-plot">Add raw numbers to the plot<a class="anchor" aria-label="anchor" href="#add-raw-numbers-to-the-plot"></a>
</h2>
<hr class="half-width">
<p>Especially for barcharts, it can make sense to add the raw values to
the columns, rather than relying on reading the values from the
x-axis.</p>
<p>That <em>can</em> be done, but a more general, and easier to
understand, approach is to construct a dataframe with the data:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguin_count</span> <span class="op">&lt;-</span> <span class="fu">count</span><span class="op">(</span><span class="va">penguin_example</span>, <span class="va">species</span><span class="op">)</span></span>
<span><span class="va">penguin_example</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>species <span class="op">=</span> <span class="fu">fct_infreq</span><span class="op">(</span><span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_bar</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"darkorchid3"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Number of penguins at Palmer Station, Antarctica"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fu">rel</span><span class="op">(</span><span class="fl">1.1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_minimal</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span></span>
<span>      panel.grid.major <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>      panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_text</span><span class="op">(</span>data <span class="op">=</span> <span class="va">penguin_count</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">n</span>, y <span class="op">=</span> <span class="va">species</span>, label <span class="op">=</span> <span class="va">n</span><span class="op">)</span>,</span>
<span>    hjust <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    nudge_x <span class="op">=</span> <span class="op">-</span><span class="fl">0.25</span>,</span>
<span>    colour <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="cn">NULL</span>, expand <span class="op">=</span> <span class="fu">expansion</span><span class="op">(</span>mult <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.01</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> </span></code></pre>
</div>
<figure><img src="../fig/barcharts-rendered-count_penguins-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>In general it is a good idea to remove all extraneous pixels in the
graph. And when we add the counts directly to the plot, we can get rid
of the x-axis entirely.</p>
<p>On the other hand, it can be a good idea in this specific example, to
add a vertical indication of where the x=0 intercept is:
<code>geom_vline(xintercept = 0)</code>.</p>
<p>And: Always remember to think about the contrast between the colour
of the bars and the text!</p>
</section><section><h2 class="section-heading" id="add-labels-to-the-plot">Add labels to the plot<a class="anchor" aria-label="anchor" href="#add-labels-to-the-plot"></a>
</h2>
<hr class="half-width">
<p>We can do the same with labels if we want:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguin_example</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>species <span class="op">=</span> <span class="fu">fct_infreq</span><span class="op">(</span><span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_bar</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"darkorchid3"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    y <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Number of penguins"</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Number of penguins at Palmer Station, Antarctica"</span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fu">rel</span><span class="op">(</span><span class="fl">1.1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    panel.grid.major.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.grid.minor.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.grid.major.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.grid.minor.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu">expansion</span><span class="op">(</span>mult <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.01</span><span class="op">)</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_discrete</span><span class="op">(</span>breaks <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_text</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">penguin_count</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">n</span>, y <span class="op">=</span> <span class="va">species</span>, label <span class="op">=</span> <span class="va">n</span><span class="op">)</span>,</span>
<span>    hjust <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    nudge_x <span class="op">=</span> <span class="op">-</span><span class="fl">0.25</span>,</span>
<span>    colour <span class="op">=</span> <span class="st">"white"</span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_text</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">penguin_count</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span>, y <span class="op">=</span> <span class="va">species</span>, label <span class="op">=</span> <span class="va">species</span><span class="op">)</span>,</span>
<span>    hjust <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    nudge_x <span class="op">=</span> <span class="fl">0.25</span>,</span>
<span>    colour <span class="op">=</span> <span class="st">"white"</span>,</span>
<span>    fontface <span class="op">=</span> <span class="st">"bold"</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">4.5</span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/barcharts-rendered-labelling-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure></section><section><h2 class="section-heading" id="slimmer-bars">Slimmer bars<a class="anchor" aria-label="anchor" href="#slimmer-bars"></a>
</h2>
<hr class="half-width">
<p>Depending on aspect ratio of the final plot, number of categories
etc, we might want to adjust the width of the bars:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguin_example</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>species <span class="op">=</span> <span class="fu">fct_infreq</span><span class="op">(</span><span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_bar</span><span class="op">(</span></span>
<span>    fill <span class="op">=</span> <span class="st">"darkorchid3"</span>,</span>
<span>    width <span class="op">=</span> <span class="fl">0.4</span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    y <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Number of penguins"</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Number of penguins at Palmer Station, Antarctica"</span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fu">rel</span><span class="op">(</span><span class="fl">1.1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    panel.grid.major.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.grid.minor.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.grid.major.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    panel.grid.minor.x <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu">expansion</span><span class="op">(</span>mult <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.01</span><span class="op">)</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_discrete</span><span class="op">(</span>breaks <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_text</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">penguin_count</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">n</span>, y <span class="op">=</span> <span class="va">species</span>, label <span class="op">=</span> <span class="va">n</span><span class="op">)</span>,</span>
<span>    hjust <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    nudge_y <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>    colour <span class="op">=</span> <span class="st">"white"</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">5.5</span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_text</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">penguin_count</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span>, y <span class="op">=</span> <span class="va">species</span>, label <span class="op">=</span> <span class="va">species</span><span class="op">)</span>,</span>
<span>    hjust <span class="op">=</span> <span class="fl">0</span>, </span>
<span>    nudge_x <span class="op">=</span> <span class="fl">0.5</span>, </span>
<span>    nudge_y <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>    colour <span class="op">=</span> <span class="st">"white"</span>, </span>
<span>    fontface <span class="op">=</span> <span class="st">"bold"</span>, </span>
<span>    size <span class="op">=</span> <span class="fl">4.5</span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/barcharts-rendered-slimmer-bars-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Relatively small changes to a bar chart can make it look much more
professional</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-powerberegninger"><p>Content from <a href="powerberegninger.html">Power Calculations</a></p>
<hr>
<p>Last updated on 2025-04-15 |

        <a href="https://github.com/KUBDatalab/R-toolbox/edit/main/episodes/powerberegninger.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 12 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How large of a sample do I need to identify a result?</li>
<li>How much confidence can I get using a specific sample size?</li>
<li>How much power can I get using a specific sample size?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Explain how to use markdown with the new lesson template</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<hr class="half-width">
<p>We have some data on the lung volume of children, and want to see if
there is a difference between the (mean) lung volume of the two sexes.
Ie if the mean for boys is 1.87 and for girls is 1.84, there obviously
is a difference. But is it significant?</p>
<p>We would do that by running at two-sample t-test. The null-hypothesis
is that there is no difference between the mean of the two samples, and
if the p-value is smaller than (typically) 0.05, we will reject the
null-hypothesis.</p>
<p>That is not the same as concluding that there <em>is</em> a
difference, just that the risk of of observing such a difference by
random chance, if there really were no difference, is low (less than
5%).</p>
<p>This can go wrong in two ways. There might actually be no difference,
but we reject the null-hypothesis anyway, and conclude that a difference
exist. That is a false positive; we see a difference where none is. We
also call it a type I error.</p>
<p>On the other hand, there might really be a diffence, but we fail to
reject the null hypothesis, that is we conclude that no difference
exist, even though there <em>is</em> a difference. That is a false
negative, or a type II error.</p>
<p>The risk of a type I error is <span class="math inline">\(\alpha\)</span> - which is what we specify
choosing a level of significance, typically 0.05.</p>
<p>The risk of a type II error is related to the concept of “power”, or
<span class="math inline">\(\beta\)</span>. Thas is the chance of seeing
a difference where such a difference actually exists. And the risk of
not seeing it is therefore <span class="math inline">\(1-\beta\)</span>.</p>
<p>These two concepts are combined in power-calculations.</p>
</section><section><h2 class="section-heading" id="how-many-children-do-we-need-to-test">How many children do we need to test?<a class="anchor" aria-label="anchor" href="#how-many-children-do-we-need-to-test"></a>
</h2>
<hr class="half-width">
<p>We begin by loading the data. You can download the data <a href="https://raw.githubusercontent.com/KUBDatalab/R-toolbox/main/episodes/data/FEV.csv" class="external-link">from
this link</a>.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.1     ✔ tibble    3.2.1
✔ lubridate 1.9.4     ✔ tidyr     1.3.1
✔ purrr     1.0.4
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"data/FEV.csv"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Rows: 654 Columns: 6
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
dbl (6): Id, Age, FEV, Hgt, Sex, Smoke

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<p>The dataset have measurements of the lung capacity (FEV) for boys and
girls between the ages of 3 and 19. Since we know that there
<em>are</em> significant differences between the two sexes once they
reach puberty, we will be looking at the data for prepubescent
children.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test_data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">Age</span> <span class="op">&lt;</span> <span class="fl">10</span><span class="op">)</span></span></code></pre>
</div>
<p>The means and standard deviations can be calculated like this:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test_data</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">Sex</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span><span class="fu">summarise</span><span class="op">(</span>mean <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">FEV</span><span class="op">)</span>,</span>
<span>          sd <span class="op">=</span> <span class="fu">sd</span><span class="op">(</span><span class="va">FEV</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 2 × 3
    Sex  mean    sd
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1     0  2.00 0.508
2     1  2.07 0.514</code></pre>
</div>
<p>In this dataset the girls are coded as “0” and the boys as “1”. We
see a difference of 0.0757019.</p>
<p>Is there a difference? The null-hypothesis is that there is not. We
have two independent samples, so we are running a two-sample-t-test:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">girls</span> <span class="op">&lt;-</span> <span class="va">test_data</span> <span class="op">%&gt;%</span> </span>
<span><span class="fu">filter</span><span class="op">(</span><span class="va">Sex</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">boys</span> <span class="op">&lt;-</span> <span class="va">test_data</span> <span class="op">%&gt;%</span> </span>
<span><span class="fu">filter</span><span class="op">(</span><span class="va">Sex</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">t.test</span><span class="op">(</span><span class="va">boys</span><span class="op">$</span><span class="va">FEV</span>, <span class="va">girls</span><span class="op">$</span><span class="va">FEV</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
	Welch Two Sample t-test

data:  boys$FEV and girls$FEV
t = 1.3021, df = 306.88, p-value = 0.1939
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -0.03870191  0.19010577
sample estimates:
mean of x mean of y
 2.070799  1.995097 </code></pre>
</div>
<p>The p-value is larger than 0.05, so we do not reject the
null-hypothesis, and conclude that even though there might be a
difference, we cannot rule out the possibility that the difference we
see between the two means is happening by chance.</p>
<p>How many children should we measure, if we wanted to see a difference
of 0.0757019?</p>
<p>That is, how large a sample should we have, if we want to detect an
actual difference as small as this? This difference is often called the
effect-size.</p>
<p>The effect size is relative to the absolute size of the means. A
difference of 0.08 is easier to detect when it is between 1.99 and 2.07
than if it is between 5461.31 and 5461.39.</p>
<p>Therefore we measure the effect size in standard deviations rather
than in absolute values. We denote that as <code>d</code> or Cohen’s
d. Often we want to see a specific effect size: 0.2 is considered small,
0.5 as medium and 0.8 as large.</p>
<p>In this case we have an effect size, but needs to convert it to
standard deviations:</p>
<p><span class="math display">\[d = \frac{\mu_{boys} -
\mu_{girls}}{\sigma_{pooled}}\]</span></p>
<p>Where the pooled standard deviation is calculated with:</p>
<p><span class="math display">\[\sigma_{pooled} =
\sqrt{\frac{(n_{boys}-1)s_{boys}^2 +
(n_{girls}-1)s_{girls}^2}{n_{boys}+n_{girls} -2}}\]</span></p>
<p>Which is a weighted average of the two standard deviations.</p>
<p>We need the following values:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test_data</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">Sex</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>n <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span>, mean <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">FEV</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fu">sd</span><span class="op">(</span><span class="va">FEV</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 2 × 4
    Sex     n  mean    sd
  &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
1     0   155  2.00 0.508
2     1   154  2.07 0.514</code></pre>
</div>
<p>And now get the pooled standard deviation with:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s_p</span> <span class="op">&lt;-</span> <span class="fu">sqrt</span><span class="op">(</span><span class="op">(</span><span class="op">(</span><span class="fl">154</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="fl">0.5144072</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="op">(</span><span class="fl">155</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="fl">0.5075533</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">154</span><span class="op">+</span><span class="fl">155</span><span class="op">-</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>And can then calculate Cohen’s d, or, the effect size in standard
deviations:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">2.070799</span><span class="op">-</span><span class="fl">1.995097</span><span class="op">)</span><span class="op">/</span><span class="va">s_p</span></span>
<span><span class="va">d</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 0.1481504</code></pre>
</div>
<p>Now we almost have all our ducks in a row. There is only one number
we need to decide on - the power. In this example we decide that it
should be 0.9. To reiterate: If the difference exists, we want to have a
90% chance of detecting it.</p>
<p>Or, conversely, we are willing to accept a 10% chance of a type II
error, where we fail to detect the difference.</p>
<p>R has a built in function for doing the final calculation for a two
sample t test. But we are going to use the <code>pwr</code> library. The
results are the same, but the calculations are different for different
tests, and <code>pwr</code> provides functions for handling other
tests.</p>
<p>The function we are going to use is <code>pwr.t.test</code>:</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">pwr</span><span class="op">)</span></span>
<span><span class="fu">pwr.t.test</span><span class="op">(</span>d<span class="op">=</span><span class="va">d</span>, sig.level <span class="op">=</span> <span class="fl">0.05</span>, power <span class="op">=</span> <span class="fl">0.9</span>, type <span class="op">=</span> <span class="st">"two.sample"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
     Two-sample t test power calculation

              n = 958.4203
              d = 0.1481504
      sig.level = 0.05
          power = 0.9
    alternative = two.sided

NOTE: n is number in *each* group</code></pre>
</div>
<p>We specify the effect size (d), the significanse level (0.05), the
power we want (0.9), and the type of test we want to be able to do on
the data (“two.sample”).</p>
<p>And get the result that we need (at least) 959 observations in
<em>each</em> group, in order to see the wanted effect size, with at a
5% significanse level and with a power of 0.9.</p>
</section><section><h2 class="section-heading" id="how-large-effect-sizes-can-we-see">How large effect sizes can we see?<a class="anchor" aria-label="anchor" href="#how-large-effect-sizes-can-we-see"></a>
</h2>
<hr class="half-width">
<p>The function is smart. There are four numbers involved: The effect
size, the significanse level, the power and the number of observations.
They are all connected, and if we specify three of them, we will get the
fourth.</p>
<p>Given the number of observations we have, we can calculate the power
of the test:</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pwr.t.test</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">155</span>, d<span class="op">=</span><span class="va">d</span>, sig.level <span class="op">=</span> <span class="fl">0.05</span>, type <span class="op">=</span> <span class="st">"two.sample"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
     Two-sample t test power calculation

              n = 155
              d = 0.1481504
      sig.level = 0.05
          power = 0.2552478
    alternative = two.sided

NOTE: n is number in *each* group</code></pre>
</div>
<p>There is ~75% chance of getting a type II error.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Use <code>.md</code> files for episodes when you want static
content</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-kmeans"><p>Content from <a href="kmeans.html">k-means</a></p>
<hr>
<p>Last updated on 2025-04-15 |

        <a href="https://github.com/KUBDatalab/R-toolbox/edit/main/episodes/kmeans.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 12 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What is k-means?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Explain how to run a kmeans-clustering on data</li>
<li>Demonstrate the importance of scaling</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>Imagine we have a set of data. We might have a lot of data on the
orders from different customers in our bookshop. We would like to target
our email-campaigns to them.</p>
<p>We do not want to go through all our customers manually. We want
something automated, that partitions all our customers into eg. 10
different groups (or clusters) that are similar. Our email-campaign
should focus on books about cars and WW2 when we target customers in the
cluster that tend to buy that kind of books. And on other topics to
other clusters.</p>
<p>This is a real example from a major, danish online bookseller.</p>
<p>This is also an example of an unsupervised clustering. We do not know
the true group any given customer belongs to, and we do not want to
predict which group she will end up in. We simply want to partition our
data/customers into 10 groups.</p>
<div id="accordionSpoiler1" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler1" aria-expanded="false" aria-controls="collapseSpoiler1">
  <h3 class="accordion-header" id="headingSpoiler1">
  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div>
  Why 10?
  </h3>
</button>
<div id="collapseSpoiler1" class="accordion-collapse collapse" data-bs-parent="#accordionSpoiler1" aria-labelledby="headingSpoiler1">
<div class="accordion-body">
<p>In the case of the online bookseller the number was chosen to get a
relatively small number of clusters, in order not to have to manage 20
or more different marketing mails. But large enough to have a decent
differentation between the groups.</p>
<p>The number is often chose arbitrarily, but methods for choosing an
“optimal” number exists.</p>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="kmeans-is-a-way-of-doing-this">kmeans is a way of doing this<a class="anchor" aria-label="anchor" href="#kmeans-is-a-way-of-doing-this"></a>
</h2>
<hr class="half-width">
<p>Many unsupervised clustering algorithms exist. kmeans is just one. We
provide the data, and specify the number of clusters we want to get. The
algorithm will automatically provide us with them. And it will assign
the datapoints to individual clusters, in a way where the datapoints
have some sort of similarity of their features.</p>
</section><section><h2 class="section-heading" id="wine-as-an-example">Wine as an example<a class="anchor" aria-label="anchor" href="#wine-as-an-example"></a>
</h2>
<hr class="half-width">
<p>We might normally use the kmeans algorithm to cluster data where we
do not know the “true” clusters the data points belongs to.</p>
<p>In order to demonstrate the method, it is useful to have a dataset
where we know the true clusters.</p>
<p>Here we have a dataset, where different variables, have been measured
on wine made from three different types of grapes (cultivars).</p>
<p>The terminology differs. We have a set of columns with variables. But
these variables are also often called parameters or features. Or
dimensions</p>
<p>The dataset can be <a href="https://raw.githubusercontent.com/KUBDatalab/R-toolbox/main/episodes/data/wine.data" class="external-link">downloaded
here</a></p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span>
<span><span class="va">vin</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"data/win/wine.data"</span>, col_names <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span><span class="fu">names</span><span class="op">(</span><span class="va">vin</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"cultivar"</span>,</span>
<span>                <span class="st">"Alcohol"</span>,</span>
<span>                <span class="st">"Malicacid"</span>,</span>
<span>                <span class="st">"Ash"</span>,</span>
<span>                <span class="st">"Alcalinityofash"</span>,</span>
<span>                <span class="st">"Magnesium"</span>,</span>
<span>                <span class="st">"Totalphenols"</span>,</span>
<span>                <span class="st">"Flavanoids"</span>,</span>
<span>                <span class="st">"Nonflavanoidphenols"</span>,</span>
<span>                <span class="st">"Proanthocyanins"</span>,</span>
<span>                <span class="st">"Colorintensity"</span>,</span>
<span>                <span class="st">"Hue"</span>,</span>
<span>                <span class="st">"OD280OD315ofdilutedwines"</span>,</span>
<span>                <span class="st">"Proline"</span><span class="op">)</span></span></code></pre>
</div>
</section><section><h2 class="section-heading" id="what-does-it-do">What does it do?<a class="anchor" aria-label="anchor" href="#what-does-it-do"></a>
</h2>
<hr class="half-width">
<p>Before actually running the algorithm, we should probably take a look
at what it does.</p>
<p>K-means works by chosing K - the number of clusters we want. That is
a choice entirely up to us. In this example we will chose 3. Primarily
because we know that there <em>are</em> three different cultivars.</p>
<p>The algorithm then choses K random points, also called centroids. In
this case these centroids are in 13 dimensions, because we have 13
features in the dataset.</p>
<p>That makes it a bit difficult to visualize.</p>
<p>It then calculates the distance from each observation in the data, to
each of the K centroids. After that, each observation is assigned to the
centroid it is closest to. Each data point will therefore be assigned to
a specific cluster, described by the relevant centroid.</p>
<p>The algorithm then calculates three new centroids. All the
observations assigned to centroid A are averaged, and we get a new
centroid. The same calculations are done for the other two centroids,
and we now have three new centroids. They now actually have a relation
to the data - before they were assigned randomly, now they are based on
the data.</p>
<p>Now the algorithm repeats the calculation of distance. For each
observation in the data, which of the new centroids is it closest to it.
Since we calculated new centroids, some of the observations will switch
and will be assigned to a new centroid.</p>
<p>Again the new assignments of observations are used to calculate new
centroids for the three clusters, and all these calculations are
repeated until no observations swithces between clusters, or we have
repeated the algorithm a set number of times (by default 10 times).</p>
<p>After that, we have clustered our data in three (or whatever K we
chose) clusters, based on the features of the data.</p>
</section><section><h2 class="section-heading" id="how-do-we-actually-do-that">How do we actually do that?<a class="anchor" aria-label="anchor" href="#how-do-we-actually-do-that"></a>
</h2>
<hr class="half-width">
<p>The algorithm only works with numerical data.</p>
<p>Let us begin by removing the variable containing the true
answers.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cluster_data</span> <span class="op">&lt;-</span> <span class="va">vin</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">cultivar</span><span class="op">)</span></span></code></pre>
</div>
<p>There are only numerical values in this example, so we do not have to
remove other variables.</p>
<p>After that, we can run the function <code>kmeans</code>, and specify
that we want three centers (K), and save the result to an object, that
we can work with afterwards:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">clustering</span> <span class="op">&lt;-</span> <span class="fu">kmeans</span><span class="op">(</span><span class="va">cluster_data</span>, centers <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">clustering</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>K-means clustering with 3 clusters of sizes 47, 69, 62

Cluster means:
   Alcohol Malicacid      Ash Alcalinityofash Magnesium Totalphenols Flavanoids
1 13.80447  1.883404 2.426170        17.02340 105.51064     2.867234   3.014255
2 12.51667  2.494203 2.288551        20.82319  92.34783     2.070725   1.758406
3 12.92984  2.504032 2.408065        19.89032 103.59677     2.111129   1.584032
  Nonflavanoidphenols Proanthocyanins Colorintensity       Hue
1           0.2853191        1.910426       5.702553 1.0782979
2           0.3901449        1.451884       4.086957 0.9411594
3           0.3883871        1.503387       5.650323 0.8839677
  OD280OD315ofdilutedwines   Proline
1                 3.114043 1195.1489
2                 2.490725  458.2319
3                 2.365484  728.3387

Clustering vector:
  [1] 1 1 1 1 3 1 1 1 1 1 1 1 1 1 1 1 1 1 1 3 3 3 1 1 3 3 1 1 3 1 1 1 1 1 1 3 3
 [38] 1 1 3 3 1 1 3 3 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 3 2 3 2 2 3 2 2 3 3 3 2 2 1
 [75] 3 2 2 2 3 2 2 3 3 2 2 2 2 2 3 3 2 2 2 2 2 3 3 2 3 2 3 2 2 2 3 2 2 2 2 3 2
[112] 2 3 2 2 2 2 2 2 2 3 2 2 2 2 2 2 2 2 2 3 2 2 3 3 3 3 2 2 2 3 3 2 2 3 3 2 3
[149] 3 2 2 2 2 3 3 3 2 3 3 3 2 3 2 3 3 2 3 3 3 3 2 2 3 3 3 3 3 2

Within cluster sum of squares by cluster:
[1] 1360950.5  443166.7  566572.5
 (between_SS / total_SS =  86.5 %)

Available components:

[1] "cluster"      "centers"      "totss"        "withinss"     "tot.withinss"
[6] "betweenss"    "size"         "iter"         "ifault"      </code></pre>
</div>
<p>This is a bit overwhelming. The centroids in the three clusters are
defined by their mean values of all the dimensions/variables in them. We
can see that there appears to be a difference between the alcohol
content between all of the three clusters. Whereas the difference
between cluster 1 and 3 for malicacid is very close.</p>
<p>We also get at clustering vector, that gives the number of the
cluster each datapoint is assigned to. And we get some values for the
variation between the clusters.</p>
<div class="section level3">
<h3 id="how-well-did-it-do">How well did it do?<a class="anchor" aria-label="anchor" href="#how-well-did-it-do"></a>
</h3>
<p>We know the true values, so we extract the clusters the algorithm
found, and match them with the true values:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">testing_clusters</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>quess <span class="op">=</span> <span class="va">clustering</span><span class="op">$</span><span class="va">cluster</span>, </span>
<span>                           true <span class="op">=</span> <span class="va">vin</span><span class="op">$</span><span class="va">cultivar</span><span class="op">)</span></span></code></pre>
</div>
<p>And count the matches:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">table</span><span class="op">(</span><span class="va">testing_clusters</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>     true
quess  1  2  3
    1 46  1  0
    2  0 50 19
    3 13 20 29</code></pre>
</div>
<p>The algorithm have no idea about how the true groups are numbered, so
the numbering does not match. But it appears that i does a relatively
good job on two of the types of grapes. and is a bit confused about the
third.</p>
<p>Does that mean the algorithm does a bad job?</p>
</div>
</section><section><h2 class="section-heading" id="preprocessing-is-necessary">Preprocessing is necessary!<a class="anchor" aria-label="anchor" href="#preprocessing-is-necessary"></a>
</h2>
<hr class="half-width">
<p>Looking at the data give a hint about the problems:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="va">vin</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 6 × 14
  cultivar Alcohol Malicacid   Ash Alcalinityofash Magnesium Totalphenols
     &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;           &lt;dbl&gt;     &lt;dbl&gt;        &lt;dbl&gt;
1        1    14.2      1.71  2.43            15.6       127         2.8
2        1    13.2      1.78  2.14            11.2       100         2.65
3        1    13.2      2.36  2.67            18.6       101         2.8
4        1    14.4      1.95  2.5             16.8       113         3.85
5        1    13.2      2.59  2.87            21         118         2.8
6        1    14.2      1.76  2.45            15.2       112         3.27
# ℹ 7 more variables: Flavanoids &lt;dbl&gt;, Nonflavanoidphenols &lt;dbl&gt;,
#   Proanthocyanins &lt;dbl&gt;, Colorintensity &lt;dbl&gt;, Hue &lt;dbl&gt;,
#   OD280OD315ofdilutedwines &lt;dbl&gt;, Proline &lt;dbl&gt;</code></pre>
</div>
<p>Note the differences between the values of “Malicacid” and
“Magnesium”. One have values between 0.74 and 5.8 and the other bewtten
70 and 162. The latter influences the means much more that the
former.</p>
<p>It is therefore good practice to scale the features to have the same
range and standard deviation. A function <code>scale()</code> that does
exactly that exists in R:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">scaled_data</span> <span class="op">&lt;-</span> <span class="fu">scale</span><span class="op">(</span><span class="va">cluster_data</span><span class="op">)</span></span></code></pre>
</div>
<p>If we now do the same clustering as before, but now on the scaled
data, we get much better results:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">set.seed</span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">clustering</span> <span class="op">&lt;-</span> <span class="fu">kmeans</span><span class="op">(</span><span class="va">scaled_data</span>, centers <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu">tibble</span><span class="op">(</span>quess <span class="op">=</span> <span class="va">clustering</span><span class="op">$</span><span class="va">cluster</span>, true <span class="op">=</span> <span class="va">vin</span><span class="op">$</span><span class="va">cultivar</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">table</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>     true
quess  1  2  3
    1 59  3  0
    2  0 65  0
    3  0  3 48</code></pre>
</div>
<p>By chance, the numbering of the clusters now matches the “true”
cluster numbers.</p>
<p>The clustering is not perfect. 3 observations belonging to cluster 2,
are assigned to cluster 1 by the algorithm (and 3 more to cluster
3).</p>
<p>In this caase we know the true values. Had we not, we would still
have gotten the same groups, and could have correctly grouped the
different data points.</p>
</section><section><h2 class="section-heading" id="what-are-those-distances">What are those distances?<a class="anchor" aria-label="anchor" href="#what-are-those-distances"></a>
</h2>
<hr class="half-width">
<p>It is easy to measure the distance between two observations when we
only have two features/dimensions: Plot them on a piece of paper, and
bring out the ruler.</p>
<p>But what is the distance between this point:</p>
<p>1, 14.23, 1.71, 2.43, 15.6, 127, 2.8, 3.06, 0.28, 2.29, 5.64, 1.04,
3.92, 1065 and 1, 13.2, 1.78, 2.14, 11.2, 100, 2.65, 2.76, 0.26, 1.28,
4.38, 1.05, 3.4, 1050?</p>
<p>Rather than plotting and measuring, if we only have two observations
with two features, and we call the the observations <span class="math inline">\((x_1, y_1)\)</span> and <span class="math inline">\((x_2,y_2)\)</span> we can get the distance using
this formula:</p>
<p><span class="math display">\[d = \sqrt{(x_2 - x_1)^2 + (y_2 - y_1)^2}
\]</span></p>
<p>For an arbitrary number of dimensions we get this: <span class="math display">\[d = \sqrt{\sum_{i=1}^{n} \left(x_2^{(i)} -
x_1^{(i)}\right)^2}\]</span></p>
<p>Where the weird symbol under the squareroot sign indicates that we
add all the squared differences between the pairs of observations.</p>
</section><section><h2 class="section-heading" id="is-the-clustering-reproducible">Is the clustering reproducible?<a class="anchor" aria-label="anchor" href="#is-the-clustering-reproducible"></a>
</h2>
<hr class="half-width">
<p>Not nessecarily. If there <em>are</em> very clear clusters, in
general it will be.</p>
<p>But the algorithm is able to find clusters even if there are
none:</p>
<p>Here we have 1000 observations of two features:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test_data</span> <span class="op">&lt;-</span> <span class="fu">data.frame</span><span class="op">(</span>x <span class="op">=</span> <span class="fu">rnorm</span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu">rnorm</span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>They are as random as the random number generator can do it.</p>
<p>Let us make one clustering, and then another:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">set.seed</span><span class="op">(</span><span class="fl">47</span><span class="op">)</span></span>
<span><span class="va">kmeans_model1</span> <span class="op">&lt;-</span> <span class="fu">kmeans</span><span class="op">(</span><span class="va">test_data</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">kmeans_model2</span> <span class="op">&lt;-</span> <span class="fu">kmeans</span><span class="op">(</span><span class="va">test_data</span>, <span class="fl">5</span><span class="op">)</span></span></code></pre>
</div>
<p>And then extract the clustering and match them like before:</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tibble</span><span class="op">(</span>take_one <span class="op">=</span> <span class="va">kmeans_model1</span><span class="op">$</span><span class="va">cluster</span>,</span>
<span>        take_two <span class="op">=</span> <span class="va">kmeans_model2</span><span class="op">$</span><span class="va">cluster</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span><span class="fu">table</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>        take_two
take_one   1   2   3   4   5
       1   2 132   0  23   0
       2   2   0 217   0   2
       3   0   0  11   1 124
       4 127  73   9   0   0
       5   0  68   1 121  87</code></pre>
</div>
<p>Two clusterings on the exact same data. And they are pretty
different.</p>
<p>Do not be confused by the fact that take_one-group-4 matches rather
well with take_two-group-1. The numbering is arbitrary.</p>
<p>Visualizing it makes it even more apparent:</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tibble</span><span class="op">(</span>take_one <span class="op">=</span> <span class="va">kmeans_model1</span><span class="op">$</span><span class="va">cluster</span>,</span>
<span>        take_two <span class="op">=</span> <span class="va">kmeans_model2</span><span class="op">$</span><span class="va">cluster</span><span class="op">)</span>  <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">cbind</span><span class="op">(</span><span class="va">test_data</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span>,colour<span class="op">=</span> <span class="fu">factor</span><span class="op">(</span><span class="va">take_one</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/kmeans-rendered-unnamed-chunk-12-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tibble</span><span class="op">(</span>take_one <span class="op">=</span> <span class="va">kmeans_model1</span><span class="op">$</span><span class="va">cluster</span>,</span>
<span>        take_two <span class="op">=</span> <span class="va">kmeans_model2</span><span class="op">$</span><span class="va">cluster</span><span class="op">)</span>  <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">cbind</span><span class="op">(</span><span class="va">test_data</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span>,colour<span class="op">=</span> <span class="fu">factor</span><span class="op">(</span><span class="va">take_two</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/kmeans-rendered-unnamed-chunk-13-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>In other words - the algorithm will find clusters. And the clustering
depends, to a certain degree on the random choice of initial
centroids.</p>
</section><section><h2 class="section-heading" id="can-it-be-use-on-any-data">Can it be use on any data?<a class="anchor" aria-label="anchor" href="#can-it-be-use-on-any-data"></a>
</h2>
<hr class="half-width">
<p>No. Even though there might actually be clusters in the data, the
algorithm is not necessarily able to find them. Consider this data:
<img src="../fig/kmeans-rendered-unnamed-chunk-14-1.png" style="display: block; margin: auto;" class="figure">
There is obviously a cluster centered around (0,0). And another cluster
more or lesss evenly spread around it.</p>
<p>The algorithm <em>will</em> find two clusters:</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">tidymodels</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>── Attaching packages ────────────────────────────────────── tidymodels 1.3.0 ──</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>✔ broom        1.0.7     ✔ rsample      1.2.1
✔ dials        1.4.0     ✔ tune         1.3.0
✔ infer        1.0.7     ✔ workflows    1.2.0
✔ modeldata    1.4.0     ✔ workflowsets 1.1.0
✔ parsnip      1.3.1     ✔ yardstick    1.3.2
✔ recipes      1.2.0     </code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>── Conflicts ───────────────────────────────────────── tidymodels_conflicts() ──
✖ scales::discard() masks purrr::discard()
✖ dplyr::filter()   masks stats::filter()
✖ recipes::fixed()  masks stringr::fixed()
✖ dplyr::lag()      masks stats::lag()
✖ yardstick::spec() masks readr::spec()
✖ recipes::step()   masks stats::step()</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kmeans_model3</span> <span class="op">&lt;-</span> <span class="fu">kmeans</span><span class="op">(</span><span class="va">test_data</span><span class="op">[</span>,<span class="op">-</span><span class="fl">3</span><span class="op">]</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">cluster3</span> <span class="op">&lt;-</span> <span class="fu">augment</span><span class="op">(</span><span class="va">kmeans_model3</span>, <span class="va">test_data</span><span class="op">[</span>,<span class="op">-</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">cluster3</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span>,colour<span class="op">=</span><span class="va">.cluster</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<p><img src="../fig/kmeans-rendered-unnamed-chunk-15-1.png" style="display: block; margin: auto;" class="figure">
But not the ones we want.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>kmeans is an unsupervised technique, that will find the hidden
structure in our data that we do not know about</li>
<li>kmeans will find the number of clusters we ask for. Even if there is
no structure in the data at all</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-tuning-kmeans"><p>Content from <a href="tuning-kmeans.html">Tuning kmeans</a></p>
<hr>
<p>Last updated on 2025-04-15 |

        <a href="https://github.com/KUBDatalab/R-toolbox/edit/main/episodes/tuning-kmeans.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 12 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What k should I chose in my kmeans clustering?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Explain how to tune the hyperparameter k in kmeans</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>We know how to run a kmeans clustering on our data.</p>
<p>But one question remains. What k should we chose?</p>
<p>k-means is an unsupervised clustering technique, but we do need to
chose the number of cluster we want it to categorise our data in.</p>
<p>We might have domain knowledge informing us that there should be
three clusters.</p>
<p>But otherwise we are left to our own devices and have to make a
choice.</p>
<p>We can chose several different k, and look at the results in order to
make that determination. But we would’nt normally do this kind of thing.
It is much better to have a numerical indication independent of our own
prejudices to make the determination.</p>
<p>We call this Hyperparameter Tuning, and there are automated
techniques for this.</p>
<div id="why-hyper" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="why-hyper" class="callout-inner">
<h3 class="callout-title">Why hyper?</h3>
<div class="callout-content">
<p>Normally whe we do machine learning, we do that by adjusting a set of
parameters in order to get the best possible result. k in kmeans however
is not at parameter we learn from the data when we train the model. It
is a parameter we chose, that is part of the structure of the model
rather than something the algorithm optimises automatically.</p>
</div>
</div>
</div>
<div class="section level3">
<h3 id="what-is-a-good-clustering">What is a good clustering?<a class="anchor" aria-label="anchor" href="#what-is-a-good-clustering"></a>
</h3>
<p>One intuitive way of looking at the quality of clusters, would be to
look at the distance between all points and the clusters they have been
assigned to. A model where all points are close to their centroid, is
regarded as a better model where the points are a longer way from their
centroid.</p>
<p>We can do a k-means clustering for several different k, and calculate
the distance. As we often do when we calculate distances, we square them
in order to handle different directions of the distance. And to penalize
models with very large outliers. This sum is directly available in the
kmeans result, with the name `tot.withinss´</p>
<p>Let us look at an example.</p>
<p>We need to generate some data:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">set.seed</span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">matrix</span><span class="op">(</span><span class="fu">rnorm</span><span class="op">(</span><span class="fl">300</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre>
</div>
<p>This creates 300 random values, and places them into a matrix with
three columns.</p>
<p>Running kmeans directly with eg k = 3, can give us the total:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">kmeans</span><span class="op">(</span><span class="va">data</span>, centers <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">$</span><span class="va">tot.withinss</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 165.6211</code></pre>
</div>
<p>We could do that by hand for multiple values of k, but write a piece
of code for it:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">purrr</span><span class="op">)</span></span>
<span><span class="va">wss</span> <span class="op">&lt;-</span> <span class="fu">map_dbl</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="kw">function</span><span class="op">(</span><span class="va">k</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu">kmeans</span><span class="op">(</span><span class="va">data</span>, centers <span class="op">=</span> <span class="va">k</span>, nstart <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">$</span><span class="va">tot.withinss</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>We use a slightly advanced technique, where map_dbl is a function
that can run another function on a sequence of input. That other
function is keams, with a variable k, using the <code>$</code> notation
to extract the sum of the squared distances from the data points to
their cluster centroids.</p>
<p>We can collect that in a dataframe:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">tibble</span><span class="op">)</span></span>
<span><span class="va">wss_df</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>k <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,</span>
<span>                 wss <span class="op">=</span> <span class="va">wss</span><span class="op">)</span></span>
<span><span class="va">wss_df</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 10 × 2
       k   wss
   &lt;int&gt; &lt;dbl&gt;
 1     1 264.
 2     2 198.
 3     3 147.
 4     4 119.
 5     5 101.
 6     6  88.4
 7     7  80.2
 8     8  73.2
 9     9  66.1
10    10  61.7</code></pre>
</div>
<p>And now we can plot the result:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.1     ✔ tidyr     1.3.1
✔ lubridate 1.9.4
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wss_df</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">k</span>, y <span class="op">=</span> <span class="va">wss</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"k (number of clusters)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Total within-cluster sum of squares (WSS)"</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Elbow-method: WSS vs. k"</span></span>
<span>  <span class="op">)</span> </span></code></pre>
</div>
<p><img src="../fig/tuning-kmeans-rendered-unnamed-chunk-4-1.png" style="display: block; margin: auto;" class="figure">
It is clear that 10 clusters is better than 5. So, should we use 10?
No.</p>
<p>We will be able to get the value down to 0 if we just choose enough
clusters. And nothing new is really learnt if 100 datapoints are
assigned to 100 clusters, one each. The correct choice of k here, is the
point where the curve bends. At the hook of the elbow. Somewhere around
k = 3 or maybe k = 4. If we chose a larger k, we do get better
clustering, but we begin to overfit. The addition of an extra cluster
does not really improve the result.</p>
<div id="try-it-yourself" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="try-it-yourself" class="callout-inner">
<h3 class="callout-title">Try it yourself</h3>
<div class="callout-content">
<p>Read in the wine dataset we have looked at earlier:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">readr</span><span class="op">)</span></span>
<span><span class="va">vin</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"data/win/wine.data"</span>, col_names <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Rows: 178 Columns: 14
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
dbl (14): X1, X2, X3, X4, X5, X6, X7, X8, X9, X10, X11, X12, X13, X14

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">names</span><span class="op">(</span><span class="va">vin</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"cultivar"</span>,</span>
<span>                <span class="st">"Alcohol"</span>,</span>
<span>                <span class="st">"Malicacid"</span>,</span>
<span>                <span class="st">"Ash"</span>,</span>
<span>                <span class="st">"Alcalinityofash"</span>,</span>
<span>                <span class="st">"Magnesium"</span>,</span>
<span>                <span class="st">"Totalphenols"</span>,</span>
<span>                <span class="st">"Flavanoids"</span>,</span>
<span>                <span class="st">"Nonflavanoidphenols"</span>,</span>
<span>                <span class="st">"Proanthocyanins"</span>,</span>
<span>                <span class="st">"Colourintensity"</span>,</span>
<span>                <span class="st">"Hue"</span>,</span>
<span>                <span class="st">"OD280OD315ofdilutedwines"</span>,</span>
<span>                <span class="st">"Proline"</span><span class="op">)</span></span></code></pre>
</div>
<p>What is the optimal k for a kmeans clustering on this dataset?
Remember to remove the cultivar column.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">dplyr</span><span class="op">)</span></span>
<span><span class="va">vin</span> <span class="op">&lt;-</span> <span class="va">vin</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">cultivar</span><span class="op">)</span></span>
<span><span class="va">wss</span> <span class="op">&lt;-</span> <span class="fu">map_dbl</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="kw">function</span><span class="op">(</span><span class="va">k</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu">kmeans</span><span class="op">(</span><span class="va">vin</span>, centers <span class="op">=</span> <span class="va">k</span>, nstart <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">$</span><span class="va">tot.withinss</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu">tibble</span><span class="op">(</span>k <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,</span>
<span>                 wss <span class="op">=</span> <span class="va">wss</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">k</span>, y <span class="op">=</span> <span class="va">wss</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/tuning-kmeans-rendered-unnamed-chunk-6-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure>
</div>
</div>
</div>
</div>
<p>library(factoextra)</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Installer og load nødvendige pakker</span></span>
<span><span class="co"># install.packages("cluster")</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">cluster</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">set.seed</span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="co"># Simulerer et datasæt med 100 observationer og 3 variable</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">matrix</span><span class="op">(</span><span class="fu">rnorm</span><span class="op">(</span><span class="fl">300</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Vælg et interval for antal klynger (k)</span></span>
<span><span class="va">k_values</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">:</span><span class="fl">10</span>  <span class="co"># Silhouette kræver mindst 2 klynger</span></span>
<span></span>
<span><span class="co"># Initialiser en vektor til at gemme gennemsnitlig silhuet-bredde</span></span>
<span><span class="va">avg_silhouette</span> <span class="op">&lt;-</span> <span class="fu">numeric</span><span class="op">(</span><span class="fu">length</span><span class="op">(</span><span class="va">k_values</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Beregn k-means clustering og silhuet for hvert k</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu">seq_along</span><span class="op">(</span><span class="va">k_values</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">k</span> <span class="op">&lt;-</span> <span class="va">k_values</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">km_res</span> <span class="op">&lt;-</span> <span class="fu">kmeans</span><span class="op">(</span><span class="va">data</span>, centers <span class="op">=</span> <span class="va">k</span>, nstart <span class="op">=</span> <span class="fl">25</span><span class="op">)</span></span>
<span>  <span class="co"># Beregn afstanden mellem observationerne</span></span>
<span>  <span class="va">diss</span> <span class="op">&lt;-</span> <span class="fu">dist</span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span>  <span class="co"># Beregn silhuet-værdierne for den opnåede clustering</span></span>
<span>  <span class="va">sil</span> <span class="op">&lt;-</span> <span class="fu">silhouette</span><span class="op">(</span><span class="va">km_res</span><span class="op">$</span><span class="va">cluster</span>, <span class="va">diss</span><span class="op">)</span></span>
<span>  <span class="co"># Gem den gennemsnitlige silhuet-bredde</span></span>
<span>  <span class="va">avg_silhouette</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">mean</span><span class="op">(</span><span class="va">sil</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Plot den gennemsnitlige silhuet-bredde for hvert k</span></span>
<span><span class="fu">plot</span><span class="op">(</span><span class="va">k_values</span>, <span class="va">avg_silhouette</span>, type <span class="op">=</span> <span class="st">"b"</span>, pch <span class="op">=</span> <span class="fl">19</span>, frame <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Antal klynger (k)"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"Gennemsnitlig silhuet-bredde"</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Silhouette-metoden til valg af k"</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/tuning-kmeans-rendered-unnamed-chunk-7-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Find det optimale k (hvor gennemsnitlig silhuet er størst)</span></span>
<span><span class="va">optimal_k</span> <span class="op">&lt;-</span> <span class="va">k_values</span><span class="op">[</span><span class="fu">which.max</span><span class="op">(</span><span class="va">avg_silhouette</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu">cat</span><span class="op">(</span><span class="st">"Optimalt antal klynger ifølge silhouette-metoden er:"</span>, <span class="va">optimal_k</span>, <span class="st">"\n"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Optimalt antal klynger ifølge silhouette-metoden er: 6 </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Installer og load nødvendige pakker</span></span>
<span><span class="co"># install.packages("cluster")</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">cluster</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">set.seed</span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="co"># Simuler et datasæt med 100 observationer og 3 variable</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">matrix</span><span class="op">(</span><span class="fu">rnorm</span><span class="op">(</span><span class="fl">300</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Beregn gap-statistikken for klynger fra 1 til 10</span></span>
<span><span class="va">gap_stat</span> <span class="op">&lt;-</span> <span class="fu">clusGap</span><span class="op">(</span><span class="va">data</span>,</span>
<span>                    FUN <span class="op">=</span> <span class="va">kmeans</span>,</span>
<span>                    nstart <span class="op">=</span> <span class="fl">25</span>,</span>
<span>                    K.max <span class="op">=</span> <span class="fl">10</span>,</span>
<span>                    B <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>  <span class="co"># B er antallet af bootstrap-replikationer</span></span>
<span></span>
<span><span class="co"># Vis gap-statistikken</span></span>
<span><span class="fu">print</span><span class="op">(</span><span class="va">gap_stat</span>, method <span class="op">=</span> <span class="st">"firstmax"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Clustering Gap statistic ["clusGap"] from call:
clusGap(x = data, FUNcluster = kmeans, K.max = 10, B = 50, nstart = 25)
B=50 simulated reference sets, k = 1..10; spaceH0="scaledPCA"
 --&gt; Number of clusters (method 'firstmax'): 1
          logW   E.logW       gap     SE.sim
 [1,] 3.963826 4.441487 0.4776613 0.02498523
 [2,] 3.807349 4.233483 0.4261336 0.02539433
 [3,] 3.649488 4.085792 0.4363040 0.02790699
 [4,] 3.546001 3.961003 0.4150029 0.03199243
 [5,] 3.460285 3.858558 0.3982727 0.02996649
 [6,] 3.392734 3.767463 0.3747299 0.02782729
 [7,] 3.333614 3.691194 0.3575803 0.02710658
 [8,] 3.278133 3.623151 0.3450172 0.02665343
 [9,] 3.223328 3.563249 0.3399207 0.02649002
[10,] 3.184523 3.509952 0.3254286 0.02753950</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot gap-statistikken</span></span>
<span><span class="fu">plot</span><span class="op">(</span><span class="va">gap_stat</span>, main <span class="op">=</span> <span class="st">"Gap-statistik til valg af antal klynger"</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/tuning-kmeans-rendered-unnamed-chunk-8-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Use <code>.md</code> files for episodes when you want static
content</li>
<li>Use <code>.Rmd</code> files for episodes when you need to generate
output</li>
<li>Run <code>sandpaper::check_lesson()</code> to identify any issues
with your lesson</li>
<li>Run <code>sandpaper::build_lesson()</code> to preview your lesson
locally</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div></section><section id="aio-anova"><p>Content from <a href="anova.html">ANOVA</a></p>
<hr>
<p>Last updated on 2025-04-15 |

        <a href="https://github.com/KUBDatalab/R-toolbox/edit/main/episodes/anova.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 12 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do you perform an ANOVA?</li>
<li>What even is ANOVA?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Explain how to run an analysis of variance on models</li>
<li>Explain the requisites for runnin an ANOVA</li>
<li>Explain what an ANOVA is</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<hr class="half-width">
<p>Studying the length of penguin flippers, we notice that there is a
difference between the average length between three different species of
penguins:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">palmerpenguins</span><span class="op">)</span></span>
<span><span class="va">penguins</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">species</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>mean_flipper_length <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">flipper_length_mm</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 3 × 2
  species   mean_flipper_length
  &lt;fct&gt;                   &lt;dbl&gt;
1 Adelie                   190.
2 Chinstrap                196.
3 Gentoo                   217.</code></pre>
</div>
<p>If we only had two groups, we would use a t-test to determine if
there is a significant difference between the two groups. But here we
have three. And when we have three, or more, we use the ANOVA-method, or
rather the <code>aov()</code> function:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">aov</span><span class="op">(</span><span class="va">flipper_length_mm</span> <span class="op">~</span> <span class="va">species</span>, data <span class="op">=</span> <span class="va">penguins</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">summary</span><span class="op">(</span><span class="op">)</span> </span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>             Df Sum Sq Mean Sq F value Pr(&gt;F)
species       2  52473   26237   594.8 &lt;2e-16 ***
Residuals   339  14953      44
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
2 observations deleted due to missingness</code></pre>
</div>
<p>We are testing if there is a difference in flipper_length_mm when we
explain it as a function of species. Or, in other words, we analyse how
much of the variation in flipper length is caused by variation between
the groups, and how much is caused by variation within the groups. If
the difference between those two parts of the variation is large enough,
we conclude that there is a significant difference between the
groups.</p>
<p>In this case, the p-value is very small, and we reject the
NULL-hypothesis that there is no difference in the variance between the
groups, and conversely that we accept the alternative hypothesis that
there is a difference.</p>
</section><section><h2 class="section-heading" id="are-we-allowed-to-run-an-anova">Are we allowed to run an ANOVA?<a class="anchor" aria-label="anchor" href="#are-we-allowed-to-run-an-anova"></a>
</h2>
<hr class="half-width">
<p>There are some conditions that needs to be fullfilled.</p>
<ol style="list-style-type: decimal">
<li>The observations must be independent.</li>
</ol>
<p>In this example that we can safely assume that the length of the
flipper of a penguin is not influenced by the length of another
penguin.</p>
<ol start="2" style="list-style-type: decimal">
<li>The residuals have to be normally distributed</li>
</ol>
<p>Typically we also test if the data is normally distributed. Let us
look at both:</p>
<p>Is the data normally distributed?</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">flipper_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">species</span><span class="op">)</span></span></code></pre>
</div>
<p><img src="../fig/anova-rendered-unnamed-chunk-3-1.png" style="display: block; margin: auto;" class="figure">
That looks reasonable.</p>
<p>And the residuals?</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">aov</span><span class="op">(</span><span class="va">flipper_length_mm</span> <span class="op">~</span> <span class="va">species</span>, data <span class="op">=</span> <span class="va">penguins</span><span class="op">)</span><span class="op">$</span><span class="va">residuals</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">hist</span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/anova-rendered-unnamed-chunk-4-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>That looks fine - if we want a more specific test, those exists, but
will not be covered here.</p>
<ol start="3" style="list-style-type: decimal">
<li>Homoskedacity</li>
</ol>
<p>A weird name, it simply means that the variance in the different
groups are more or less the same. We can calculate the variance and
compare:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">species</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>variance <span class="op">=</span> <span class="fu">var</span><span class="op">(</span><span class="va">flipper_length_mm</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 3 × 2
  species   variance
  &lt;fct&gt;        &lt;dbl&gt;
1 Adelie        42.8
2 Chinstrap     50.9
3 Gentoo        42.1</code></pre>
</div>
<p>Are the variances too different? As a rule of thumb, we have a
problem if the largest variance is more than 4-5 times larger than the
smallest variance. This is OK for this example.</p>
<p>If there is too large difference in the size of the three groups,
smaller differences in variance can be problematic.</p>
<div id="accordionSpoiler1" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler1" aria-expanded="false" aria-controls="collapseSpoiler1">
  <h3 class="accordion-header" id="headingSpoiler1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div> More specific methods exist. </h3>
</button>
<div id="collapseSpoiler1" class="accordion-collapse collapse" data-bs-parent="#accordionSpoiler1" aria-labelledby="headingSpoiler1">
<div class="accordion-body">
<p>There are probably more than than three tests for homoskedacity, here
are three:</p>
<p>Fligner-Killeen test:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">fligner.test</span><span class="op">(</span><span class="va">flipper_length_mm</span> <span class="op">~</span> <span class="va">species</span>, data <span class="op">=</span> <span class="va">penguins</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
	Fligner-Killeen test of homogeneity of variances

data:  flipper_length_mm by species
Fligner-Killeen:med chi-squared = 0.69172, df = 2, p-value = 0.7076</code></pre>
</div>
<p>Bartlett’s test:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">bartlett.test</span><span class="op">(</span><span class="va">flipper_length_mm</span> <span class="op">~</span> <span class="va">species</span>, data <span class="op">=</span> <span class="va">penguins</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
	Bartlett test of homogeneity of variances

data:  flipper_length_mm by species
Bartlett's K-squared = 0.91722, df = 2, p-value = 0.6322</code></pre>
</div>
<p>Levene test:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">car</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Loading required package: carData</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
Attaching package: 'car'</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>The following object is masked from 'package:dplyr':

    recode</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>The following object is masked from 'package:purrr':

    some</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">leveneTest</span><span class="op">(</span><span class="va">flipper_length_mm</span> <span class="op">~</span> <span class="va">species</span>, data <span class="op">=</span> <span class="va">penguins</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Levene's Test for Homogeneity of Variance (center = median)
       Df F value Pr(&gt;F)
group   2  0.3306 0.7188
      339               </code></pre>
</div>
<p>For all three tests - if the p-value is &gt;0.05, there is a
significant difference in the variance - and we are not allowed to use
the ANOVA-method. In this case we are on the safe side.</p>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="but-where-is-the-difference">But where is the difference?<a class="anchor" aria-label="anchor" href="#but-where-is-the-difference"></a>
</h3>
<p>Yes, there is a difference between the average flipper length of the
three species. But that might arise from one of the species having
extremely long flippers, and there not being much difference between the
two other species.</p>
<p>So we do a posthoc analysis to confirm where the differences are.</p>
<p>The most common is the tukeyHSD test, HSD standing for “Honest
Significant Differences”. We do that by saving the result of our
ANOVa-analysis and run the <code>TukeyHSD()</code> function on the
result:</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aov_model</span> <span class="op">&lt;-</span> <span class="fu">aov</span><span class="op">(</span><span class="va">flipper_length_mm</span> <span class="op">~</span> <span class="va">species</span>, data <span class="op">=</span> <span class="va">penguins</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">TukeyHSD</span><span class="op">(</span><span class="va">aov_model</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  Tukey multiple comparisons of means
    95% family-wise confidence level

Fit: aov(formula = flipper_length_mm ~ species, data = penguins)

$species
                      diff       lwr       upr p adj
Chinstrap-Adelie  5.869887  3.586583  8.153191     0
Gentoo-Adelie    27.233349 25.334376 29.132323     0
Gentoo-Chinstrap 21.363462 19.000841 23.726084     0</code></pre>
</div>
<p>We get the estimate of the pair-wise differences and lower and upper
95% confidence intervals for those differences.</p>
<div id="try-it-on-your-own" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="try-it-on-your-own" class="callout-inner">
<h3 class="callout-title">Try it on your own</h3>
<div class="callout-content">
<p>The <code>iris</code> dataset, build into R, contains measurements of
three different species of the iris-family of flowers.</p>
<p>Is there a significant difference between the
<code>Sepal.Width</code> of the three species?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">aov</span><span class="op">(</span><span class="va">Sepal.Width</span> <span class="op">~</span><span class="va">Species</span>, data <span class="op">=</span> <span class="va">iris</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">summary</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>             Df Sum Sq Mean Sq F value Pr(&gt;F)
Species       2  11.35   5.672   49.16 &lt;2e-16 ***
Residuals   147  16.96   0.115
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="try-it-on-your-own" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="try-it-on-your-own" class="callout-inner">
<h3 class="callout-title">Try it on your own<em> (continued)</em>
</h3>
<div class="callout-content">
<p>The result only reveal that there is a difference. Or rather that we
can reject the hypothesis that there is no difference.</p>
<p>Which species differ?</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">aov</span><span class="op">(</span><span class="va">Sepal.Width</span> <span class="op">~</span><span class="va">Species</span>, data <span class="op">=</span> <span class="va">iris</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">TukeyHSD</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  Tukey multiple comparisons of means
    95% family-wise confidence level

Fit: aov(formula = Sepal.Width ~ Species, data = iris)

$Species
                       diff         lwr        upr     p adj
versicolor-setosa    -0.658 -0.81885528 -0.4971447 0.0000000
virginica-setosa     -0.454 -0.61485528 -0.2931447 0.0000000
virginica-versicolor  0.204  0.04314472  0.3648553 0.0087802</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Use <code>.md</code> files for episodes when you want static
content</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div>
</section></section><section id="aio-ucloud"><p>Content from <a href="ucloud.html">R on Ucloud</a></p>
<hr>
<p>Last updated on 2025-04-15 |

        <a href="https://github.com/KUBDatalab/R-toolbox/edit/main/episodes/ucloud.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 12 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What is Ucloud?</li>
<li>How do we use R and RStudio on Ucloud?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Explain how to acces RStudio and R on Ucloud</li>
<li>Demonstrate how to setup drives and additional software working with
Ucloud</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>You need to run R on a computer that have more muscles than you
own.</p>
<p>If you are a student at UCPH, you are in luck, because you have
access to a High Performance Computing (HPC) facility; ucloud. It can be
acessed at cloud.sdu.dk using the normal UCPH login and password.</p>
<p>Depending on the user allowances, it will look something like
this.</p>
<figure><img src="../fig/ucloud_front.png" class="figure mx-auto d-block"></figure><p>Ucloud provides access to a multitude of different applications
organized in the application store:</p>
<figure><img src="../fig/ucloud_store.png" class="figure mx-auto d-block"></figure><p>Amongst the more popular picks from the store is RStudio:</p>
<figure><img src="../fig/ucloud_picks.png" class="figure mx-auto d-block"></figure><p>This allow us to start a session of RStudio, accessible in the
browser.</p>
<figure><img src="../fig/ucloud_rstudio.png" class="figure mx-auto d-block"></figure><p>Note that we can chose different machine types. Parallel processing
is not the solution to every problem, but sometimes it is, and here we
get access to a <em>lot</em> of cores.</p>
<p>You select a suitable type of machine, chose how long you want it to
run, click submit, and after a short wait, you can click “Interface”,
and you will have, in your browser, something that looks almost exactly
like RStudio.</p>
<section><h2 class="section-heading" id="this-is-not-a-computer-as-such">This is not a computer as such<a class="anchor" aria-label="anchor" href="#this-is-not-a-computer-as-such"></a>
</h2>
<hr class="half-width">
<p>What we can start is not a computer. It is a virtual machine. A
virtual machine is not a real computer, it is a simulation of a
computer, that runs on a larger computer. Rather than installing an
operating system and software on a real computer, we ask the larger
computer to start a simulation of a computer. Since we interact with it
through the web, we might not discover the difference. But there are
some, which are important to know about.</p>
<div class="section level3">
<h3 id="compute">Compute<a class="anchor" aria-label="anchor" href="#compute"></a>
</h3>
<p>Running a virtual computer on a HPC-facility gives us access to a lot
of resources, primarily “CPU”s and “RAM”.</p>
<p>Your own computer have a CPU. It is the physical unit that actually
runs your code. When we ask R to calculate <code>1+1</code>, it is the
CPU that does the calculation.</p>
<p>Most modern CPU have multiple “cores”. So in reality it is not the
CPU that actually performs the calculation, it is one of the cores in
the CPU.</p>
<p>The computer used for writing this text have 20 cores.</p>
<p>This is nice, for the core can - in principle - only do one
calculation at a time. When we calculate <code>1+1</code>, that is the
only thing the core can do at that precise moment.</p>
<p>The thruth is a lot more complicated, but the analogy is useful in
order to understand why it can be nice to have more than one.</p>
<p>Having access to more than one core allow us to run some of our
calculations in parallel. If you are asked to do 10 simple
multiplications, you are finished when you have done 10 multiplications.
Ask a friend to help, and do 5 yourself, and let your friend do 5 - you
will be done in half the time.</p>
<p>Some calculations we want to do in R can be parallelized, where we
ask one core to distribute the tasks to 10 different cores. The
calculation will then be done much faster, than if only one core worked
on the problem.</p>
<p>Chosing a machine on Ucloud with a lot of cores will not necesarily
speed up your work. The code you run will have to be written to make use
of all the cores. And sometimes it takes longer to do that, than just
leaving all the work to a single core.</p>
<p>How do we find out how many cores we have? It should be simple. The
library <code>parallel</code> have a function <code>detectCores()</code>
that returns the number of cores we have access to:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">parallel</span><span class="fu">::</span><span class="fu">detectCores</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<p>Reading the documentation reveals that it is not that simple:</p>
<p>“Where virtual machines are in use, one would hope that the result
for logical = TRUE represents the number of CPUs available (or
potentially available) to that particular VM.”</p>
<p>Or use this:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">future</span><span class="fu">::</span><span class="fu">availableCores</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="memory">Memory<a class="anchor" aria-label="anchor" href="#memory"></a>
</h3>
<p>Looking at the interface, we see that we also get access to more
memory, or RAM.</p>
<p>RAM is the short term memory of the computer. If we want to
manipulate 10 Gb data, we need to be able to have 10 Gb of data in the
memory of the computer. And we probably need to have access to much more
than 10 Gb, because R likes to use a lot of memory, and tends to make a
copy of the data it manipulates.</p>
<p>We might therefore have to chose a certain size of virtual machine,
not because we actually need 64 cores, but because we need the
memory.</p>
</div>
<div class="section level3">
<h3 id="it-will-go-away">It will go away!<a class="anchor" aria-label="anchor" href="#it-will-go-away"></a>
</h3>
<p>Because we are running a virtual computer, rather than a real
computer, most of what we do will disappear when we restart the
computer. In R we typically installs a number of libraries or packages.
Those will vanish into thin air when the virtual machine is closed down.
In a section below we will cover access to drives on Ucloud which to a
certain degree can help us. But if we do not take precautions, we will
have to install R-packages every time we start up a new virtual machine
on Ucloud</p>
</div>
<div class="section level3">
<h3 id="cost">Cost<a class="anchor" aria-label="anchor" href="#cost"></a>
</h3>
<p>We might be tempted to let the virtual machine run forever, instead
of only for 1 hour. But Ucloud is a limited resource, and we only have a
specific allowance in total. Running a machine with one virutal CPU for
one hour consumes 1 “core-hour” of our allowance. Running a machine with
64 virtual CPUs for one hour consumes 64 core-hours. And when we run out
of allowance - the machine will close down.</p>
<p>It will also close down when the time we chose ran out.</p>
<p>Therefore, do not request more cores than you actually need.</p>
<p>On the other hand, do not request less than you need. If you chose 1
CPU, with 6 Gb RAM, and discover that you actually needed 12 Gb RAM -
you will have to shut down the virtual machine, and start a larger.</p>
<p>And because we are not running on a real computer, everything will be
lost.</p>
</div>
<div class="section level3">
<h3 id="your-drive">Your drive<a class="anchor" aria-label="anchor" href="#your-drive"></a>
</h3>
<p>Not all is lost when you restart a virtual machine. Ucloud provides
you with a drive:</p>
<figure><img src="../fig/ucloud_drive.png" class="figure mx-auto d-block"></figure><p>In it we find a listing of what is in our drive: <img src="../fig/ucloud_drive_2.png" class="figure"></p>
<p>The folder “Jobs” contains data from the individual runs of virtual
machines you have done. And Trash contains deleted files.</p>
<p>Note that the content of both these folders counts towards the total
storage you have available - so consider deleting them regularly.</p>
<p>It is recommended to create a folder for your work. Choose “Create
folder” and give it a name. For this example we will call it
“ml-course”.</p>
<div id="caution1" class="callout caution">
<div class="callout-square">
<i class="callout-icon" data-feather="alert-triangle"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Caution</h3>
<div class="callout-content">
<p>Do not use white spaces in your folder or file names. Most
programming languages are able to handle them, but will almost always
require special steps to be taken. Having white spaces in file names
introduces a potential for problems that can be difficult to identify
and fix.</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="lets-get-started">Lets get started!<a class="anchor" aria-label="anchor" href="#lets-get-started"></a>
</h2>
<hr class="half-width">
<p>Go to the app-store as shown above, and chose RStudio.</p>
<p>Chose the “u1-standard-2” machinetype with 2 virtual CPUs and 12 GB
memory.</p>
<p>In order to be able to access our files, go to “Select folders to
use” and click add folder:</p>
<figure><img src="../fig/ucloud_start.png" class="figure mx-auto d-block"></figure><p>Click in “No directory selected” and then on “Use” to choose
“ml-course”:</p>
<figure><img src="../fig/ucloud_start_1.png" class="figure mx-auto d-block"></figure><p>And than click “Submit”</p>
<p>Your request is being processed:</p>
<figure><img src="../fig/ucloud_start_2.png" class="figure mx-auto d-block"></figure><p>And after a short while, you get this:</p>
<figure><img src="../fig/ucloud_start_3.png" class="figure mx-auto d-block"></figure><p>We can see what type of machine we chose, and how much time is
remaining. We chose 1 hour, and we can extend the runtime by 1, 8 or 24
hours.</p>
<p>We can also see the “Open interface” button.</p>
<p>If we click that, RStudio opens and we can begin working with R.</p>
<p>The very first thing we should always do, is to create a project. At
the upper right hand corner we see where we can do that:</p>
<figure><img src="../fig/ucloud_rstudio_2.png" class="figure mx-auto d-block"></figure><p>Click new project, create it in a “new Directory” and change the
subdirectory in which the project is created to the directory we made
earlier. THIS IS IMPORTANT!</p>
<figure><img src="../fig/ucloud_rstudio_3.png" class="figure mx-auto d-block"></figure><p>We now have a project running in RStudio on a virtual machine on
UCloud, and we are ready to work!</p>
</section><section><h2 class="section-heading" id="housekeeping">Housekeeping<a class="anchor" aria-label="anchor" href="#housekeeping"></a>
</h2>
<hr class="half-width">
<div class="section level3">
<h3 id="what-to-do-if-rstudio-appears-to-freeze">What to do if RStudio appears to freeze?<a class="anchor" aria-label="anchor" href="#what-to-do-if-rstudio-appears-to-freeze"></a>
</h3>
<p>First of all - have patience. RStudio appears almost the same when it
is frozen and if it is working on something that takes time. But take
advantadge of the fact that this is just a web interface to what is
actually running on a virtual remote machine. Close the interface, and
open it again. R will still be there.</p>
</div>
<div class="section level3">
<h3 id="where-can-i-find-the-job-again">Where can I find the job again?<a class="anchor" aria-label="anchor" href="#where-can-i-find-the-job-again"></a>
</h3>
<p>Sometimes we close a window, or nagivate away from it. Where can we
find it again? In the navigationbar to the left in Ucloud we find this
icon. <img src="../fig/ucloud_running_jobs.png" class="figure"> It provides us with a
list or running jobs (yes, we can have more than one). Click on the job,
and we get back to the job, where we can extend time or open the
interface again.</p>
</div>
<div class="section level3">
<h3 id="im-done-early---how-do-i-stop-the-job">I’m done early - how do I stop the job?<a class="anchor" aria-label="anchor" href="#im-done-early---how-do-i-stop-the-job"></a>
</h3>
<p>If you are done with your work, and there is no reason to continue
running the machine, you can stop it early. Find the job (see above),
and click and hold the “Stop application” button. Remember to save your
scripts in RStudio first!</p>
<ul>
<li>how to download an entire folder, so they can download their work at
the end of the semester (without having to learn how to sync folders,
which I imagine will be too much to ask from this workshop)
archiver…</li>
</ul>
</div>
<div class="section level3">
<h3 id="how-do-i-get-files-out-of-ucloud">How do I get files out of UCloud?<a class="anchor" aria-label="anchor" href="#how-do-i-get-files-out-of-ucloud"></a>
</h3>
<p>This can be done in several different ways. Ucloud provides guides on
how to syncronise files. And there are archiving tools that can zip and
download your files.</p>
<p>The easy way is to do it through RStudio. Select the folder and/or
files you want to save, click on the little cogwheel saying “More” and
chose “Export”. RStudio will now zip the files, and ask you where to
save them. <img src="../fig/ucloud_save.png" class="figure"></p>
</div>
<div class="section level3">
<h3 id="how-do-i-get-files-into-ucloud">How do I get files into UCloud<a class="anchor" aria-label="anchor" href="#how-do-i-get-files-into-ucloud"></a>
</h3>
<p>Again - Ucloud have services that can assist. But the easiest way is
to note that there is an “Upload” button in the Files pane in RStudio.
Use that.</p>
</div>
<div class="section level3">
<h3 id="what-types-of-machines-did-i-have-access-to">What types of machines did I have access to?<a class="anchor" aria-label="anchor" href="#what-types-of-machines-did-i-have-access-to"></a>
</h3>
<p>UCloud offers the possibility of “projects” where you choices might
be different. If you’re not in a “project” these will be the default
options:</p>
<table class="table">
<thead><tr class="header">
<th>name</th>
<th>vcpu</th>
<th>memory (GB)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>u1-standard-1</td>
<td>1</td>
<td>6</td>
</tr>
<tr class="even">
<td>u1-standard-2</td>
<td>2</td>
<td>12</td>
</tr>
<tr class="odd">
<td>u1-standard-4</td>
<td>4</td>
<td>24</td>
</tr>
<tr class="even">
<td>u1-standard-8</td>
<td>8</td>
<td>48</td>
</tr>
<tr class="odd">
<td>u1-standard-16</td>
<td>16</td>
<td>96</td>
</tr>
<tr class="even">
<td>u1-standard-32</td>
<td>32</td>
<td>192</td>
</tr>
<tr class="odd">
<td>u1-standard-64</td>
<td>64</td>
<td>384</td>
</tr>
</tbody>
</table>
</div>
</section><section><h2 class="section-heading" id="setup-issues">Setup issues<a class="anchor" aria-label="anchor" href="#setup-issues"></a>
</h2>
<hr class="half-width">
<p>We can save our work, and as long as we do not delete it again, we
have access to it. And keeping stuff in a project in R makes everything
easy(ish) to locate.</p>
<p>That, in general works nicely on a “real” computer, where libraries
and other elements of what we work with is saved locally.</p>
<p>On a virtual computer, locally is in the memory of a larger computer,
and as hinted at, these locally stored files disappear when the virtual
machine is restarted.</p>
<p>If you usually start your code with <code><a href="https://tidyverse.tidyverse.org" class="external-link">library(tidyverse)</a></code>,
you will, on a virtual machine, have to start with
<code>install.packages("tidyverse")</code> instead. <em>Every
time!</em></p>
<p>Working with machine learning makes this even worse. Many of the
algorithms we work with requires us to have specific Python libraries
installed, and available to R. They also disappear.</p>
<p>And to complicate matters even more, some of them require specific
versions of Python, and are unable to run on the newest version. And by
default the version of Python on Ucloud is the newest.</p>
<p>Below we present two ways of handling this. First “The Good
Solution”. Which could be better. And “The Sledgehammer Solution”. Which
is the reason we call “The Good Solution” good.</p>
</section><section><h2 class="section-heading" id="the-good-solution">The Good Solution<a class="anchor" aria-label="anchor" href="#the-good-solution"></a>
</h2>
<hr class="half-width">
<p>First of all, and <em>this is important!</em> you chose the folder we
demonstrated how to use earlier:</p>
<figure><img src="../fig/ucloud_start_1.png" class="figure mx-auto d-block"></figure><p>The method requires the setup to know exactly where your files
are.</p>
<p>Secondly, and for the same reason, you <em>must</em> create a project
in the folder you attached to the run of the virtual machine.</p>
<p>Then make a script-file. It is not important what you call it, here
we call it “setup.R”</p>
<p>Copy the code below into that file, and run the code
<em>line-by-line</em>.</p>
<p>Some of the lines of code restart R. This is necessary for R to
read-in new options and settings. And when R is restarted, it does not
know where to continue.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set path to renv cache</span></span>
<span><span class="fu">writeLines</span><span class="op">(</span><span class="st">'RENV_PATHS_CACHE = "renv/cache"'</span>, <span class="st">".Renviron"</span><span class="op">)</span></span>
<span><span class="co"># restart R in order to set the environment variable</span></span>
<span><span class="fu">.rs.restartR</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Initializing renv. You will be asked if you want to do it. You do.</span></span>
<span><span class="fu">renv</span><span class="fu">::</span><span class="fu">init</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Yes, it should be possible to do this in one go. </span></span>
<span><span class="co"># It fails. So, three lines of code...</span></span>
<span><span class="fu">renv</span><span class="fu">::</span><span class="fu">install</span><span class="op">(</span><span class="st">"reticulate"</span>, prompt <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu">renv</span><span class="fu">::</span><span class="fu">install</span><span class="op">(</span><span class="st">'rstudio/tensorflow'</span>, prompt <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu">renv</span><span class="fu">::</span><span class="fu">install</span><span class="op">(</span><span class="st">"rstudio/keras"</span>, prompt <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Install miniconda - control where</span></span>
<span><span class="fu">reticulate</span><span class="fu">::</span><span class="fu">install_miniconda</span><span class="op">(</span>path <span class="op">=</span> <span class="st">"python_env"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Storing information about installed packages</span></span>
<span><span class="co"># You might be asked if you want to proceed. You do.</span></span>
<span><span class="fu">renv</span><span class="fu">::</span><span class="fu">snapshot</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># restart R to ensure that R knows where miniconda is installed</span></span>
<span><span class="fu">.rs.restartR</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create python environment</span></span>
<span><span class="fu">reticulate</span><span class="fu">::</span><span class="fu">conda_create</span><span class="op">(</span></span>
<span>  envname <span class="op">=</span> <span class="st">"my_project_env"</span>,</span>
<span>  packages <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"python=3.10"</span>, <span class="st">"openssl=3.3.0"</span><span class="op">)</span>,</span>
<span>  channels <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"conda-forge"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Install Python packages in the environment</span></span>
<span><span class="fu">reticulate</span><span class="fu">::</span><span class="fu">conda_install</span><span class="op">(</span>envname <span class="op">=</span> <span class="st">"my_project_env"</span>, </span>
<span>                          packages <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"numpy&gt;=1.24"</span>, </span>
<span>                                       <span class="st">"pandas&gt;=2.1"</span>, </span>
<span>                                       <span class="st">"tensorflow&gt;=2.13"</span>, </span>
<span>                                       <span class="st">"keras&gt;=2.13"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">reticulate</span><span class="fu">::</span><span class="fu">conda_install</span><span class="op">(</span>envname <span class="op">=</span> <span class="st">"my_project_env"</span>, packages <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"transformers&gt;=4.30"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">reticulate</span><span class="fu">::</span><span class="fu">conda_install</span><span class="op">(</span>envname <span class="op">=</span> <span class="st">"my_project_env"</span>, packages <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"pytorch"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Restart R - this might not be necessary - we do it anyway</span></span>
<span><span class="fu">.rs.restartR</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Specify which environment is to be used</span></span>
<span><span class="fu">reticulate</span><span class="fu">::</span><span class="fu">use_condaenv</span><span class="op">(</span><span class="st">"my_project_env"</span>, required <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Storing information about installed packages</span></span>
<span><span class="co"># You might be asked if you want to proceed. You do.</span></span>
<span><span class="fu">renv</span><span class="fu">::</span><span class="fu">snapshot</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div id="accordionInstructor1" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor1" aria-expanded="false" aria-controls="collapseInstructor1">
  <h3 class="accordion-header" id="headingInstructor1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Instructor Note </h3>
</button>
<div id="collapseInstructor1" class="accordion-collapse collapse" data-bs-parent="#accordionInstructor1" aria-labelledby="headingInstructor1">
<div class="accordion-body">
<p>Det svære her er at få korrekte versioner. Og at få openssl
installeret med den samme version som der kører på systemet.</p>
<p>Det betyder også, at hvis systemets python-version ændres - kan vi få
fejlbeskeder om at ssl ikke kan findes.</p>
</div>
</div>
</div>
</div>
<p>One way to check that everything worked, is to run the following
script:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">.rs.restartR</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">reticulate</span><span class="fu">::</span><span class="fu">use_condaenv</span><span class="op">(</span><span class="st">"my_project_env"</span>, required <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">keras3</span><span class="op">)</span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu">keras_model_sequential</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">layer_dense</span><span class="op">(</span>units <span class="op">=</span> <span class="fl">32</span>, input_shape <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">784</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">layer_activation</span><span class="op">(</span><span class="st">"relu"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">layer_dense</span><span class="op">(</span>units <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">layer_activation</span><span class="op">(</span><span class="st">"softmax"</span><span class="op">)</span></span>
<span><span class="fu">summary</span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#importing the transformers python module</span></span>
<span><span class="va">transformers</span> <span class="op">&lt;-</span> <span class="fu">reticulate</span><span class="fu">::</span><span class="fu">import</span><span class="op">(</span><span class="st">"transformers"</span><span class="op">)</span> </span>
<span><span class="va">autotoken</span> <span class="op">&lt;-</span> <span class="va">transformers</span><span class="op">$</span><span class="va">AutoTokenizer</span></span>
<span><span class="va">autoModelClass</span> <span class="op">&lt;-</span> <span class="va">transformers</span><span class="op">$</span><span class="va">AutoModelForSequenceClassification</span></span>
<span></span>
<span><span class="va">modelname</span> <span class="op">&lt;-</span> <span class="st">"distilbert-base-uncased-finetuned-sst-2-english"</span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="va">autoModelClass</span><span class="op">$</span><span class="fu">from_pretrained</span><span class="op">(</span><span class="va">modelname</span><span class="op">)</span></span></code></pre>
</div>
<p>If you get a nice summary, everything worked. You might get messages
about “ssl not installed”. Those can be ignored. And you will also get
warnings about tensorflow not being compiled for working with “GPU”s.
Since we do not have access to GPU on the kind of virtual machines we
can run RStudio on, on UCloud, these can safely be ignored.</p>
<div class="section level4">
<h4 id="do-i-have-to-do-this-every-time">Do I have to do this every time?<a class="anchor" aria-label="anchor" href="#do-i-have-to-do-this-every-time"></a>
</h4>
<p>Good news everybody! No.</p>
<p><em>If</em> you start a new virtual machine, and add the
<em>same</em> folder in you drive on Ucloud to the run, you can open
your project again: Navigate to the project folder (you did remember the
name, right?), and click on the .Rproj file with the same name as your
project.</p>
<p>Due to the way Renv works, it might take some time to open the
project:¨</p>
<figure><img src="../fig/ucloud_taking_longer.png" class="figure mx-auto d-block"></figure><p>And for reasons we do not entirely understand at KUB Datalab (yet),
we also have to run the</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">.rs.restartR</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">reticulate</span><span class="fu">::</span><span class="fu">use_condaenv</span><span class="op">(</span><span class="st">"my_project_env"</span>, required <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<p>Before actually doing anything.</p>
</div>
<div class="section level4">
<h4 id="what-about-other-packages">What about other packages?<a class="anchor" aria-label="anchor" href="#what-about-other-packages"></a>
</h4>
<p>When you have run the setup above, and opened the project,
<code>renv</code> is running and keeping track of stuff.</p>
<p>That also means that if you need another package -
<code>tidyverse</code> comes to mind as a frequently used set of
packages, you simply install tidyverse running
<code>install.packages("tidyverse")</code> just as you would normally
do. These new packages are now installed in your project and will be
available without having to install them repeatedly.</p>
<p>But remember to run <code>renv::snapshot()</code> afterwards to
update the registration <code>renv</code> keeps of installed
packages.</p>
</div>
<div class="section level4">
<h4 id="other-issues">Other issues<a class="anchor" aria-label="anchor" href="#other-issues"></a>
</h4>
<p>Renv is a bit finicky. You might get messages about packages being in
“an inconsistent state”. Try running this first:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">renv</span><span class="fu">::</span><span class="fu">restore</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<p>And if that does not solve the problem, try:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">renv</span><span class="fu">::</span><span class="fu">rehash</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">renv</span><span class="fu">::</span><span class="fu">snapshot</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">renv</span><span class="fu">::</span><span class="fu">restore</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<p>Sometimes renv forgets that a library is installed…</p>
<p>Fortunately the libraries are easily available, so an</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">renv</span><span class="fu">::</span><span class="fu">install</span><span class="op">(</span><span class="st">"rstudio/keras3"</span><span class="op">)</span></span></code></pre>
</div>
<p>is fast. The example shows keras3 - exchange the package name for
what is actually missing.</p>
</div>
<div class="section level3">
<h3 id="the-sledgehammer-solution">The sledgehammer solution<a class="anchor" aria-label="anchor" href="#the-sledgehammer-solution"></a>
</h3>
<p>This has worked consistently. But take a long time and needs to be
repeated every time you start a new machine. It will work, but only by
being pretty violent with the virtual machine.</p>
<p>When you have started the virtual machine, and opened a project, make
a new R-script in the project, copy the following code (or download it
from here), and run it line by line.</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run shell commands from R</span></span>
<span><span class="fu">system2</span><span class="op">(</span><span class="st">"sudo"</span>, args <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"add-apt-repository"</span>, <span class="st">"-y"</span>, <span class="st">"ppa:deadsnakes/ppa"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">system2</span><span class="op">(</span><span class="st">"sudo"</span>, args <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"apt-get"</span>, <span class="st">"update"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">system2</span><span class="op">(</span><span class="st">"sudo"</span>, args <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"apt-get"</span>, <span class="st">"install"</span>, <span class="st">"-y"</span>, <span class="st">"python3.9"</span>, <span class="st">"python3.9-venv"</span>, <span class="st">"python3.9-dev"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Python setup</span></span>
<span><span class="fu">system2</span><span class="op">(</span><span class="st">"python3.9"</span>, args <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"-m"</span>, <span class="st">"ensurepip"</span>, <span class="st">"--upgrade"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">system2</span><span class="op">(</span><span class="st">"python3.9"</span>, args <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"-m"</span>, <span class="st">"pip"</span>, <span class="st">"install"</span>, <span class="st">"--upgrade"</span>, <span class="st">"pip"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">system2</span><span class="op">(</span><span class="st">"python3.9"</span>, args <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"-m"</span>, <span class="st">"pip"</span>, <span class="st">"install"</span>, <span class="st">"numpy"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create and activate environment</span></span>
<span><span class="fu">system2</span><span class="op">(</span><span class="st">"python3.9"</span>, args <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"-m"</span>, <span class="st">"venv"</span>, <span class="st">"~/r-tensorflow"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Activate virtual environment and install packages</span></span>
<span><span class="fu">system2</span><span class="op">(</span><span class="st">"bash"</span>, args <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"-c"</span>, <span class="st">"source ~/r-tensorflow/bin/activate &amp;&amp; pip install numpy tensorflow keras spacy &amp;&amp; python -m spacy download en_core_web_sm &amp;&amp; deactivate"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># R packages and setup</span></span>
<span><span class="fu">Sys.unsetenv</span><span class="op">(</span><span class="st">'RETICULATE_PYTHON'</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">reticulate</span><span class="op">)</span></span>
<span><span class="fu">use_virtualenv</span><span class="op">(</span><span class="st">'~/r-tensorflow'</span>, required <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">install.packages</span><span class="op">(</span><span class="st">'remotes'</span><span class="op">)</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">'rstudio/tensorflow'</span>, upgrade <span class="op">=</span> <span class="st">'always'</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">tensorflow</span><span class="op">)</span></span>
<span><span class="fu">install_tensorflow</span><span class="op">(</span>envname <span class="op">=</span> <span class="st">'~/r-tensorflow'</span>, restart_session <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">'rstudio/keras'</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">keras3</span><span class="op">)</span></span>
<span><span class="fu">install_keras</span><span class="op">(</span>envname <span class="op">=</span> <span class="st">'~/r-tensorflow'</span><span class="op">)</span></span></code></pre>
</div>
<p>You can check that it is working similarly to the better solution
above.</p>
<div id="accordionSpoiler1" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler1" aria-expanded="false" aria-controls="collapseSpoiler1">
  <h3 class="accordion-header" id="headingSpoiler1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div> Notes on the good solution </h3>
</button>
<div id="collapseSpoiler1" class="accordion-collapse collapse" data-bs-parent="#accordionSpoiler1" aria-labelledby="headingSpoiler1">
<div class="accordion-body">
<p>Data analysis is not worth much, if we are not able to reproduce our
results. A significant amount of work have therefore gone into providing
infrastructure for exactly that. One issue is the question of which
libraries are used for the analysis.</p>
<p>Enter <code>renv</code>. <code>renv</code> is a library that
establishes scaffolding for installing libraries in a specific location
in an R-project, making it self contained and easy to distribute.
Normally we would distribute a “lock file” that describes exactly which
versions of which packages are used in a project.</p>
<p>You will see a lot of stuff in the “files” tab. A folder called
“renv”, a file “renv.lock”, and probably a file “.Rprofile”.</p>
<p>Looking into that, we will find a line of code
“source(”renv/activate.R”)”</p>
<p>When ever we start the project, what ever we have written to
.Rprofile will be run. What will be run in this case is the script
“activate.R” which does a lot of interesting stuff. The important thing
is, that the renv-library is started. And whenever we now install a
package, it will be installed in the renv folder. Do not delve too deep
into that, leave it to the machine.</p>
<p>One issue with this is, that there are still installed packages weird
places on the machine. Caches of the packages are stored outside our
project. The idea is that other projects might use these cached
packages, and cut down on install time.</p>
<p>In our case, that is not helpful. This cache will disappear when the
virtual machine is stopped.</p>
<p>In order to handle this, we can specify where the cache should be
stored. We can do that manually. Or, and this is the preffered solution,
make a file .Renviron where we specify where renv should place the
cache. Having done that we need to restart R, and now we can install
packages to our hearts delight, and renv will place both the libraries
and the cache in our local project.</p>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Ucloud provide access to a multitude of advanced software that we
are not able to run locally</li>
<li>Running RStudio on Ucloud give us access to more compute and memory
than we have on our own computer</li>
<li>More advanced work might require a quite complicated setup</li>
<li>Restarting a virtual machine means all our work and setup might be
lost, unless we take certain precautions.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div>
</section></section><section id="aio-pipes"><p>Content from <a href="pipes.html">A deeper dive into pipes</a></p>
<hr>
<p>Last updated on 2025-04-15 |

        <a href="https://github.com/KUBDatalab/R-toolbox/edit/main/episodes/pipes.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 12 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What are the differences between the two pipes?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Explain some of the differences between the two families of
pipes</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>Almost everywhere in this course material, you will see the pipe.</p>
<p>But the story about the pipe is larger than <code>%&gt;%</code>.</p>
<p>The <code>%&gt;%</code> version come from the <code>magrittr</code>
package, and was introduced to the R-world in 2014. It became one of the
defining features of the R-dialect “tidyverse”. It proved useful enough
that a similar pipe <code>|&gt;</code> was introduced in “base-R” with
version 4.1 in May 2021.</p>
<div id="accordionSpoiler1" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler1" aria-expanded="false" aria-controls="collapseSpoiler1">
  <h3 class="accordion-header" id="headingSpoiler1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div> R dialects </h3>
</button>
<div id="collapseSpoiler1" class="accordion-collapse collapse" aria-labelledby="headingSpoiler1" data-bs-parent="#accordionSpoiler1">
<div class="accordion-body">
<p>R-programmers tend to write in one dialect of R, small variations
that are understandable - but still different. The three common dialects
are “base R”, the tidyverse and data.table. One of the defining features
of the tidyverse dialect has been the magrittr pipe. This differences is
eroding with the introduction of the native pipe in base R.</p>
<p>KUB Datalab speaks the tidyverse dialect, and will continue to use
the magrittr pipe until the default keyboard shortcut to the pipe in
RStudio changes</p>
</div>
</div>
</div>
</div>
<p>The base-R pipe function in a similar way to the magrittr pipe. But
there are differences:</p>
<table style="width:99%;" class="table">
<colgroup>
<col width="19%">
<col width="45%">
<col width="25%">
<col width="9%">
</colgroup>
<thead><tr class="header">
<th>Topic</th>
<th>Magrittr 2.0.3</th>
<th>Base 4.3.0</th>
<th>note</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Operator</td>
<td><code>%\&gt;%  %\&lt;\&gt;%  %$%  %!&gt;%  %T&gt;%</code></td>
<td><code>|&gt;</code></td>
<td>1</td>
</tr>
<tr class="even">
<td>Function calls</td>
<td><code>1:2 %&gt;% sum()</code></td>
<td><code>1:2 |&gt; sum()</code></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td><strong><code>1:2 %&gt;% sum</code></strong></td>
<td>Needs the parentheses</td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>
<code>1:3 %&gt;%</code>`+` <code>4</code>
</td>
<td>Not every function is supported</td>
<td></td>
</tr>
<tr class="odd">
<td>Insert on first empty place</td>
<td><code>mtcars %&gt;% lm(formula=mpg ~ disp)</code></td>
<td><code>mtcars |&gt; lm(formula = mpg ~ disp)</code></td>
<td>2</td>
</tr>
<tr class="even">
<td>placeholder</td>
<td>.</td>
<td>_</td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td><code>mtcars %&gt;% lm(mpg~disp, data = .)</code></td>
<td><code>mtcars |&gt; lm(mpg ~ disp, data = _)</code></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td><code>mtcars %&gt;% lm(mpg~disp, .)</code></td>
<td>Needs named argument</td>
<td>3</td>
</tr>
<tr class="odd">
<td></td>
<td><code>1:3 %&gt;% setNames(., .)</code></td>
<td>Can only appear once</td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td><code>1:3 %&gt;% {sum(sqrt(.))}</code></td>
<td>Nested calls not allowed</td>
<td>4</td>
</tr>
<tr class="odd">
<td>Extraction call</td>
<td>
<p><code>mtcars %&gt;% .$cyl</code></p>
<p><code>mtcars %&gt;% {.$cyl[[3]]}</code></p>
<p><code>mtcars %$% cyl[[3]]</code></p>
</td>
<td>
<p><code>mtcars |&gt; _$cyl</code></p>
<p><code>mtcars |&gt; _$cyl[[3]]</code></p>
</td>
<td></td>
</tr>
<tr class="even">
<td>Environment</td>
<td>
<code>%&gt;%</code> has additional function environment. Use:
<code>"x" %!&gt; assign(1)</code>
</td>
<td><code>"x" |&gt; assign(1)</code></td>
<td>4</td>
</tr>
<tr class="odd">
<td>Create Function</td>
<td><code>top6 &lt;- . %&gt;% sort() %&gt;% tail()</code></td>
<td>Not possible</td>
<td></td>
</tr>
<tr class="even">
<td>Speed</td>
<td>Slower because overhead of function call</td>
<td>Faster because syntax transformation</td>
<td>5</td>
</tr>
</tbody>
</table>
<ol style="list-style-type: decimal">
<li>Unless we explicitly import the <code>magrittr</code> package, we
typically only have access to the simple pipe, <code>%&gt;%</code> which
is included in many packages. This however is only one of several pipes
available from the <code>magrittr</code> package. See below.</li>
<li>Note that both pipes insert the input from the left-hand-side at the
first <em>unnamed</em> argument. Naming other arguments allow us to
handle functions that do not take data as the <em>first</em>
argument.</li>
<li>The placeholder allow us to reference the input in functions. One
important difference is that the base-R pipe need to be specified with a
named argument. Which is probably best practice anyway.</li>
<li>This is related to the way the pipes actually work, see also 5.</li>
<li>The magrittr pipe works by rewriting the right-hand-side in a
function, with its own environment - where the left-hand-side is
available with the symbol `.`</li>
</ol>
<section><h2 class="section-heading" id="the-other-pipes">The other pipes<a class="anchor" aria-label="anchor" href="#the-other-pipes"></a>
</h2>
<hr class="half-width">
<p>As indicated in the comparative table, the <code>magrittr</code> pipe
have a number of siblings.</p>
<div class="section level3">
<h3 id="the-tee-pipe-t">The tee-pipe %T&gt;%<a class="anchor" aria-label="anchor" href="#the-tee-pipe-t"></a>
</h3>
<p>This pipe allow us to inject a function into a longer set of pipes,
without affecting the rest of the flow.</p>
<figure><img src="../fig/tee-pipe.png" class="figure mx-auto d-block"></figure><p>The tee-pipe sends data to two functions. The immediate next, which
we want to run for plotting, logging or printing data, and to the next
function over, which get the original input data, rather than what is
returned by the intermediate function.</p>
<p>We are here using an intermediate function, not for what it does to
the data, but for its side effects.</p>
<div id="try-it-yourself" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="try-it-yourself" class="callout-inner">
<h3 class="callout-title">Try it yourself</h3>
<div class="callout-content">
<p>Use the tee-pipe to send the dataset <code>mtcars</code> to a view
function, and then filter to only show rows where <code>am</code> is
equal to 1.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>mtcars <span class="sc">%T&gt;%</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>  <span class="fu">view</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>  <span class="fu">filter</span>(am <span class="sc">==</span> <span class="sc">!</span>)</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="assignment-pipen">Assignment pipen<a class="anchor" aria-label="anchor" href="#assignment-pipen"></a>
</h2>
<hr class="half-width">
<p>After constructing a longer pipe in order to get at specific result,
we end up assigning the result to a new object. Sometimes the same
object:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_data</span> <span class="op">&lt;-</span> <span class="va">my_data</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">lending</span> <span class="op">&gt;</span> <span class="fl">10</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>area <span class="op">=</span> <span class="va">lenght</span> <span class="op">*</span> <span class="va">width</span><span class="op">)</span></span></code></pre>
</div>
<p>The assignment pipe can shorten this:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_data</span> <span class="op">%&lt;&gt;%</span> </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">lending</span> <span class="op">&gt;</span> <span class="fl">10</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>area <span class="op">=</span> <span class="va">lenght</span> <span class="op">*</span> <span class="va">width</span><span class="op">)</span></span></code></pre>
</div>
<p>It needs to be the first pipe in the flow, and will pass the data
from its left hand side to the flow on the right hand side. And assign
the result of the entire pipe back into the original left hand side.</p>
<p>This will shorten your code. But it is generally recommended not to
use it.</p>
<p>Reading R-code can be difficult enough as it is, and
<code>%&gt;%</code> is visually rather close to <code>%&lt;&gt;%</code>
which makes it easy to overlook.</p>
<div class="section level3">
<h3 id="the-eager-pipe">The eager pipe %!&gt;%<a class="anchor" aria-label="anchor" href="#the-eager-pipe"></a>
</h3>
<p>We definitely need an episode in this material that cover the concept
of <code>lazy evaluation</code>. But currently we are too lazy to write
it.</p>
<p>But. The usual pipe <code>%&gt;%</code> i “lazy”. An expression in a
set of pipes is only evaluated when R absolutely have to. This can do
weird things, especially if we run functions for their side effects,
e.g. when we use the tee-pipe to do logging of intermediate results.</p>
<p>Enter the eager pipe, <code>%!&gt;%</code>. This will force the
evaluation rather than postpone it to later.</p>
<p>Let us define three functions. The code is not that important, but
they take an input, prints a text indicating their name (ie function f
prints “function f”), and return the input unchanged. This printing is
the side effect.</p>
<p>Take a look below if you are curious:</p>
<div id="accordionSpoiler2" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler2" aria-expanded="false" aria-controls="collapseSpoiler2">
  <h3 class="accordion-header" id="headingSpoiler2">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div> Defining three functions </h3>
</button>
<div id="collapseSpoiler2" class="accordion-collapse collapse" aria-labelledby="headingSpoiler2" data-bs-parent="#accordionSpoiler2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">print</span><span class="op">(</span><span class="st">"function f"</span><span class="op">)</span></span>
<span>  <span class="va">x</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">print</span><span class="op">(</span><span class="st">"function g"</span><span class="op">)</span></span>
<span>  <span class="va">x</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">h</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">print</span><span class="op">(</span><span class="st">"function h"</span><span class="op">)</span></span>
<span>  <span class="fu">invisible</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<p><code>invisible()</code> returns x, but withou printing it.</p>
</div>
</div>
</div>
</div>
<p>We can now run these three functions in a pipe:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">magrittr</span><span class="op">)</span></span>
<span></span>
<span><span class="cn">NULL</span> <span class="op">%&gt;%</span> <span class="fu">f</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">g</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">h</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "function h"
[1] "function g"
[1] "function f"</code></pre>
</div>
<p>This is the lazy evaluation. The first print come from the last
function, and function g is only evaluated when it has to be. Because
function h needs it. The last function to be evaluated is function f -
the first we actually have in the pipes. Because it is only evaluated
when needed. That is, when function g needs it.</p>
<p>Eager evaluation, where the functions are not evaluated when needed,
but immediately, can be achieved using the eager pipe:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="cn">NULL</span> <span class="op">%!&gt;%</span> <span class="fu">f</span><span class="op">(</span><span class="op">)</span> <span class="op">%!&gt;%</span> <span class="fu">g</span><span class="op">(</span><span class="op">)</span> <span class="op">%!&gt;%</span> <span class="fu">h</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "function f"
[1] "function g"
[1] "function h"</code></pre>
</div>
<p>Now the first message printed is from function f. Becaus function f
is the first, and we are using the eager pipe rather than the lazy.</p>
<div id="r-use-lazy-evaluation-for-a-reason" class="callout caution">
<div class="callout-square">
<i class="callout-icon" data-feather="alert-triangle"></i>
</div>
<div id="r-use-lazy-evaluation-for-a-reason" class="callout-inner">
<h3 class="callout-title">R use lazy evaluation for a reason</h3>
<div class="callout-content">
<p>It might be tempting to use the eager pipe every time. After all, it
is bad to be lazy and the evaluation have to be done at one point,
right. But! R, and especially the tidyverse functions use lazy
evaluation because it improves performance. If something in the pipe is
not actually used, it is not evaluated. This saves time.</p>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="the-exposition-pipe">The exposition pipe<a class="anchor" aria-label="anchor" href="#the-exposition-pipe"></a>
</h3>
<p>The power of the pipes comes from the fact that we can use them to
forward data to a function that use a dataframe.</p>
<p>But not all functions have an argument that allow them to take a
dataframe as input. And because the pipe inserts whatever is on the
lefthand side of it, into the first empty argument in the function on
the right hand side, this can lead to problems.</p>
<div id="try-it-yourself-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="try-it-yourself-1" class="callout-inner">
<h3 class="callout-title">Try it yourself</h3>
<div class="callout-content">
<p>You will fail!</p>
<p>Use the <code>cor()</code> function in conjunction with the ordinary
pipe (%&gt;%), to find the correlation between the Sepal.Length and the
Sepal.Width in the iris dataset.</p>
</div>
</div>
</div>
<div id="accordionHint1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint1" aria-expanded="false" aria-controls="collapseHint1">
  <h4 class="accordion-header" id="headingHint1"> Give me a hint </h4>
</button>
<div id="collapseHint1" class="accordion-collapse collapse" aria-labelledby="headingHint1" data-bs-parent="#accordionHint1">
<div class="accordion-body">
<p>Something like this:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">iris</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">cor</span><span class="op">(</span>x <span class="op">=</span> <span class="va">.</span><span class="op">$</span><span class="va">Sepal.Length</span>, y <span class="op">=</span> <span class="va">.</span><span class="op">$</span><span class="va">Sepal.Width</span><span class="op">)</span></span></code></pre>
</div>
<p>Might be tempting. Try to add other named arguments to the function
(look at the help file) if you do not succeed at first.</p>
</div>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<p>This cannot be done.</p>
<p>In this attempt:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">iris</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">cor</span><span class="op">(</span>x <span class="op">=</span> <span class="va">.</span><span class="op">$</span><span class="va">Sepal.Length</span>, y <span class="op">=</span> <span class="va">.</span><span class="op">$</span><span class="va">Sepal.Width</span>,</span>
<span>      use <span class="op">=</span> <span class="st">"everything"</span><span class="op">)</span></span></code></pre>
</div>
<p>We add more and more named arguments to the function. In this code,
we will get an error, telling us that we are supplying a dataframe to
the argument “method”. Looking at the help, we can see that
<code>cor</code> besides the arguments we have already named in the
function call, take a final argument “method”. That is the first empty
argument in the function, and the pipe will place the dataframe
<code>iris</code> on that place, leading to an error. If we supply the
method argument inserting <code>method = "pearson"</code>, the pipe will
still add the dataframe to the function, resulting in an error telling
us that we are supplying an argument that is unused.</p>
</div>
</div>
</div>
</div>
<p>The exposition pipe, <code>%$%</code> exposes the variables in the
left hand side, and does not insert anything anywhere unless we specify
it:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">iris</span> <span class="op">%$%</span> </span>
<span>  <span class="fu">cor</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Sepal.Length</span>, y <span class="op">=</span> <span class="va">Sepal.Width</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] -0.1175698</code></pre>
</div>
</div>
<div class="section level3">
<h3 id="that-weird-note-about-function-calls">That weird note about function calls<a class="anchor" aria-label="anchor" href="#that-weird-note-about-function-calls"></a>
</h3>
<p>In the table comparing the native pipe (<code>|&gt;</code>) and the
magrittr pipe (<code>%&gt;%</code>) it was noted that the latter was
slower than the first, because of “overhead of function call”. Or
conversely that the first was faster because of “syntax transformation”.
What does that actually mean?</p>
<p>The magrittr pipe, as are other operators, is a function.
Conceptually this <code>a %&gt;% b()</code>, is the same as
<code>%&gt;%(a, b())</code></p>
<p>Or:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>mean <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>become this:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">`%&gt;%`</span><span class="op">(</span><span class="fu">`%&gt;%`</span><span class="op">(</span><span class="va">data</span>, <span class="fu">filter</span><span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span>, <span class="fu">summarize</span><span class="op">(</span>mean <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>We can count 5 functions, 2 of them the pipe function.</p>
<p>The native pipe on the other hand is not a function. The R-parser,
which interprets our code befor actually evaluating it, rewrites code
containg the native pipe. That means, that <code>a |&gt; b()</code>
becomes <code>b(a)</code></p>
<p>Or that:</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">summarize</span><span class="op">(</span>mean <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>become:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">summarize</span><span class="op">(</span><span class="fu">filter</span><span class="op">(</span><span class="va">data</span>, <span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span>, mean <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>We can count 3 functions in this expression. Intuitively this should
be faster. And it is.</p>
</div>
</section><section><h2 class="section-heading" id="what-if-i-want-the-other-pipe">What if I want the other pipe?<a class="anchor" aria-label="anchor" href="#what-if-i-want-the-other-pipe"></a>
</h2>
<hr class="half-width">
<p>The keyboard shortcut to get a pipe operator in RStudio is
ctrl+shift+m on windows and cmd+shift+m on macos.</p>
<p>This default can be changed:</p>
<p>Tools → Global Options → Code</p>
<p><img src="../fig/change_pipe.png" class="figure"> Place a tickmark in the box next to
“Use native pipe operator, |&gt;”.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>The base-R, native, pipe |&gt; is faster than the magrittr pipe,
%&gt;%</li>
<li>The magrittr package provides a selection of other useful pipes</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-gis_setup"><p>Content from <a href="gis_setup.html">Setup for GIS</a></p>
<hr>
<p>Last updated on 2025-04-15 |

        <a href="https://github.com/KUBDatalab/R-toolbox/edit/main/episodes/gis_setup.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 84 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do I get ready for working with geospatial data in R?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Get your R-environment prepared for working with geospatial
data</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>This workshop is designed to be run on your local machine. First, you
will need to download the data we use in the workshop. Then, you need to
set up your machine to analyse and process geospatial data. We provide
instructions below to install all components manually.</p>
<section><h2 class="section-heading" id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h2>
<hr class="half-width">
<p>For a full description of the data used in this workshop see the <a href="data.html">data page</a>.</p>
<p>Note that the page includes a lot of other datasets, not just
GIS-related.</p>
</section><section><h2 class="section-heading" id="local-installation">Local Installation<a class="anchor" aria-label="anchor" href="#local-installation"></a>
</h2>
<hr class="half-width">
<div class="section level3">
<h3 id="software">Software<a class="anchor" aria-label="anchor" href="#software"></a>
</h3>
<table class="table">
<colgroup>
<col width="18%">
<col width="18%">
<col width="18%">
<col width="18%">
<col width="26%">
</colgroup>
<thead><tr class="header">
<th>Software</th>
<th>Install</th>
<th>Manual</th>
<th>Available for</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><a href="https://www.r-project.org" class="external-link">R</a></td>
<td><a href="https://cloud.r-project.org" class="external-link">Link</a></td>
<td><a href="https://cloud.r-project.org" class="external-link">Link</a></td>
<td>Linux, MacOS</td>
<td>Software environment for statistical and scientific computing</td>
</tr>
<tr class="even">
<td><a href="https://www.rstudio.com" class="external-link">RStudio</a></td>
<td><a href="https://www.rstudio.com/products/rstudio/download/#download" class="external-link">Link</a></td>
<td></td>
<td>Linux, MacOS</td>
<td>GUI for R</td>
</tr>
</tbody>
</table>
<p>We provide quick instructions below for installing the various
software needed for this workshop. At points, they assume familiarity
with the command line and with installation in general. As there are
different operating systems and many different versions of operating
systems and environments, these may not work on your computer. If an
installation doesn’t work for you, please refer to the installation
instructions for that software listed in the table above.</p>
<div class="tabs">
<nav><div id="nav-tab-1" class="nav nav-tabs" role="tablist">
<button class="nav-link active" id="nav-tab-1-Windows" name="Windows" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-1-Windows" type="button" role="tab" aria-controls="nav-tabpanel-1-Windows" aria-selected="true">
  <h3 class="tab-header" id="nav-tab-heading-1-Windows">
  Windows
  </h3>
</button>
<button class="nav-link" id="nav-tab-1-macOS-one-click" name="macOS-one-click" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-1-macOS-one-click" type="button" role="tab" aria-controls="nav-tabpanel-1-macOS-one-click" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-1-macOS-one-click">
  macOS - one-click
  </h3>
</button>
<button class="nav-link" id="nav-tab-1-macOS-3commands" name="macOS-3commands" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-1-macOS-3commands" type="button" role="tab" aria-controls="nav-tabpanel-1-macOS-3commands" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-1-macOS-3commands">
  macOS - 3 commands
  </h3>
</button>
<button class="nav-link" id="nav-tab-1-Linux" name="Linux" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-1-Linux" type="button" role="tab" aria-controls="nav-tabpanel-1-Linux" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-1-Linux">
  Linux
  </h3>
</button>
</div>
</nav><div id="nav-tabContent-1" class="tab-content">
<div id="nav-tabpanel-1-Windows" class="tab-pane show active" aria-labelledby="nav-tab-1-Windows" role="tabpanel">
<p>To install the geospatial libraries, install the latest version <a href="https://cran.r-project.org/bin/windows/Rtools/" class="external-link">RTools</a></p>
</div>
<div id="nav-tabpanel-1-macOS-one-click" class="tab-pane" aria-labelledby="nav-tab-1-macOS-one-click" role="tabpanel">
<p>The simplest way to install these geospatial libraries is to install
the latest version of <a href="https://www.kyngchaos.com/software/frameworks" class="external-link">Kyng Chaos’s
pre-built package</a> for GDAL Complete. Be aware that several other
libraries are also installed, including the UnixImageIO, SQLite3, and
<code>NumPy</code>.</p>
<p>After downloading the package in the link above, you will need to
double-click the cardbord box icon to complete the installation.
Depending on your security settings, you may get an error message about
“unidentified developers”. You can enable the installation by following
<a href="https://kb.wisc.edu/page.php?id=25443" class="external-link">these instructions</a>
for installing programs from unidentified developers.</p>
</div>
<div id="nav-tabpanel-1-macOS-3commands" class="tab-pane" aria-labelledby="nav-tab-1-macOS-3commands" role="tabpanel">
<p>Alternatively, participants who are comfortable with the command line
can install the geospatial libraries individually using <a href="https://brew.sh" class="external-link">homebrew</a>:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">$</span> brew install proj</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="ex">$</span> brew install geos</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="ex">$</span> brew install gdal</span></code></pre>
</div>
</div>
<div id="nav-tabpanel-1-Linux" class="tab-pane" aria-labelledby="nav-tab-1-Linux" role="tabpanel">
<p>Steps for installing the geospatial libraries will vary based on
which form of Linux you are using. These instructions are adapted from
the <a href="https://github.com/r-spatial/sf" class="external-link"><code>sf</code> package’s
<code>README</code></a>.</p>
<p>For <strong>Ubuntu</strong>:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ex">$</span> sudo add-apt-repository ppa:ubuntugis</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="ex">$</span> sudo apt-get update</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="ex">$</span> sudo apt-get install libgdal-dev libgeos-dev libproj-dev</span></code></pre>
</div>
<p>For <strong>Fedora</strong>:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="ex">$</span> sudo dnf install gdal-devel proj-devel geos-devel</span></code></pre>
</div>
<p>For <strong>Arch</strong>:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="ex">$</span> pacman <span class="at">-S</span> gdal proj geos</span></code></pre>
</div>
<p>For <strong>Debian</strong>: The <a href="https://github.com/rocker-org/geospatial" class="external-link">rocker geospatial</a>
Dockerfiles may be helpful. Ubuntu Dockerfiles are found <a href="https://github.com/r-spatial/sf/tree/master/inst/docker" class="external-link">here</a>.
These may be helpful to get an idea of the commands needed to install
the necessary dependencies.</p>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="udunits">UDUNITS<a class="anchor" aria-label="anchor" href="#udunits"></a>
</h3>
<p>Linux users will have to install UDUNITS separately. Like the
geospatial libraries discussed above, this is a dependency for the
<code>R</code> package <code>sf</code>. Due to conflicts, it does not
install properly on Linux machines when installed as part of the
<code>sf</code> installation process. It is therefore necessary to
install it using the command line ahead of time.</p>
<div id="accordionSpoiler1" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler1" aria-expanded="false" aria-controls="collapseSpoiler1">
  <h3 class="accordion-header" id="headingSpoiler1">
  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div>
  Linux
  </h3>
</button>
<div id="collapseSpoiler1" class="accordion-collapse collapse" aria-labelledby="headingSpoiler1" data-bs-parent="#accordionSpoiler1">
<div class="accordion-body">
<p>Steps for installing the geospatial will vary based on which form of
Linux you are using. These instructions are adapted from the <a href="https://github.com/r-spatial/sf" class="external-link"><code>sf</code> package’s
<code>README</code></a>.</p>
<p>For <strong>Ubuntu</strong>:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="ex">$</span> sudo apt-get install libudunits2-dev</span></code></pre>
</div>
<p>For <strong>Fedora</strong>:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="ex">$</span> sudo dnf install udunits2-devel</span></code></pre>
</div>
<p>For <strong>Arch</strong>:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="ex">$</span> pacaur/yaourt/whatever <span class="at">-S</span> udunits</span></code></pre>
</div>
<p>For <strong>Debian</strong>:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="ex">$</span> sudo apt-get install <span class="at">-y</span> libudunits2-dev</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="r-packages">R Packages<a class="anchor" aria-label="anchor" href="#r-packages"></a>
</h3>
<p>The following <code>R</code> packages are used in the various
geospatial lessons. If you have taken other of our cources, you probably
have a number of them installed already.</p>
<ul>
<li><a href="https://cran.r-project.org/package=dplyr" class="external-link"><code>dplyr</code></a></li>
<li><a href="https://cran.r-project.org/package=ggplot2" class="external-link"><code>ggplot2</code></a></li>
<li><a href="https://cran.r-project.org/package=raster" class="external-link"><code>raster</code></a></li>
<li><a href="https://cran.r-project.org/package=rasterVis" class="external-link"><code>rasterVis</code></a></li>
<li><a href="https://CRAN.R-project.org/package=RColorBrewer" class="external-link"><code>RColorBrewer</code></a></li>
<li><a href="https://cran.r-project.org/package=remotes" class="external-link"><code>remotes</code></a></li>
<li><a href="https://CRAN.R-project.org/package=reshape" class="external-link"><code>reshape</code></a></li>
<li><a href="https://cran.r-project.org/package=scales" class="external-link"><code>scales</code></a></li>
<li><a href="https://cran.r-project.org/package=sf" class="external-link"><code>sf</code></a></li>
<li><a href="https://cran.r-project.org/package=terra" class="external-link"><code>terra</code></a></li>
<li><a href="https://CRAN.R-project.org/package=tidyr" class="external-link"><code>tidyr</code></a></li>
<li><a href="https://CRAN.R-project.org/package=maps" class="external-link"><code>maps</code></a></li>
</ul>
<p>To install these packages in RStudio, copy the following into the
console and hit enter.</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">install.packages</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span><span class="st">"dplyr"</span>, <span class="st">"ggplot2"</span>, <span class="st">"raster"</span>, <span class="st">"rasterVis"</span>, <span class="st">"RColorBrewer"</span>, <span class="st">"remotes"</span>, <span class="st">"reshape"</span>, <span class="st">"scales"</span>, <span class="st">"sf"</span>, , <span class="st">"tidyr"</span>, <span class="st">"maps"</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>You should see a status message starting with: terra skal nok også
være der et sted. men det fejler i git-actions.</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>trying URL 'https://cran.rstudio.com/bin/macosx/el-capitan/contrib/3.5/dplyr_0.7.6.tgz'
Content type 'application/x-gzip' length 5686536 bytes (5.4 MB)
==================================================
downloaded 5.4 MB

trying URL 'https://cran.rstudio.com/bin/macosx/el-capitan/contrib/3.5/ggplot2_3.0.0.tgz'
Content type 'application/x-gzip' length 3577658 bytes (3.4 MB)
==================================================
downloaded 3.4 MB</code></pre>
</div>
<p>When the installation is complete, you will see a status message
like:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>The downloaded binary packages are in
/var/folders/7g/r8_n81y534z0vy5hxc6dx1t00000gn/T//RtmpJECKXM/downloaded_packages</code></pre>
</div>
<p>You are now ready for the workshop!</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Working with geospatial data requires additional software</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div>
</section></section><section id="aio-fence-test"><p>Content from <a href="fence-test.html">Fences på vores undervisningssider</a></p>
<hr>
<p>Last updated on 2025-04-15 |

        <a href="https://github.com/KUBDatalab/R-toolbox/edit/main/episodes/fence-test.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 12 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>Hvilke fences har vi til rådighed i det her setup?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Lever en oversigt over fences vi kan bruge i
undervisningsmaterialet.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>Fences. Det vi bruger til at indsætte de små (eller ikke så små)
farvede blokke på siderne. De starter alle med mindst fire “:” og
derefter ordet; eksempelvis “callout”. Og når man er færdig med
indholdet, skal der være mindst fire “:” igen.</p>
<p>Hvad er ordet så? Ordet er altid det der står på position X i: “dette
er en X fence”.</p>
<div id="dette-er-en-callout-fence" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="dette-er-en-callout-fence" class="callout-inner">
<h3 class="callout-title">dette er en callout fence</h3>
<div class="callout-content">

</div>
</div>
</div>
<div id="dette-er-en-prereq-fence" class="callout prereq">
<div class="callout-square">
<i class="callout-icon" data-feather="check"></i>
</div>
<div id="dette-er-en-prereq-fence" class="callout-inner">
<h3 class="callout-title">dette er en prereq fence</h3>
<div class="callout-content">

</div>
</div>
</div>
<div id="dette-er-en-checklist-fence" class="callout checklist">
<div class="callout-square">
<i class="callout-icon" data-feather="check-square"></i>
</div>
<div id="dette-er-en-checklist-fence" class="callout-inner">
<h3 class="callout-title">dette er en checklist fence</h3>
<div class="callout-content">

</div>
</div>
</div>
<p>Bemærk at hint-fencen mangler en ikon til venstre.</p>
<div id="accordionHint1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint1" aria-expanded="false" aria-controls="collapseHint1">
  <h4 class="accordion-header" id="headingHint1">
  dette er en hint fence
  </h4>
</button>
<div id="collapseHint1" class="accordion-collapse collapse" aria-labelledby="headingHint1" data-bs-parent="#accordionHint1">
<div class="accordion-body">

</div>
</div>
</div>
</div>
<div id="dette-er-en-discussion-fence" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="dette-er-en-discussion-fence" class="callout-inner">
<h3 class="callout-title">dette er en discussion fence</h3>
<div class="callout-content">

</div>
</div>
</div>
<div id="dette-er-en-testimonial-fence" class="callout testimonial">
<div class="callout-square">
<i class="callout-icon" data-feather="heart"></i>
</div>
<div id="dette-er-en-testimonial-fence" class="callout-inner">
<h3 class="callout-title">dette er en testimonial fence</h3>
<div class="callout-content">

</div>
</div>
</div>
<div id="accordionInstructor1" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor1" aria-expanded="false" aria-controls="collapseInstructor1">
  <h3 class="accordion-header" id="headingInstructor1">
  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div>
  dette er en instructor fence
  </h3>
</button>
<div id="collapseInstructor1" class="accordion-collapse collapse" aria-labelledby="headingInstructor1" data-bs-parent="#accordionInstructor1">
<div class="accordion-body">

</div>
</div>
</div>
</div>
<div id="dette-er-en-caution-fence" class="callout caution">
<div class="callout-square">
<i class="callout-icon" data-feather="alert-triangle"></i>
</div>
<div id="dette-er-en-caution-fence" class="callout-inner">
<h3 class="callout-title">Dette er en caution fence</h3>
<div class="callout-content">
<p>Bemærk at sandpaper vil insistere på ikke at kende til denne fence.
Men den fungerer altså fint alligevel, så det er fejl under bygningen af
siden man roligt kan ignorere.</p>
</div>
</div>
</div>
<div id="accordionSpoiler1" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler1" aria-expanded="false" aria-controls="collapseSpoiler1">
  <h3 class="accordion-header" id="headingSpoiler1">
  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div>
  dette er en spoiler fence
  </h3>
</button>
<div id="collapseSpoiler1" class="accordion-collapse collapse" aria-labelledby="headingSpoiler1" data-bs-parent="#accordionSpoiler1">
<div class="accordion-body">

</div>
</div>
</div>
</div>
<div id="dette-er-en-challenge-fence" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="dette-er-en-challenge-fence" class="callout-inner">
<h3 class="callout-title">dette er en challenge fence</h3>
<div class="callout-content">

</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  Den optræder som regel med en solution fence
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>Og den er “inde i” challenge fencen.</p>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="fanegruppe-eksempel">Fanegruppe Eksempel<a class="anchor" aria-label="anchor" href="#fanegruppe-eksempel"></a>
</h2>
<hr class="half-width">
<p>Vi starter med en group-tab fence, og så har vi nogen overskrifter
til de forskellige tabs, og deres indhold. Vær opmærksom på at når man
skifter til eksempelvis “Mac” i en group-tab, så skifter de andre
group-tabs også til “Mac”.</p>
<div class="tabs">
<nav><div id="nav-tab-1" class="nav nav-tabs" role="tablist">
<button class="nav-link active" id="nav-tab-1-Windows" name="Windows" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-1-Windows" type="button" role="tab" aria-controls="nav-tabpanel-1-Windows" aria-selected="true">
  <h3 class="tab-header" id="nav-tab-heading-1-Windows">
  Windows
  </h3>
</button>
<button class="nav-link" id="nav-tab-1-Mac" name="Mac" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-1-Mac" type="button" role="tab" aria-controls="nav-tabpanel-1-Mac" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-1-Mac">
  Mac
  </h3>
</button>
<button class="nav-link" id="nav-tab-1-Linux" name="Linux" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-1-Linux" type="button" role="tab" aria-controls="nav-tabpanel-1-Linux" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-1-Linux">
  Linux
  </h3>
</button>
</div>
</nav><div id="nav-tabContent-1" class="tab-content">
<div id="nav-tabpanel-1-Windows" class="tab-pane show active" aria-labelledby="nav-tab-1-Windows" role="tabpanel">
<p>1</p>
</div>
<div id="nav-tabpanel-1-Mac" class="tab-pane" aria-labelledby="nav-tab-1-Mac" role="tabpanel">
<p>2</p>
</div>
<div id="nav-tabpanel-1-Linux" class="tab-pane" aria-labelledby="nav-tab-1-Linux" role="tabpanel">
<p>3</p>
</div>
</div>
</div>
<div class="tabs">
<nav><div id="nav-tab-2" class="nav nav-tabs" role="tablist">
<button class="nav-link active" id="nav-tab-2-Windows" name="Windows" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-2-Windows" type="button" role="tab" aria-controls="nav-tabpanel-2-Windows" aria-selected="true">
  <h3 class="tab-header" id="nav-tab-heading-2-Windows">
  Windows
  </h3>
</button>
<button class="nav-link" id="nav-tab-2-Mac" name="Mac" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-2-Mac" type="button" role="tab" aria-controls="nav-tabpanel-2-Mac" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-2-Mac">
  Mac
  </h3>
</button>
<button class="nav-link" id="nav-tab-2-Linux" name="Linux" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-2-Linux" type="button" role="tab" aria-controls="nav-tabpanel-2-Linux" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-2-Linux">
  Linux
  </h3>
</button>
<button class="nav-link" id="nav-tab-2-raspbian" name="raspbian" data-bs-toggle="tab" data-bs-target="#nav-tabpanel-2-raspbian" type="button" role="tab" aria-controls="nav-tabpanel-2-raspbian" aria-selected="false">
  <h3 class="tab-header" id="nav-tab-heading-2-raspbian">
  raspbian
  </h3>
</button>
</div>
</nav><div id="nav-tabContent-2" class="tab-content">
<div id="nav-tabpanel-2-Windows" class="tab-pane show active" aria-labelledby="nav-tab-2-Windows" role="tabpanel">
<p>4</p>
</div>
<div id="nav-tabpanel-2-Mac" class="tab-pane" aria-labelledby="nav-tab-2-Mac" role="tabpanel">
<p>5</p>
</div>
<div id="nav-tabpanel-2-Linux" class="tab-pane" aria-labelledby="nav-tab-2-Linux" role="tabpanel">
<p>6</p>
</div>
<div id="nav-tabpanel-2-Windows" class="tab-pane" aria-labelledby="nav-tab-2-Windows" role="tabpanel">
<p>7</p>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Brug fences til at fremhæve eller skjule indhold på siderne.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-making-a-new-course"><p>Content from <a href="making-a-new-course.html">Make a new course</a></p>
<hr>
<p>Last updated on 2025-04-15 |

        <a href="https://github.com/KUBDatalab/R-toolbox/edit/main/episodes/making-a-new-course.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 12 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do I make a new course-page based on this??</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Explain how to make a new lesson based on this template</li>
<li>Provide a checklist for doing so</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>This page is defined as a template-repo at GitHub. That means, that
you can easily initialize a new repository based on this page.</p>
<div id="accordionSpoiler1" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler1" aria-expanded="false" aria-controls="collapseSpoiler1">
  <h3 class="accordion-header" id="headingSpoiler1">
  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div>
  How do you make a template-repo?
  </h3>
</button>
<div id="collapseSpoiler1" class="accordion-collapse collapse" data-bs-parent="#accordionSpoiler1" aria-labelledby="headingSpoiler1">
<div class="accordion-body">
<p>Go to the main page of the repo you want to make a template.</p>
<p>Click “settings”, and, just under the box where you can change the
repository name, you will find a tick-box called “Template repository”.
Tick it.</p>
</div>
</div>
</div>
</div>
<p>Go to the <a href="https://github.com/KUBDatalab/R-toolbox" class="external-link">github-repo</a>, and
click on the green button “Use this template”. Choose “Create a new
repository”.</p>
<p>Giv the new repository a name. We prefer to let our R-courses begin
with “R-”.</p>
<p>Make sure the repository is placed under “KUBDatalab”, if you want it
to be part of our eco-system. Otherwise, place it wherever you want.</p>
<p>Also make sure that the repository is “Public”.</p>
<p>After GitHub have initialized the new repository based on this
template, you need to edit the “config.yaml” file.</p>
<ul>
<li>title - selfexplanatory</li>
<li>created - the date you did all this.</li>
<li>source - change it to the url of the new github-repo. This makes it
easier to edit the page in the future.</li>
<li>episodes - remove all episodes not to be included in your new
course. Change the order if necessary.</li>
</ul>
<p>Either do this directly on GitHub, or follow the usual process of
forking to your own GitHub account, and cloning the repo to your
computer.</p>
<p>You will also need to update the CITATION.cff file, otherwise the
citation will point to this site, rather than your own.</p>
<p>You can use <a href="https://citation-file-format.github.io/cff-initializer-javascript/#/" class="external-link uri">https://citation-file-format.github.io/cff-initializer-javascript/#/</a>
to edit the existing, or make a new one.</p>
<div id="consider-deleting-stuff" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="consider-deleting-stuff" class="callout-inner">
<h3 class="callout-title">Consider deleting stuff</h3>
<div class="callout-content">
<p>When the page is generated, the scripts identifies all libraries used
in all episodes. Even if these episodes will not be shown on the
page.</p>
<p>This requires the scripts to download and install all these
libraries. And that takes time!</p>
<p>If you delete all unused episodes, you will speed up the following
step considerably.</p>
</div>
</div>
</div>
<p>After you have committed your changes to config.yaml, actions begins
building the site. Have patience! The first build of the R-PUFF site
took 54 minutes.</p>
<p>Don’t worry, future changes are a lot faster. An update of the page
you are currently reading, took 6 minutes. The scripts only rebuild the
pages that are changed.</p>
<p>You can follow the process under “Actions” on the repo.</p>
<p>When all actions have run - look for the green checkmarks, go to
“Settings”, choose “Pages”.</p>
<div id="renv-messes-things-up" class="callout caution">
<div class="callout-square">
<i class="callout-icon" data-feather="alert-triangle"></i>
</div>
<div id="renv-messes-things-up" class="callout-inner">
<h3 class="callout-title">renv messes things up!</h3>
<div class="callout-content">
<p>Sandpaper uses the renv environment manager to handle dependencies in
the packages you use. But that handling appears to be different on a
windows machine and on the virtual Linux machine that GitHub actions
uses.</p>
<p>So: DO NOT COMMIT AND PUSH ANY renv TO GITHUB. IT WILL BREAK THE
GENERATION OF THE PAGES.</p>
<p>If you do - delete the renv directory.</p>
</div>
</div>
</div>
<p>Under “Build and deployment”, we are told that the page is “deployed
from a branch”, and below that, you can choose which branch. Chose
“gh-pages”.</p>
<p>Click “Save”. GitHub actions begins again, but do not worry, this
step is very fast (depending on a lot of things, we are not paying
GitHub, so we depend on shared ressources).</p>
<div id="changes-are-local" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="changes-are-local" class="callout-inner">
<h3 class="callout-title">Changes are local</h3>
<div class="callout-content">
<p>You have made a new repo based on the master-version of the toolbox.
Any changes made to R-toolbox, will <em>not</em> affect your new
page.</p>
<p>Changes made on your new page are similarly not affecting
R-toolbox.</p>
</div>
</div>
</div>
<section><h2 class="section-heading" id="editing">Editing<a class="anchor" aria-label="anchor" href="#editing"></a>
</h2>
<hr class="half-width">
<p>There are a lot of useful information on <a href="https://carpentries.github.io/sandpaper-docs" class="external-link uri">https://carpentries.github.io/sandpaper-docs</a></p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>It is fairly easy to make a new course page</li>
<li>Have patience!</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-shinylive"><p>Content from <a href="shinylive.html">Shiny without the server</a></p>
<hr>
<p>Last updated on 2025-04-15 |

        <a href="https://github.com/KUBDatalab/R-toolbox/edit/main/episodes/shinylive.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 12 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I distribute my Shiny app without a shinyserver?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Explain how to use ShinyLive to distribute a shiny app</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>We have written a shiny app. And we can run it on our own computer
using RStudio. But now we want to send it to someone else, that might
not have R and RStudio installed.</p>
<p>That someone else might also want to - or have the technical skills
to do that.</p>
<p>One way would be to aquire a server in the cloud, install R and a
Shiny server on it, add a webserver pointing to the correct place and
then place the app on it.</p>
<p>That is not simple, but step by step guides for that exists.</p>
<p>A simpler way exists. But we still need a webserver. We can get that
on github. So what to do?</p>
<p>We are going to assume that you have an app already. What we want is
to be able to run that in a browser. Shiny draws on a lot of R, access
to packages and an installation of R.</p>
<p>The library <code>shinylive</code> handles exporting everything your
app need to a separate folder, html-files and other assets, making it
possible to run the app on a simple webserver.</p>
<section><h2 class="section-heading" id="export-your-app">Export your app<a class="anchor" aria-label="anchor" href="#export-your-app"></a>
</h2>
<hr class="half-width">
<p>We need the library <code>shinylive</code></p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">shinylive</span><span class="op">)</span></span></code></pre>
</div>
<p>illustration af projektmappen</p>
<p>We can now export the app:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">shinylive</span><span class="fu">::</span><span class="fu">export</span><span class="op">(</span>appdir <span class="op">=</span> <span class="st">"myapp"</span>, destdir <span class="op">=</span> <span class="st">"site"</span><span class="op">)</span></span></code></pre>
</div>
<p>Change “myapp” to match the directory containing your app. The
destination directory “site” can be changed to whatever you like, but
the standard is to choose either “site” or “docs”.</p>
<p>That takes a little while.</p>
</section><section><h2 class="section-heading" id="test-your-app">Test your app<a class="anchor" aria-label="anchor" href="#test-your-app"></a>
</h2>
<hr class="half-width">
<p>We need a webserver to run the app - just a simple webserver, nothing
fancy, and we can do that using the library <code>httpuv</code>:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">httpuv</span><span class="op">)</span></span></code></pre>
</div>
<p>We need to specify where the exported app is located</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">httpuv</span><span class="fu">::</span><span class="fu">runStaticServer</span><span class="op">(</span><span class="st">"site/"</span><span class="op">)</span></span></code></pre>
</div>
<p>So change “site” to your destination directory from the export.</p>
<p>Now you should see your app in a browser. Make sure that it is
actually working.</p>
<div id="there-are-limitations" class="callout caution">
<div class="callout-square">
<i class="callout-icon" data-feather="alert-triangle"></i>
</div>
<div id="there-are-limitations" class="callout-inner">
<h3 class="callout-title">There are limitations</h3>
<div class="callout-content">
<p><code>shinylive</code> is a relatively new package, and is dependent
on other packages, primarily <code>webr</code> that allow us to run R in
a browser.</p>
<p><code>webr</code> is not able to install packages from source. And
some packages it does not support.</p>
</div>
</div>
</div>
<div id="accordionSpoiler1" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler1" aria-expanded="false" aria-controls="collapseSpoiler1">
  <h3 class="accordion-header" id="headingSpoiler1">
  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div>
  Additional troubleshooting
  </h3>
</button>
<div id="collapseSpoiler1" class="accordion-collapse collapse" aria-labelledby="headingSpoiler1" data-bs-parent="#accordionSpoiler1">
<div class="accordion-body">
<p>When <code>shinylive</code> exports your app, it automatically scans
your code to discover which packages should be included in the
export.</p>
<p>If, for some reason this fails, you can place an explicit call to
library in your code:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">library</span><span class="op">(</span><span class="va">UNDISCOVERED_PACKAGE</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="now-we-need-to-get-it-on-github">Now we need to get it on GitHub<a class="anchor" aria-label="anchor" href="#now-we-need-to-get-it-on-github"></a>
</h2>
<hr class="half-width">
<p>kan vi også få det på codeberg?</p>
<p>få den på github</p>
<p>Flere apps på samme repo</p>
<p><a href="https://posit-dev.github.io/r-shinylive/" class="external-link uri">https://posit-dev.github.io/r-shinylive/</a></p>
<p>Denne beskriver i detaljer hvordan <a href="https://hbctraining.github.io/Training-modules/RShiny/lessons/shinylive.html" class="external-link uri">https://hbctraining.github.io/Training-modules/RShiny/lessons/shinylive.html</a></p>
</section><section><h2 class="section-heading" id="more-than-one-app">More than one app<a class="anchor" aria-label="anchor" href="#more-than-one-app"></a>
</h2>
<hr class="half-width">
<p>The assets needed for running this takes up space.</p>
<p>How do we serve more than one app</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">shinylive</span><span class="fu">::</span><span class="fu">export</span><span class="op">(</span><span class="st">"myapp1"</span>, <span class="st">"site"</span>, subdir <span class="op">=</span> <span class="st">"app1"</span><span class="op">)</span></span>
<span><span class="fu">shinylive</span><span class="fu">::</span><span class="fu">export</span><span class="op">(</span><span class="st">"myapp2"</span>, <span class="st">"site"</span>, subdir <span class="op">=</span> <span class="st">"app2"</span><span class="op">)</span></span></code></pre>
</div>
<p>shinylive::export(“myapp1”, “site”, subdir = “app1”)
shinylive::export(“myapp2”, “site”, subdir = “app2”)</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Use <code>.md</code> files for episodes when you want static
content</li>
<li>Use <code>.Rmd</code> files for episodes when you need to generate
output</li>
<li>Run <code>sandpaper::check_lesson()</code> to identify any issues
with your lesson</li>
<li>Run <code>sandpaper::build_lesson()</code> to preview your lesson
locally</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-choropleths"><p>Content from <a href="choropleths.html">Choropleths</a></p>
<hr>
<p>Last updated on 2025-04-15 |

        <a href="https://github.com/KUBDatalab/R-toolbox/edit/main/episodes/choropleths.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 12 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can we visualise data on a map?</li>
<li>What is a choropleth?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Explain how to use ggplot to color areas on a map by a numerical
value</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="what-is-a-choropleth">What is a choropleth<a class="anchor" aria-label="anchor" href="#what-is-a-choropleth"></a>
</h2>
<hr class="half-width">
<p>Choropleths are maps displaying statistical information encoded as
colour. They allow us to display non-geograpphic variables on a
geographic map. This makes it easier to compare data and identify
patterns between different geographical units.</p>
<figure><img src="../fig/statistique-comparee-de-letat-de-linstruction-et-du-nombre-des-crimes-8a282e-1024.jpg" alt="Français : Adriano Balbi et André-Michel Guerry (1829). Statistique comparée de l’état de l’instruction et du nombre des crimes dans les divers arrondissements des académies et des cours royales de France Jules Renouard, Paris. BL:Tab.597.b.(38); BNF: Ge C 9014 ." class="figure mx-auto d-block"><div class="figcaption">Français : Adriano Balbi et André-Michel Guerry
(1829). Statistique comparée de l’état de l’instruction et du nombre des
crimes dans les divers arrondissements des académies et des cours
royales de France Jules Renouard, Paris. BL:Tab.597.b.(38); BNF: Ge C
9014 .</div>
</figure><p>Vi skal bruge to ting for at lave sådan en. Et geospatialt objekt,
der har data på grænserne på et kort. Det kan være lande grænser,
bygrænser, kvarterer, regioner whatever. Grænser er her skillelinien
mellem to geografiske områder, fordi vi skal farvelægge forskellige
områder efter et eller andet.</p>
<p>Vi skal også bruge en variabel, numerisk eller kategorisk. Den skal
vi bruge til at farvelægge områderne i det geografiske objekt. Og vi
skal have den knyttet til en variabel i det geospatiale objekt, der gør
at vi kan hægte dem sammen. Det kan også være de er hægtet sammen
allerede.</p>
<p>Find og download en geojson fil.</p>
<p>Pakken <code>maps</code> indeholder en del. Og vi ekstraherer data
fra den med ggplot2::map_data(), der kan trække data ud af maps pakken i
et ggplot venligt format.</p>
<p>Vi skal bruge hele verden</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.1     ✔ tibble    3.2.1
✔ lubridate 1.9.4     ✔ tidyr     1.3.1
✔ purrr     1.0.4
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">maps</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
Attaching package: 'maps'

The following object is masked from 'package:purrr':

    map</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">world</span> <span class="op">&lt;-</span> <span class="fu">map_data</span><span class="op">(</span><span class="st">"world"</span><span class="op">)</span></span></code></pre>
</div>
<p>Hvordan ser det ud?</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">world</span> <span class="op">%&gt;%</span> <span class="fu">filter</span><span class="op">(</span><span class="va">region</span> <span class="op">==</span> <span class="st">"Denmark"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">head</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>      long      lat group order  region subregion
1 11.36143 54.89165   473 35199 Denmark   Lolland
2 11.53838 54.82959   473 35200 Denmark   Lolland
3 11.65810 54.83316   473 35201 Denmark   Lolland
4 11.73955 54.80742   473 35202 Denmark   Lolland
5 11.75898 54.76768   473 35203 Denmark   Lolland
6 11.76592 54.67944   473 35204 Denmark   Lolland</code></pre>
</div>
<p>Whee! Vi har koordinater på Lolland. group variable fortæller hvilke
koordinater der skal forbindes, og order rækkefølgen. Så
11.36143,54.89165 skal forbindes med 11.53838,54.82959.</p>
<p>Det kan vi plotte.</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">world</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_polygon</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/choropleths-rendered-unnamed-chunk-3-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>lad os generere noget regionsdata.</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_til_plot</span> <span class="op">&lt;-</span> <span class="va">world</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">region</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">distinct</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">rowwise</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>value <span class="op">=</span> <span class="fu">rnorm</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<p>En række pr region, med navn og en helt tilfældig værdi.</p>
<p>Det kan vi joine:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">world</span> <span class="op">%&gt;%</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">data_til_plot</span>, by <span class="op">=</span> <span class="fu">join_by</span><span class="op">(</span><span class="va">region</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span>, fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_polygon</span><span class="op">(</span><span class="op">)</span> </span></code></pre>
</div>
<figure><img src="../fig/choropleths-rendered-unnamed-chunk-5-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Neat. I stedet for helt tilfældige data, ville det være praktisk med
“rigtige” data.</p>
<p>Vi indlæser noget data for ligestilling mellem kønnene.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ligestilling</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"data/BIGI.csv"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Rows: 134 Columns: 9
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (1): country
dbl (8): rank, overall_rank, BIGI, AADP, basic_education, healthy_life_span,...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="va">ligestilling</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 6 × 9
   rank overall_rank country      BIGI    AADP basic_education healthy_life_span
  &lt;dbl&gt;        &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt;   &lt;dbl&gt;           &lt;dbl&gt;             &lt;dbl&gt;
1     1           12 Bahrain  -0.00794 0.00794        -0.0126             0
2     2           24 Great B… -0.0146  0.0157         -0.0121            -0.0332
3     3           27 Netherl… -0.0158  0.0158         -0.0111            -0.0275
4     4           35 Iceland  -0.0177  0.0168         -0.0110            -0.0244
5     5           32 New Zea… -0.0171  0.0171         -0.0103            -0.0272
6     6           30 Serbia   -0.0167  0.0185         -0.00487           -0.0479
# ℹ 2 more variables: life_satisfaction &lt;dbl&gt;, human_development_index &lt;dbl&gt;</code></pre>
</div>
<p>Det joiner vi på samme måde som før, og farvelægger efter
bigi-scoren. Negative værdier indikerer at drenge og mænd er ringere
stillet. Positive at piger og kvinder er ringere stillet. Begge relativt
til 0-punktet der repræsenterer den fuldstændige lige stilling.</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">world</span> <span class="op">%&gt;%</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">ligestilling</span>, by <span class="op">=</span> <span class="fu">join_by</span><span class="op">(</span><span class="st">"region"</span><span class="op">==</span><span class="st">"country"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span>, fill <span class="op">=</span> <span class="va">BIGI</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_polygon</span><span class="op">(</span><span class="op">)</span> </span></code></pre>
</div>
<p><img src="../fig/choropleths-rendered-unnamed-chunk-7-1.png" style="display: block; margin: auto;" class="figure">
Og her har vi første problem. Det er måske ikke så overraskende at der
ikke er data for antarktis. Men for USA? Og UK?</p>
<p>Det handler om forskellige navneformer.</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">world</span> <span class="op">%&gt;%</span> <span class="fu">filter</span><span class="op">(</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">region</span>, <span class="st">"US"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">distinct</span><span class="op">(</span><span class="va">region</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  region
1    USA</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ligestilling</span> <span class="op">%&gt;%</span> <span class="fu">filter</span><span class="op">(</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">country</span>, <span class="st">"United"</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 3 × 9
   rank overall_rank country       BIGI   AADP basic_education healthy_life_span
  &lt;dbl&gt;        &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt;  &lt;dbl&gt;           &lt;dbl&gt;             &lt;dbl&gt;
1    14           45 United Ar… -0.0224 0.0224         -0.0359            0
2    34           61 United St… -0.0329 0.0329         -0.0201           -0.0476
3    98           92 Tanzania …  0.0520 0.0716          0.155            -0.0294
# ℹ 2 more variables: life_satisfaction &lt;dbl&gt;, human_development_index &lt;dbl&gt;</code></pre>
</div>
<p>USA hedder USA i kortdata. Og “United States of America” i
ligestillingsdata.</p>
<p>Det kan naturligvis ikke hægtes sammen…</p>
<p>Så vi er nødt til at normalisere navneformerne. Det vil vi komme til
at støde på ofte…</p>
<p>Heldigvis er der en pakke der kan hjælpe:</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">countrycode</span><span class="op">)</span></span></code></pre>
</div>
<p>contryname() vil tage noget input, og, efter bedste evne, konvertere
det til et fælles format. Der er <em>mange</em> formater. kør ?codelist
for at få en ide.</p>
<p>Vi konverterer alle navne til engelsk. Og det skal vi huske at gøre
for begge dataframes.</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ligestilling</span> <span class="op">&lt;-</span> <span class="va">ligestilling</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>common_name <span class="op">=</span> <span class="fu">countryname</span><span class="op">(</span><span class="va">country</span>, destination <span class="op">=</span> <span class="st">"cldr.name.en"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">world</span> <span class="op">&lt;-</span> <span class="va">world</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>common_name <span class="op">=</span> <span class="fu">countryname</span><span class="op">(</span><span class="va">region</span>, destination <span class="op">=</span> <span class="st">"cldr.name.en"</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">WARNING<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="warning" tabindex="0"><code>Warning: There was 1 warning in `mutate()`.
ℹ In argument: `common_name = countryname(region, destination =
  "cldr.name.en")`.
Caused by warning:
! Some values were not matched unambiguously: Ascension Island, Azores, Barbuda, Canary Islands, Chagos Archipelago, Grenadines, Heard Island, Madeira Islands, Micronesia, Saba, Saint Martin, Siachen Glacier, Sint Eustatius, Virgin Islands</code></pre>
</div>
<p>Det er ikke helt perfekt. Regionen “Azores” matcher eksempelvis ikke
at navn. De tilhører Portugal, men det fremgår ikke af vores world
datasæt.</p>
<p>Vi er nok tæt nok på til at vi giver det et skud.</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">world</span> <span class="op">%&gt;%</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">ligestilling</span>, by <span class="op">=</span> <span class="fu">join_by</span><span class="op">(</span><span class="va">common_name</span><span class="op">==</span><span class="va">common_name</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span>, fill <span class="op">=</span> <span class="va">BIGI</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_polygon</span><span class="op">(</span><span class="op">)</span> </span></code></pre>
</div>
<figure><img src="../fig/choropleths-rendered-unnamed-chunk-12-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>der er stadig lande der ikke er med. Men nu skyldes det at der
eksempelvis ikke er ligestillingsdata for Libyen, og ikke at vi ikke får
matchet data.</p>
<p>Mine øjne kan ikke rigtig skelne farverne. Så dem kan vi jo nok med
fordel gøre noget ved. Her skal vi tage et kig på hvad det faktisk er vi
illustrerer.</p>
<p>Vi har en udfordring i at værdierne af indikatoren kan være positive
og negative. Men det er en numerisk angivelse, ikke en normativ
angivelse. Så det skal vi have oversat.</p>
<p>Positive BIGI-scores angiver at piger og kvinder er disadvantaged. Og
det er negativt. Negative BIGI-socres angiver at drenge og mænd er
disadvantaged. Og det er positivt. Og så er der det neutrale nulpunkt.
Så vi har brug for en farveskala der har tre farver, en normativt
positiv, der matcher de negative BIGI-scores, en normativt negativ, der
matcher de positive BIGI-scores. Og en neutral farve i midten.</p>
<p>Negative ting får i almindelighed en advarselsfarve - rød, og ting
der er ønskelige en anden, ofte grøn.</p>
<p>Vi går til colorbrewer, og beder om tre farver der er venlige overfor
farveblinde. For 0 angiver total ligestilling mellem kønnene, og den er
nok fin at kunne vise også.</p>
<p>Vi får farverne: #e9a3c9, #f7f7f7 og #a1d76a, der matcher hhv det
(normativt) negative, det neutrale og det positive udfald.</p>
<p>og så beder vi om en farveskala i vores plot der matcher det:</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">world</span> <span class="op">%&gt;%</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">ligestilling</span>, by <span class="op">=</span> <span class="fu">join_by</span><span class="op">(</span><span class="va">common_name</span><span class="op">==</span><span class="va">common_name</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span>, fill <span class="op">=</span> <span class="va">BIGI</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_polygon</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_gradient2</span><span class="op">(</span>low <span class="op">=</span> <span class="st">"#a1d76a"</span>, mid <span class="op">=</span> <span class="st">"#f7f7f7"</span>, high <span class="op">=</span> <span class="st">"#e9a3c9"</span>, midpoint <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/choropleths-rendered-unnamed-chunk-13-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div id="hvorfor-går-det-så-godt-i-rusland" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="hvorfor-går-det-så-godt-i-rusland" class="callout-inner">
<h3 class="callout-title">hvorfor går det så godt i Rusland?</h3>
<div class="callout-content">
<p>Man kan undre sig over at Rusland er farvet grøn. Ikke ret grøn, men
dog grøn. Hvorfor er kvinder i denne opgørelse stillet bedre end
mænd?</p>
<p>Prøv at lave choroplethen for antallet af sunde leveår i stedet.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  Løsningsforslag
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">world</span> <span class="op">%&gt;%</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">ligestilling</span>, by <span class="op">=</span> <span class="fu">join_by</span><span class="op">(</span><span class="va">common_name</span><span class="op">==</span><span class="va">common_name</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span>, fill <span class="op">=</span> <span class="va">healthy_life_span</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_polygon</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_gradient2</span><span class="op">(</span>low <span class="op">=</span> <span class="st">"#a1d76a"</span>, mid <span class="op">=</span> <span class="st">"#f7f7f7"</span>, high <span class="op">=</span> <span class="st">"#e9a3c9"</span>, midpoint <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre>
</div>
<p><img src="../fig/choropleths-rendered-unnamed-chunk-14-1.png" style="display: block; margin: auto;" class="figure">
Husk, grøn er stadig godt, altså kvinder klarer sig bedre end mænd. Og
på levealder klarer de sig virkelig meget bedre i rusland</p>
</div>
</div>
</div>
</div>
<p>Hvad skal man være opmærksom på`</p>
<p>Man skal i hvert fald sikre at data normaliseres korrekt. Hvis vi
ønsker at vise hvor meget vin der fremstilles, skal man være opmærksom
på at Frankrigs areal og befolkningstal er en del større end Danmarks.
Og at rå tal derfor naturligt vil vise at der produceres mere vin i
Frankrig end Danmark. Og er det det man ønsker at vise, eller
sammenligne er det fint. Men det kan være man kan lære nyt ved at
farvelægge efter vinproduktionen per kapita. Eller per areal.</p>
<p>Når man klassificerer data skal man også være opmæksom på hvor man
lægger breakpoints. Det er samme koncept som når man laver histogrammer.
Små ændringer i breakpoints kan give store ændringer i kortet. Vælg en
farvegradient der er intuitiv og let at aflæse. Et godt tip er at bruge
farver der er venlige overfor farveblinde. De gør det nemlig også
lettere at skelne for folk med normalt farvesyn. Og så skal man overveje
hvordan man trækker de geografiske grænser. Fænomenet kaldes i
GIS-verdenen for MAUP eller “Modifiable Areal Unit Problem”. Men er nok
i almindelighed bedre kendt under begrebet gerrymandering. Altså bortset
fra at MAUP er det man kan komme til hvis man ikke tænker sig om. Mens
gerrymandering er resulatet når man gør det med vilje.</p>
<div id="accordionHint1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint1" aria-expanded="false" aria-controls="collapseHint1">
  <h4 class="accordion-header" id="headingHint1">
  maup
  </h4>
</button>
<div id="collapseHint1" class="accordion-collapse collapse" data-bs-parent="#accordionHint1" aria-labelledby="headingHint1">
<div class="accordion-body">
<p>Skalafølsomhed: Når data aggregeres på forskellige geografiske
niveauer (f.eks. postnumre vs. kommuner), kan den observerede
statistiske sammenhæng ændre sig. Zoneringseffekten: Selv inden for
samme niveau kan den måde, områderne opdeles på (dvs. hvordan grænserne
placeres), påvirke resultaterne. Fortolkningsusikkerhed: Fordi de
aggregerede data er følsomme over for de valgte enheder, skal man være
forsigtig med at drage generelle konklusioner ud fra resultaterne.
Analysestrategier: For at minimere MAUP kan man anvende metoder som
multiple skalaanalyser eller eksperimentere med alternative zoneringer
for at teste robustheden af resultaterne. Praktisk betydning: MAUP
understreger vigtigheden af at have en kritisk tilgang til geografiske
data og visualiseringer, da forskellige opdelinger kan lede til
forskellige politiske eller økonomiske fortolkninger.</p>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Use <code>.md</code> files for episodes when you want static
content</li>
<li>Use <code>.Rmd</code> files for episodes when you need to generate
output</li>
<li>Run <code>sandpaper::check_lesson()</code> to identify any issues
with your lesson</li>
<li>Run <code>sandpaper::build_lesson()</code> to preview your lesson
locally</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-un-normal-data"><p>Content from <a href="un-normal-data.html">What to do with data that is not normal</a></p>
<hr>
<p>Last updated on 2025-04-15 |

        <a href="https://github.com/KUBDatalab/R-toolbox/edit/main/episodes/un-normal-data.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 12 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do you write a lesson using R Markdown and
<a href="https://carpentries.github.io/sandpaper/" class="external-link">sandpaper</a>?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Explain how to use markdown with the new lesson template</li>
<li>Demonstrate how to include pieces of code, figures, and nested
challenge blocks</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>So your data is not normally distributed. What to do?</p>
<p>First of all - should it actually <em>be</em> normally
distributed?</p>
<p>The normal distribution is the most normal. But that just means that
it is the most common, not that the majority of data is normally
distributed.</p>
<p>problemet optræder typisk fordi man ønsker at lave en regression.</p>
<p>Men det er vigtigt at lade være med at gå i panik - for man kan
sagtens lave en lineær regression selvom data ikke er normal fordelte.
Se evt de antagelser vi gør os omkring den lineære regression. Der står
intet om at data skal være normalfordelte.</p>
<p>Så hvis data følger en anden fordeling, så kan det være fint nok. Men
inden man finder det bedste bud fra LINK TIL SIDEN OM HVILKEN FORDELING
DATA FØLGER, bør man overveje om der er domæneviden der kan fortælle os
hvilken fordeling data følger.</p>
<p>Og så laver man “bare” en glm med rette link og familie i stedet for
en lm, no problem.</p>
<p>Lav under alle omstændigheder et density plot, og kig på hvordan data
ser ud. Hvis plottet er højreskævt (det er hvor halen til højre er
længere end halen på venstre side. Det betyder at de fleste
observationer ligger til venstre). kan man evt løse problemet ved at
transformere data med en log eller kvadratrods transformation. Box-Cox
transformationen kan også hjælpe. kvadratroden bruges når skewness er
moderat.</p>
<p>Er det venstreskævt (så er halen til venstre længere), vil man ofte
kunne løse problemet med de inverse funktioner - dvs exp eller
kvadrat.</p>
<p>Kan problemet ikke løses på den måde, behøver man ikke nødvendigvis
gå i panik alligevel. For ANOVA er ret robust overfor afvigelser fra
normalitet.</p>
<p>Så er der glm. brug poisson-regression hvis det er tælledata.
Logistisk ved binære og den negative binomiale regression hvis der er
overdispersion (og det må vi hellere definere hvad er)</p>
<p>Så er der de ikke-parametriske metoder. Mann-Whitney U-test som
alternativ til t-testen ved to uafhængige stikprøver. Wilcoxon
signed-rank test - som alternativ til den parrede t-test.
kruskal-wallis. Alternativ til ANOVA for flere grupper.</p>
<ol start="4" style="list-style-type: decimal">
<li>Robuste metoder Robust regression: Mindsker indflydelsen af outliers
og leverer mere stabile estimater. Median regression: Fokuserer på
medianen i stedet for gennemsnittet.</li>
<li>Bootstrapping Bootstrapping: En resampling-metode, der ikke kræver
antagelser om datafordelingen. Bruges til at estimere
konfidensintervaller og standardfejl.</li>
<li>Kernel Density Estimation (KDE) KDE: Bruges til at estimere
tæthedsfunktionen for data uden at antage en bestemt fordeling.</li>
<li>Permutation tests Permutation tests: Bruger resampling til at teste
hypoteser uden at antage en bestemt fordeling.</li>
<li>Visualisering Q-Q plots: Bruges til at sammenligne datafordelingen
med en teoretisk fordeling. Box plots: Viser median, kvartiler og
potentielle outliers.</li>
</ol>
<section><h2 class="section-heading" id="robust-regression">robust regression<a class="anchor" aria-label="anchor" href="#robust-regression"></a>
</h2>
<hr class="half-width">
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Installer og indlæs MASS-pakken</span></span>
<span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">MASS</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generer et eksempel-dataset med outliers</span></span>
<span><span class="fu">set.seed</span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">rnorm</span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">x</span> <span class="op">+</span> <span class="fu">rnorm</span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Tilføj nogle outliers</span></span>
<span><span class="va">y</span><span class="op">[</span><span class="fu">c</span><span class="op">(</span><span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">30</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">y</span><span class="op">[</span><span class="fu">c</span><span class="op">(</span><span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">30</span><span class="op">)</span><span class="op">]</span> <span class="op">+</span> <span class="fl">10</span></span>
<span></span>
<span><span class="co"># Visualiser dataene</span></span>
<span><span class="fu">plot</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, main<span class="op">=</span><span class="st">"Data med outliers"</span>, xlab<span class="op">=</span><span class="st">"X"</span>, ylab<span class="op">=</span><span class="st">"Y"</span><span class="op">)</span></span>
<span><span class="fu">abline</span><span class="op">(</span><span class="fu">lm</span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span>, col<span class="op">=</span><span class="st">"blue"</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="co"># Tilføj almindelig lineær regressionslinje</span></span>
<span></span>
<span><span class="co"># Udfør robust regression</span></span>
<span><span class="va">robust_model</span> <span class="op">&lt;-</span> <span class="fu">rlm</span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Tilføj robust regressionslinjen til plottet</span></span>
<span><span class="fu">abline</span><span class="op">(</span><span class="va">robust_model</span>, col<span class="op">=</span><span class="st">"red"</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu">legend</span><span class="op">(</span><span class="st">"topleft"</span>, legend<span class="op">=</span><span class="fu">c</span><span class="op">(</span><span class="st">"Lineær regression"</span>, <span class="st">"Robust regression"</span><span class="op">)</span>, col<span class="op">=</span><span class="fu">c</span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"red"</span><span class="op">)</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/un-normal-data-rendered-unnamed-chunk-1-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Vis resultaterne</span></span>
<span><span class="fu">summary</span><span class="op">(</span><span class="va">robust_model</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
Call: rlm(formula = y ~ x)
Residuals:
     Min       1Q   Median       3Q      Max
-1.93154 -0.63535 -0.08813  0.64806 11.03570

Coefficients:
            Value   Std. Error t value
(Intercept) -0.1185  0.1040    -1.1396
x            1.9961  0.1139    17.5258

Residual standard error: 0.9663 on 98 degrees of freedom</code></pre>
</div>
</section><section><h2 class="section-heading" id="median-regression">median regression<a class="anchor" aria-label="anchor" href="#median-regression"></a>
</h2>
<hr class="half-width">
<p>Den skal måske være sin egen episode</p>
<p>Median regression, også kendt som kvantil regression med kvantilen
sat til 0.5, fokuserer på at estimere medianen af den afhængige variabel
i stedet for gennemsnittet. Dette gør den robust over for outliers og
skewed data. Vi kan bruge quantreg-pakken i R til at udføre median
regression.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Installer og indlæs quantreg-pakken</span></span>
<span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">quantreg</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Loading required package: SparseM</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generer et eksempel-dataset med outliers</span></span>
<span><span class="fu">set.seed</span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">rnorm</span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">x</span> <span class="op">+</span> <span class="fu">rnorm</span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Tilføj nogle outliers</span></span>
<span><span class="va">y</span><span class="op">[</span><span class="fu">c</span><span class="op">(</span><span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">30</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">y</span><span class="op">[</span><span class="fu">c</span><span class="op">(</span><span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">30</span><span class="op">)</span><span class="op">]</span> <span class="op">+</span> <span class="fl">10</span></span>
<span></span>
<span><span class="co"># Visualiser dataene</span></span>
<span><span class="fu">plot</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, main<span class="op">=</span><span class="st">"Data med outliers"</span>, xlab<span class="op">=</span><span class="st">"X"</span>, ylab<span class="op">=</span><span class="st">"Y"</span><span class="op">)</span></span>
<span><span class="fu">abline</span><span class="op">(</span><span class="fu">lm</span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span>, col<span class="op">=</span><span class="st">"blue"</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="co"># Tilføj almindelig lineær regressionslinje</span></span>
<span></span>
<span><span class="co"># Udfør median regression</span></span>
<span><span class="va">median_model</span> <span class="op">&lt;-</span> <span class="fu">rq</span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, tau<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Tilføj median regressionslinjen til plottet</span></span>
<span><span class="fu">abline</span><span class="op">(</span><span class="va">median_model</span>, col<span class="op">=</span><span class="st">"green"</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu">legend</span><span class="op">(</span><span class="st">"topleft"</span>, legend<span class="op">=</span><span class="fu">c</span><span class="op">(</span><span class="st">"Lineær regression"</span>, <span class="st">"Median regression"</span><span class="op">)</span>, col<span class="op">=</span><span class="fu">c</span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"green"</span><span class="op">)</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../fig/un-normal-data-rendered-unnamed-chunk-2-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Vis resultaterne</span></span>
<span><span class="fu">summary</span><span class="op">(</span><span class="va">median_model</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">WARNING<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="warning" tabindex="0"><code>Warning in rq.fit.br(x, y, tau = tau, ci = TRUE, ...): Solution may be
nonunique</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
Call: rq(formula = y ~ x, tau = 0.5)

tau: [1] 0.5

Coefficients:
            coefficients lower bd upper bd
(Intercept) -0.19314     -0.35067  0.07348
x            2.08636      1.90977  2.26538</code></pre>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Use <code>.md</code> files for episodes when you want static
content</li>
<li>Use <code>.Rmd</code> files for episodes when you need to generate
output</li>
<li>Run <code>sandpaper::check_lesson()</code> to identify any issues
with your lesson</li>
<li>Run <code>sandpaper::build_lesson()</code> to preview your lesson
locally</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-building-models"><p>Content from <a href="building-models.html">building-models</a></p>
<hr>
<p>Last updated on 2025-04-15 |

        <a href="https://github.com/KUBDatalab/R-toolbox/edit/main/episodes/building-models.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 12 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do you write a lesson using R Markdown and
<a href="https://carpentries.github.io/sandpaper/" class="external-link">sandpaper</a>?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Explain how to use markdown with the new lesson template</li>
<li>Demonstrate how to include pieces of code, figures, and nested
challenge blocks</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>OK. det er lidt mere kompliceret end som så.</p>
<p>Så vi starter med det grundlæggende, og kigger på kun på lineære
modeller.</p>
<p>Målet er at forudsige en afhængig variabel. Det er ikke nødvendigvis
en forklaring. Er der 100% korellation mellen en afhængig og en
uafhængig variabel, kan vi 100% forudsige den afhængige. Men det er ikke
en forklaring. Der er forskel på korellation og kausalitet.</p>
<p>Og det vil vi gøre ved at tage de uafhængige varible vi har, og bruge
et udvalg af dem, evt. i kombinationer, til at forudsige den afhængige
variabel.</p>
<p>Den kombination af uafhængige variable, der i modellen bedst
forudsiger den afhængige variabel er den model der (baseret på det data
vi nu har), er “bedst”.</p>
<p>Første trin er at identificere de variable som teoretisk, eller som
anden forskning, har vist er relevante.</p>
<p>Andet trin. Undersøg dine data. lav korrelationsanalyser og
visualiseringer, for at se hvilke variable der har en stærk sammenhæng
med den afhængige variabel.</p>
<p>Afgør hvilke variable der skal indgå i modellen.</p>
<p>Mål hvor god modellen er. Og test den på nye data.</p>
<p>AIC, BIC afbalancerer modeltilpasning og kompleksitet.</p>
<p>Forward selection, backward elimination, stepwise regression</p>
<p>Regularisering - lasso, ridge eller elastic net.</p>
<p>Dataforberedelse. manglende værider, fejl, outliers, inkonsistente
data. Skalering og normalisering af variable. evt. transformation af
data. Eksempelvis log-transformation ved skæve fordeligner.</p>
<p>Feature engineering: oprettelse af nye variable baseret på
eksisterende. Herunder valg og konstruktion af de mest informative
features.</p>
<p>Opdel data i træning, validering og test-set.</p>
<p>Modelvalg - lineær, logistisk, træer og den slags.</p>
<p>Hvilke forudsætninger har modellen. Eg. lineariet, homoskedacitet,
normalfordelte residualer.</p>
<p>Evaluering af hvor godt modellen klarer sig. R^2, RMSE, MAE.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Use <code>.md</code> files for episodes when you want static
content</li>
<li>Use <code>.Rmd</code> files for episodes when you need to generate
output</li>
<li>Run <code>sandpaper::check_lesson()</code> to identify any issues
with your lesson</li>
<li>Run <code>sandpaper::build_lesson()</code> to preview your lesson
locally</li>
</ul>
</div>
</div>
</div></section><section id="aio-lasso-regularisation"><p>Content from <a href="lasso-regularisation.html">lasso-regularisation</a></p>
<hr>
<p>Last updated on 2025-04-15 |

        <a href="https://github.com/KUBDatalab/R-toolbox/edit/main/episodes/lasso-regularisation.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 12 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do you write a lesson using R Markdown and
<a href="https://carpentries.github.io/sandpaper/" class="external-link">sandpaper</a>?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Explain how to use markdown with the new lesson template</li>
<li>Demonstrate how to include pieces of code, figures, and nested
challenge blocks</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="least-absolute-shrinkage-and-selection-operator-">Least Absolute Shrinkage and Selection Operator.<a class="anchor" aria-label="anchor" href="#least-absolute-shrinkage-and-selection-operator-"></a>
</h2>
<hr class="half-width">
<p>Når vi laver en lineær model, forsøger vi at finde koefficienterne i
udtrykket:</p>
<p><span class="math display">\[\hat{y}= \beta_0 + \beta_1*x_1 +
\beta_2*x_2 + \beta_3*x_3 +....\]</span></p>
<p>Og vi er specifikt ude efter dem der minimerer forskellen på de
“sande” værdier af y vi kender, og modellens forudsigelse <span class="math inline">\(\hat{y}\)</span></p>
<p>Det vi typisk gør, er at vi forsøger at minimere en såkaldt
loss-funktion. Det er typisk RSS (kvadrerede residualer).</p>
<p><span class="math display">\[RSS = \sum(y_i -
\hat{y_i})^2\]</span></p>
<p>Algoritmen der klarer beregningerne for os justerer på snedig vis
<span class="math inline">\(\beta\)</span>’erne så RSS bliver så lille
som muligt. Vi kan tænke på det som forskellen på de “sande” værdier som
vi kender, og de forudsagte værdier, baseret på modellen og vors
uafhængige variable. For alle vores observationer beregner vi
forskellen, kvadrerer dem og lægger dem alle sammen.</p>
<p>Når vi bygger modellen, er en af de ting vi skal tage stilling til,
hvor mange og hvilke variable vi skal have med. Har vi tilstrækkeligt
mange med kan vi forudsige y meget præcist. Men det fører let til at
modellen i virkeligheden ikke har fundet sammenhænge mellem den
afhængige og de uafhængige variable, men i stedet har “lært” datasættet
uden ad.</p>
<p>Den bedste model er derfor den hvor vi har så få uafhængige variable
med som muligt. Men samtidig forklarer mest muligt af variationen</p>
<p>Og alt det her hører nok hjemme et andet sted end hvor vi specifik
taler om LASSO.</p>
<p>Et problem er at vi skal tage stilling til, er hvor mange og hvilke
variable vi skal have med i modellen. Hvis vi medtager tilstrækkeligt
mange parametre, skal det nok lykkes at forklare alt.</p>
<p>En teknik der kan udvælge er lasso. I stedet for at optimere på RSS,
optimerer vi på:</p>
<p><span class="math display">\[\sum_{i=1}^{n}(y_i - \sum_{j}
x_{ij}\beta_j)^2 + \lambda\sum_{j=1}^p |\beta_j|\]</span></p>
<p>Eller, lidt kortere: d <span class="math display">\[RSS +
\lambda\sum_{j=1}^p |\beta_j|\]</span></p>
<p>Så det udtryk vi nu forsøger at minimere - algoritmen gør det for os
- er nu tilføjet summen af alle vores koefficienter - i absolutte
værdier, så de ikke kommer til at udligne hinanden. Og så ganger vi en
faktor på. Det betyder at hvis der er mange variable med i modellen - så
bliver straf-leddet større. Og derfor vil algoritmen kunne opnå et bedre
resultat, ved at lade nogen af koefficienterne blive 0. Så bidrager de
ikke længere til loss-funktionen, og den bliver mindre.</p>
<p><span class="math inline">\(\lambda\)</span> styrer hvor hårdt vi
straffer modellen for at have for mange eller for store koefficienter.
Det betyder også at der er en parameter som ikke styres af algoritmen,
men som vi selv skal vælge. Det er en hyperparameter, som vi selv skal
optimere på.</p>
<p>Netto resultatet er at vi lader en algoritme styre hvilke variable vi
skal have med i modellen. Og så kan vi ikke rigtigt beskyldes for at
være gået på p-fisketur.</p>
<p>Hvordan gør man så?</p>
<p>Vi napper mtcars som eksempel. Vi skal nok have fundet et andet på et
tidspunkt.</p>
<p>og så skal vi bruge pakker der implementerer løsningen - for vi gider
ikke selv skrive koden.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">glmnet</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Loading required package: Matrix</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
Attaching package: 'Matrix'</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>The following objects are masked from 'package:tidyr':

    expand, pack, unpack</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Loaded glmnet 4.1-8</code></pre>
</div>
<p>Implementeringen af lasso i glmnet, kræver at den afhængige variabel
ligger i en vektor, og at prediktor variablene ligger i en matrix.</p>
<p>Vi vil forudsige antallet af hestekræfter i en bil, baseret på mpg,
wt, drat og qsec</p>
<p>her skal vi nok lege lidt med data og parametre. For det er et
dårligt eksempel i x giver det fin mening at drat ikke skal være med.
Men det er noget snask at z ikke piller nogen ud overhovedet. For den
feature vil vi gerne vise.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">mtcars</span><span class="op">$</span><span class="va">hp</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">mtcars</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">mpg</span>, <span class="va">wt</span>, <span class="va">drat</span>, <span class="va">qsec</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">data.matrix</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu">data.matrix</span><span class="op">(</span><span class="va">mtcars</span><span class="op">[</span>, <span class="fu">c</span><span class="op">(</span><span class="st">'mpg'</span>, <span class="st">'wt'</span>, <span class="st">'drat'</span>, <span class="st">'qsec'</span>, <span class="st">'cyl'</span>, <span class="st">'disp'</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre>
</div>
<p>Og nu kan vi så lave en Lasso regression. funktionen hedder glmnet.
Og den kan lave andre former for regression. Hvis det er lasso, skal
argumentet alpha sættes til 1. Vi skal selv vælge straf termen lambda.
Vi prøver med 1.5</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">set.seed</span><span class="op">(</span><span class="fl">47</span><span class="op">)</span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu">glmnet</span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span>,alpha <span class="op">=</span> <span class="fl">1</span>, lambda <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="fu">coef</span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>5 x 1 sparse Matrix of class "dgCMatrix"
                    s0
(Intercept) 488.868159
mpg          -2.851152
wt           22.951695
drat          .
qsec        -20.098919</code></pre>
</div>
<p>Og så får vi et resultat for koefficienterne. Bemærk at koefficienten
fro <code>drat</code> er blevet helt væk. Ved man lidt om biler er det
ikke meget overraskende (men dog en lille smule).</p>
<p>Men er det den bedst tænkelige lambda?</p>
<p>Det betyder at vi har brug for en måde at sammenligne. Hvis vi bygger
en model med en bestemt lambda - hvor god er den så rent faktisk. Og det
kan vi sammenligne med en anden model med et andet lambda.</p>
<p>Så vi krydsvaliderer. Vi tager vores data, og deler det op i
eksempelvis 10 “folds” eller portioner. Så vælger vi en lambda, og
fitter modellen på de 9 sidste fold, og ser hvor godt den forudsiger de
“sande” værdier i den 1. fold. Det gentager vi, hvor vi fitter på alle
fold, bortset fra den anden. Osv. Når vi er færdige har vi 10
kvalitetsmål for en bestemt værdi af lambda. Og tager gennemsnittet af
dem. Så har vi et kvalitetsmål for en bestemt værdi af lambda.</p>
<p>Gentag processen for en masse forskellige lambda, og vi kan vælge den
lambda der har det bedste mål for kvaliteten. Det gider vi heller ikke
gøre i hånden. Så der er heldigvis en funktion der gør det:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">set.seed</span><span class="op">(</span><span class="fl">47</span><span class="op">)</span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu">cv.glmnet</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre>
</div>
<p>Modellen indeholder nu værdier for mange forskellige lambda. Det kan
vi plotte:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot</span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span></code></pre>
</div>
<p><img src="../fig/lasso-regularisation-rendered-unnamed-chunk-6-1.png" style="display: block; margin: auto;" class="figure">
Vi kan kigge på plottet og finde den bedste værdi. Vi kan også trække
det ud af modellen:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">best_l</span> <span class="op">&lt;-</span> <span class="va">model</span><span class="op">$</span><span class="va">lambda.min</span></span>
<span><span class="va">best_l</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 2.668219</code></pre>
</div>
<p>Nu ved vi hvilket lambda vi skal bruge, og så kan vi fitte vores
lasso model med den:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">best_model</span> <span class="op">&lt;-</span> <span class="fu">glmnet</span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span>,alpha <span class="op">=</span> <span class="fl">1</span>, lambda <span class="op">=</span> <span class="va">best_l</span><span class="op">)</span></span>
<span><span class="fu">coef</span><span class="op">(</span><span class="va">best_model</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>5 x 1 sparse Matrix of class "dgCMatrix"
                   s0
(Intercept) 484.20742
mpg          -2.95796
wt           21.37988
drat          .
qsec        -19.43425</code></pre>
</div>
<p>CAVE. Det kan godt være det er værd at skalere værdierne.</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">range</span><span class="op">(</span><span class="va">mtcars</span><span class="op">$</span><span class="va">mpg</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 10.4 33.9</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">range</span><span class="op">(</span><span class="va">mtcars</span><span class="op">$</span><span class="va">wt</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 1.513 5.424</code></pre>
</div>
<div id="regularisation" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="regularisation" class="callout-inner">
<h3 class="callout-title">regularisation</h3>
<div class="callout-content">
<p>Vi gør modellen mere regulær - eller ordnet, ved at tilføje elementer
til problemet, der gør det lettere at løse. Det er vist ikke en helt
perfekt forklaring. Men den nærmer sig.</p>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Use <code>.md</code> files for episodes when you want static
content</li>
<li>Use <code>.Rmd</code> files for episodes when you need to generate
output</li>
<li>Run <code>sandpaper::check_lesson()</code> to identify any issues
with your lesson</li>
<li>Run <code>sandpaper::build_lesson()</code> to preview your lesson
locally</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-ridge-regularisation"><p>Content from <a href="ridge-regularisation.html">ridge-regularisation</a></p>
<hr>
<p>Last updated on 2025-04-15 |

        <a href="https://github.com/KUBDatalab/R-toolbox/edit/main/episodes/ridge-regularisation.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 12 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do you write a lesson using R Markdown and
<a href="https://carpentries.github.io/sandpaper/" class="external-link">sandpaper</a>?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Explain how to use markdown with the new lesson template</li>
<li>Demonstrate how to include pieces of code, figures, and nested
challenge blocks</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>samme mølle som lasso. Men med en anden loss-funktion. Og den kan
derfor ikke kan nå til samme resultater. Bl.a. at den vist ikke kan
reducere koefficienter til 0.</p>
<p>Men det er vist autokorrelation den i højere grad kan håndtere.</p>
<p>funktionen er den samme - men alpha sættes til noget andet.</p>
<p>Udfordringerne er de samme hvad angår at tune hyperparameteren.</p>
<p>Så minimeringsøvelsen går på:</p>
<p><span class="math display">\[\sum_{i=1}^{n}(y_i - \sum_{j}
x_{ij}\beta_j)^2 + \lambda\sum_{j=1}^p \beta_j^2\]</span></p>
<p>Eller, lidt kortere: d <span class="math display">\[RSS +
\lambda\sum_{j=1}^p \beta_j^2\]</span></p>
<p>Hvorfor kan det ikke gå i 0?</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Use <code>.md</code> files for episodes when you want static
content</li>
<li>Use <code>.Rmd</code> files for episodes when you need to generate
output</li>
<li>Run <code>sandpaper::check_lesson()</code> to identify any issues
with your lesson</li>
<li>Run <code>sandpaper::build_lesson()</code> to preview your lesson
locally</li>
</ul>
</div>
</div>
</div></section><section id="aio-elastic-net-regularisation"><p>Content from <a href="elastic-net-regularisation.html">elastic-net-regularisation</a></p>
<hr>
<p>Last updated on 2025-04-15 |

        <a href="https://github.com/KUBDatalab/R-toolbox/edit/main/episodes/elastic-net-regularisation.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 12 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do you write a lesson using R Markdown and
<a href="https://carpentries.github.io/sandpaper/" class="external-link">sandpaper</a>?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Explain how to use markdown with the new lesson template</li>
<li>Demonstrate how to include pieces of code, figures, and nested
challenge blocks</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<hr class="half-width">
<p>This is a lesson created via The Carpentries Workbench. It is written
in <a href="https://pandoc.org/MANUAL.html" class="external-link">Pandoc-flavored Markdown</a>
for static files (with extension <code>.md</code>) and <a href="https://rmarkdown.rstudio.com/" class="external-link">R Markdown</a> for dynamic files
that can render code into output (with extension <code>.Rmd</code>).
Please refer to the <a href="https://carpentries.github.io/sandpaper-docs/" class="external-link">Introduction to The
Carpentries Workbench</a> for full documentation.</p>
<p>What you need to know is that there are three sections required for a
valid Carpentries lesson template:</p>
<ol style="list-style-type: decimal">
<li>
<code>questions</code> are displayed at the beginning of the episode
to prime the learner for the content.</li>
<li>
<code>objectives</code> are the learning objectives for an episode
displayed with the questions.</li>
<li>
<code>keypoints</code> are displayed at the end of the episode to
reinforce the objectives.</li>
</ol>
<div id="accordionInstructor1" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor1" aria-expanded="false" aria-controls="collapseInstructor1">
  <h3 class="accordion-header" id="headingInstructor1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Instructor Note </h3>
</button>
<div id="collapseInstructor1" class="accordion-collapse collapse" data-bs-parent="#accordionInstructor1" aria-labelledby="headingInstructor1">
<div class="accordion-body">
<p>Inline instructor notes can help inform instructors of timing
challenges associated with the lessons. They appear in the “Instructor
View”</p>
</div>
</div>
</div>
</div>
<div id="challenge-1-can-you-do-it" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-1-can-you-do-it" class="callout-inner">
<h3 class="callout-title">Challenge 1: Can you do it?</h3>
<div class="callout-content">
<p>What is the output of this command?</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">paste</span><span class="op">(</span><span class="st">"This"</span>, <span class="st">"new"</span>, <span class="st">"lesson"</span>, <span class="st">"looks"</span>, <span class="st">"good"</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Output </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "This new lesson looks good"</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="challenge-2-how-do-you-nest-solutions-within-challenge-blocks" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-2-how-do-you-nest-solutions-within-challenge-blocks" class="callout-inner">
<h3 class="callout-title">Challenge 2: how do you nest solutions within challenge blocks?</h3>
<div class="callout-content">

</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p>You can add a line with at least three colons and a
<code>solution</code> tag.</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="figures">Figures<a class="anchor" aria-label="anchor" href="#figures"></a>
</h2>
<hr class="half-width">
<p>You can include figures generated from R Markdown:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pie</span><span class="op">(</span></span>
<span>  <span class="fu">c</span><span class="op">(</span>Sky <span class="op">=</span> <span class="fl">78</span>, <span class="st">"Sunny side of pyramid"</span> <span class="op">=</span> <span class="fl">17</span>, <span class="st">"Shady side of pyramid"</span> <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>, </span>
<span>  init.angle <span class="op">=</span> <span class="fl">315</span>, </span>
<span>  col <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"deepskyblue"</span>, <span class="st">"yellow"</span>, <span class="st">"yellow3"</span><span class="op">)</span>, </span>
<span>  border <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<figure style="text-align: center"><img src="../fig/elastic-net-regularisation-rendered-pyramid-1.png" alt="pie chart illusion of a pyramid" class="figure mx-auto d-block"><figcaption>
Sun arise each and every morning
</figcaption></figure><p>Or you can use pandoc markdown for static figures with the following
syntax:</p>
<p><code>![optional caption that appears below the figure](figure url){alt='alt text for accessibility purposes'}</code></p>
<figure><img src="https://raw.githubusercontent.com/carpentries/logo/master/Badge_Carpentries.svg" alt="Blue Carpentries hex person logo with no text." class="figure mx-auto d-block"><div class="figcaption">You belong in The Carpentries!</div>
</figure></section><section><h2 class="section-heading" id="math">Math<a class="anchor" aria-label="anchor" href="#math"></a>
</h2>
<hr class="half-width">
<p>One of our episodes contains <span class="math inline">\(\LaTeX\)</span> equations when describing how to
create dynamic reports with {knitr}, so we now use mathjax to describe
this:</p>
<p><code>$\alpha = \dfrac{1}{(1 - \beta)^2}$</code> becomes: <span class="math inline">\(\alpha = \dfrac{1}{(1 - \beta)^2}\)</span></p>
<p>Cool, right?</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Use <code>.md</code> files for episodes when you want static
content</li>
<li>Use <code>.Rmd</code> files for episodes when you need to generate
output</li>
<li>Run <code>sandpaper::check_lesson()</code> to identify any issues
with your lesson</li>
<li>Run <code>sandpaper::build_lesson()</code> to preview your lesson
locally</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-snow-plot"><p>Content from <a href="snow-plot.html">snow_plot</a></p>
<hr>
<p>Last updated on 2025-04-15 |

        <a href="https://github.com/KUBDatalab/R-toolbox/edit/main/episodes/snow-plot.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 12 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do you write a lesson using R Markdown and
<a href="https://carpentries.github.io/sandpaper/" class="external-link">sandpaper</a>?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Explain how to use markdown with the new lesson template</li>
<li>Demonstrate how to include pieces of code, figures, and nested
challenge blocks</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<hr class="half-width">
<figure><img src="../fig/cholera_is_coming.jpg" class="figure mx-auto d-block"></figure><p>der skal køres en library SnowData</p>
<p>SnowData::cholera_cases</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Use <code>.md</code> files for episodes when you want static
content</li>
<li>Use <code>.Rmd</code> files for episodes when you need to generate
output</li>
<li>Run <code>sandpaper::check_lesson()</code> to identify any issues
with your lesson</li>
<li>Run <code>sandpaper::build_lesson()</code> to preview your lesson
locally</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section>
</div>
    </main>
</div>
<!-- END  : inst/pkgdown/templates/content-extra.html -->

      </div>
<!--/div.row-->
      		<footer class="row footer mx-md-3"><hr>
<div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/KUBDatalab/R-toolbox/edit/main/README.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/KUBDatalab/R-toolbox/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/KUBDatalab/R-toolbox/" class="external-link">Source</a></p>
				<p><a href="https://github.com/KUBDatalab/R-toolbox/blob/main/CITATION.cff" class="external-link">Cite</a> | <a href="mailto:kubdatalab@kb.dk">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC BY-NC-SA 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.11" class="external-link">sandpaper (0.16.11)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.9" class="external-link">pegboard (0.7.9)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.5" class="external-link">varnish (1.0.5)</a></p>
			</div>
		</footer>
</div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://KUBDatalab.github.io/R-toolbox/instructor/aio.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson",
  "name": "All in One View",
  "creativeWorkStatus": "active",
  "url": "https://KUBDatalab.github.io/R-toolbox/instructor/aio.html",
  "identifier": "https://KUBDatalab.github.io/R-toolbox/instructor/aio.html",
  "dateCreated": "2024-04-09",
  "dateModified": "2025-04-15",
  "datePublished": "2025-04-15"
}

  </script><script>
		feather.replace();
	</script>
</body>
</html><!-- END:   inst/pkgdown/templates/layout.html-->

